{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.6.0;\r\npragma experimental ABIEncoderV2;\r\n\r\ninterface AaveProtocolDataProvider {\r\n    function getUserReserveData(address asset, address user) external view returns (\r\n        uint256 currentATokenBalance,\r\n        uint256 currentStableDebt,\r\n        uint256 currentVariableDebt,\r\n        uint256 principalStableDebt,\r\n        uint256 scaledVariableDebt,\r\n        uint256 stableBorrowRate,\r\n        uint256 liquidityRate,\r\n        uint40 stableRateLastUpdated,\r\n        bool usageAsCollateralEnabled\r\n    );\r\n\r\n    function getReserveTokensAddresses(address _asset) external view returns (\r\n        address aTokenAddress,\r\n        address stableDebtTokenAddress,\r\n        address variableDebtTokenAddress\r\n    );\r\n}\r\n\r\ninterface AaveLendingPool {\r\n    function getUserAccountData(address user) external view returns (\r\n        uint256 totalCollateralETH,\r\n        uint256 totalDebtETH,\r\n        uint256 availableBorrowsETH,\r\n        uint256 currentLiquidationThreshold,\r\n        uint256 ltv,\r\n        uint256 healthFactor\r\n    );\r\n}\r\n\r\ninterface AaveAddressProvider {\r\n    function getLendingPool() external view returns (address);\r\n    function getPriceOracle() external view returns (address);\r\n}\r\n\r\ninterface ChainLinkInterface {\r\n    function latestAnswer() external view returns (int256);\r\n    function decimals() external view returns (uint256);\r\n}\r\n\r\ninterface AavePriceOracle {\r\n    function getAssetsPrices(address[] calldata _assets) external view returns(uint256[] memory);\r\n}\r\n\r\ninterface ATokenInterface {\r\n    function balanceOf(address _user) external view returns(uint256);\r\n}\r\n\r\ncontract DSMath {\r\n\r\n    function add(uint x, uint y) internal pure returns (uint z) {\r\n        require((z = x + y) >= x, \"math-not-safe\");\r\n    }\r\n\r\n    function mul(uint x, uint y) internal pure returns (uint z) {\r\n        require(y == 0 || (z = x * y) / y == x, \"math-not-safe\");\r\n    }\r\n\r\n    uint constant WAD = 10 ** 18;\r\n\r\n    function wmul(uint x, uint y) internal pure returns (uint z) {\r\n        z = add(mul(x, y), WAD / 2) / WAD;\r\n    }\r\n}\r\n\r\n\r\ncontract Helpers is DSMath {\r\n\r\n    struct AaveData {\r\n        uint collateral;\r\n        uint stableDebt;\r\n        uint variableDebt;\r\n    }\r\n\r\n\r\n    struct AaveEthData {\r\n        uint collateral;\r\n        uint debt;\r\n    }\r\n\r\n    struct data {\r\n        address user;\r\n        AaveData[] tokensData;\r\n    }\r\n    \r\n    struct datas {\r\n        AaveData[] tokensData;\r\n    }\r\n\r\n    struct AtokenAddress {\r\n        address token;\r\n        address atoken;\r\n        address stableDebtToken;\r\n        address variableDebtToken;\r\n    }\r\n\r\n    struct TokenPrice {\r\n        uint priceInEth;\r\n        uint priceInUsd;\r\n    }\r\n\r\n    /**\r\n     * @dev get Aave Provider Address\r\n    */\r\n    function getAaveAddressProvider() internal pure returns (address) {\r\n        return 0xB53C1a33016B2DC2fF3653530bfF1848a515c8c5; // Mainnet\r\n        // return 0x652B2937Efd0B5beA1c8d54293FC1289672AFC6b; // Kovan\r\n    }\r\n\r\n    \r\n    function getAaveProtocolDataProvider() internal pure returns (address) {\r\n        return 0x057835Ad21a177dbdd3090bB1CAE03EaCF78Fc6d; // Mainnet\r\n        // return 0x744C1aaA95232EeF8A9994C4E0b3a89659D9AB79; // Kovan\r\n    }\r\n\r\n    /**\r\n     * @dev get Chainlink ETH price feed Address\r\n    */\r\n    function getChainlinkEthFeed() internal pure returns (address) {\r\n        return 0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419; //mainnet\r\n        // return 0x9326BFA02ADD2366b30bacB125260Af641031331; //kovan\r\n    }\r\n\r\n    /**\r\n     * @dev Return ether address\r\n     */\r\n    function getEthAddr() internal pure returns (address) {\r\n        return 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE; // ETH Address\r\n    }\r\n\r\n    /**\r\n     * @dev Return Weth address\r\n    */\r\n    function getWethAddr() internal pure returns (address) {\r\n        return 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2; // Mainnet WETH Address\r\n        // return 0xd0A1E359811322d97991E03f863a0C30C2cF029C; // Kovan WETH Address\r\n    }\r\n\r\n}\r\n\r\ncontract InstaAaveV2PowerResolver is Helpers {\r\n    function getAtokenAddresses(address[] calldata reserves) external view returns (AtokenAddress[] memory atokenAddress) {\r\n        AaveProtocolDataProvider aaveProtocolDataProvider = AaveProtocolDataProvider(getAaveProtocolDataProvider());\r\n        atokenAddress = new AtokenAddress[](reserves.length);\r\n        for (uint i = 0; i < reserves.length; i++) {\r\n            address _reserve = reserves[i] == getEthAddr() ? getWethAddr() : reserves[i];\r\n            (address atoken, address stableDebtToken, address variableDebtToken) = aaveProtocolDataProvider.getReserveTokensAddresses(_reserve);\r\n            atokenAddress[i] = AtokenAddress(_reserve, atoken, stableDebtToken, variableDebtToken);\r\n        }\r\n    }\r\n\r\n    function getTokensPrices(address[] calldata tokens) \r\n    external view returns(TokenPrice[] memory tokenPrices, uint ethPrice) {\r\n        AaveAddressProvider aaveAddressProvider = AaveAddressProvider(getAaveAddressProvider());\r\n        uint[] memory _tokenPrices = AavePriceOracle(aaveAddressProvider.getPriceOracle()).getAssetsPrices(tokens);\r\n        ethPrice = uint(ChainLinkInterface(getChainlinkEthFeed()).latestAnswer());\r\n        tokenPrices = new TokenPrice[](_tokenPrices.length);\r\n        for (uint i = 0; i < _tokenPrices.length; i++) {\r\n            tokenPrices[i] = TokenPrice(\r\n                _tokenPrices[i],\r\n                wmul(_tokenPrices[i], uint(ethPrice) * 10 ** 10)\r\n            );\r\n        }\r\n    }\r\n\r\n    function getEthPrice() public view returns (uint ethPrice) {\r\n        ethPrice = uint(ChainLinkInterface(getChainlinkEthFeed()).latestAnswer());\r\n    }\r\n\r\n    function getAaveDataByReserve(address[] memory owners, AtokenAddress memory atokenAddress) public view returns (AaveData[] memory) {\r\n        AaveData[] memory tokensData = new AaveData[](owners.length);\r\n        ATokenInterface atokenContract = ATokenInterface(atokenAddress.atoken);\r\n        ATokenInterface stableDebtTokenContract = ATokenInterface(atokenAddress.stableDebtToken);\r\n        ATokenInterface variableDebtContract = ATokenInterface(atokenAddress.variableDebtToken);\r\n        for (uint i = 0; i < owners.length; i++) {\r\n            tokensData[i] = AaveData(\r\n                atokenContract.balanceOf(owners[i]),\r\n                stableDebtTokenContract.balanceOf(owners[i]),\r\n                variableDebtContract.balanceOf(owners[i])\r\n            );\r\n        }\r\n\r\n        return tokensData;\r\n    }\r\n\r\n    function getPositionByReserves(\r\n        address[] calldata owners,\r\n        AtokenAddress[] calldata atokenAddress\r\n    )\r\n        external\r\n        view\r\n        returns (datas[] memory)\r\n    {\r\n        datas[] memory _data = new datas[](atokenAddress.length);\r\n        for (uint i = 0; i < atokenAddress.length; i++) {\r\n            _data[i] = datas(\r\n                getAaveDataByReserve(owners, atokenAddress[i])\r\n            );\r\n        }\r\n        return _data;\r\n    }\r\n\r\n    function getPositionByAddress(\r\n        address[] memory owners\r\n    )\r\n        public\r\n        view\r\n        returns (AaveEthData[] memory tokensData)\r\n    {\r\n        AaveAddressProvider addrProvider = AaveAddressProvider(getAaveAddressProvider());\r\n        AaveLendingPool aave = AaveLendingPool(addrProvider.getLendingPool());\r\n        tokensData = new AaveEthData[](owners.length);\r\n        for (uint i = 0; i < owners.length; i++) {\r\n            (uint256 collateral,uint256 debt,,,,) = aave.getUserAccountData(owners[i]);\r\n            tokensData[i] = AaveEthData(\r\n                collateral,\r\n                debt\r\n            );\r\n        }\r\n    }\r\n\r\n}","ABI":"[{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"owners\",\"type\":\"address[]\"},{\"components\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"atoken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"stableDebtToken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"variableDebtToken\",\"type\":\"address\"}],\"internalType\":\"struct Helpers.AtokenAddress\",\"name\":\"atokenAddress\",\"type\":\"tuple\"}],\"name\":\"getAaveDataByReserve\",\"outputs\":[{\"components\":[{\"internalType\":\"uint256\",\"name\":\"collateral\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"stableDebt\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"variableDebt\",\"type\":\"uint256\"}],\"internalType\":\"struct Helpers.AaveData[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"reserves\",\"type\":\"address[]\"}],\"name\":\"getAtokenAddresses\",\"outputs\":[{\"components\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"atoken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"stableDebtToken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"variableDebtToken\",\"type\":\"address\"}],\"internalType\":\"struct Helpers.AtokenAddress[]\",\"name\":\"atokenAddress\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getEthPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"ethPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"owners\",\"type\":\"address[]\"}],\"name\":\"getPositionByAddress\",\"outputs\":[{\"components\":[{\"internalType\":\"uint256\",\"name\":\"collateral\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"debt\",\"type\":\"uint256\"}],\"internalType\":\"struct Helpers.AaveEthData[]\",\"name\":\"tokensData\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"owners\",\"type\":\"address[]\"},{\"components\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"atoken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"stableDebtToken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"variableDebtToken\",\"type\":\"address\"}],\"internalType\":\"struct Helpers.AtokenAddress[]\",\"name\":\"atokenAddress\",\"type\":\"tuple[]\"}],\"name\":\"getPositionByReserves\",\"outputs\":[{\"components\":[{\"components\":[{\"internalType\":\"uint256\",\"name\":\"collateral\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"stableDebt\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"variableDebt\",\"type\":\"uint256\"}],\"internalType\":\"struct Helpers.AaveData[]\",\"name\":\"tokensData\",\"type\":\"tuple[]\"}],\"internalType\":\"struct Helpers.datas[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"tokens\",\"type\":\"address[]\"}],\"name\":\"getTokensPrices\",\"outputs\":[{\"components\":[{\"internalType\":\"uint256\",\"name\":\"priceInEth\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"priceInUsd\",\"type\":\"uint256\"}],\"internalType\":\"struct Helpers.TokenPrice[]\",\"name\":\"tokenPrices\",\"type\":\"tuple[]\"},{\"internalType\":\"uint256\",\"name\":\"ethPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]","ContractName":"InstaAaveV2PowerResolver","CompilerVersion":"v0.6.0+commit.26b70077","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"MIT","Proxy":"0","Implementation":"","SwarmSource":"ipfs://1687c020d5698b3127c99200ca7875119c2ae312ddb26661b33895c14c4c9434"}]}