{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.16;\r\n\r\n\r\ncontract BMICOAffiliateProgramm {\r\n    mapping (address => uint256) referralsInfo;\r\n\r\n    mapping (bytes32 => address) partnersPromo;\r\n    struct itemPartners {\r\n        uint256 attracted_investments;\r\n        bytes32 promo;\r\n        uint16 personal_percent;\r\n        bool create;\r\n    }\r\n    mapping (address => itemPartners) partnersInfo;\r\n\r\n    uint16 public ref_percent = 100; //1 = 0.01%, 10000 = 100%\r\n\r\n    struct itemHistory {\r\n        uint256 datetime;\r\n        address referral;\r\n        uint256 amount_invest;\r\n    }\r\n    mapping(address => itemHistory[]) history;\r\n\r\n    uint256 public amount_referral_invest;\r\n\r\n    address public owner;\r\n    address public contractICO;\r\n\r\n    function BMICOAffiliateProgramm(){\r\n        owner = msg.sender;\r\n        contractICO = address(0x0);\r\n    }\r\n\r\n    modifier isOwner()\r\n    {\r\n        assert(msg.sender == owner);\r\n        _;\r\n    }\r\n\r\n    function changeOwner(address new_owner) isOwner {\r\n        assert(new_owner!=address(0x0));\r\n        assert(new_owner!=address(this));\r\n\r\n        owner = new_owner;\r\n    }\r\n\r\n    function setPartnerFromPreICOAffiliate(address[] partners, bytes32[] promo_codes, uint256[] attracted_invests) isOwner {\r\n        assert(partners.length==promo_codes.length && partners.length==attracted_invests.length);\r\n\r\n        for(uint256 i=0; i<partners.length; i++){\r\n            if(!partnersInfo[partners[i]].create){\r\n                partnersPromo[promo_codes[i]] = partners[i];\r\n                partnersInfo[partners[i]].attracted_investments = attracted_invests[i];\r\n                partnersInfo[partners[i]].promo = promo_codes[i];\r\n                partnersInfo[partners[i]].create = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    function setReferralPercent(uint16 new_percent) isOwner {\r\n        ref_percent = new_percent;\r\n    }\r\n\r\n    function setPartnerPercent(address partner, uint16 new_percent) isOwner {\r\n        assert(partner!=address(0x0));\r\n        assert(partner!=address(this));\r\n        assert(partnersInfo[partner].create==true);\r\n        assert(new_percent<=1500);\r\n        partnersInfo[partner].personal_percent = new_percent;\r\n    }\r\n\r\n    function setContractICO(address new_address) isOwner {\r\n        assert(contractICO==address(0x0));\r\n        assert(new_address!=address(0x0));\r\n        assert(new_address!=address(this));\r\n\r\n        contractICO = new_address;\r\n    }\r\n\r\n    function stringTobytes32(string str) constant returns (bytes32){\r\n        bytes32 result;\r\n        assembly {\r\n            result := mload(add(str, 6))\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function str_length(string x) constant internal returns (uint256) {\r\n        return bytes(x).length;\r\n    }\r\n\r\n    function setPromoToPartner(string code) {\r\n        bytes32 promo = stringTobytes32(code);\r\n        assert(partnersPromo[promo]==address(0x0));\r\n        assert(partnersInfo[msg.sender].create==false);\r\n        assert(str_length(code)>0 && str_length(code)<=6);\r\n\r\n        partnersPromo[promo] = msg.sender;\r\n        partnersInfo[msg.sender].attracted_investments = 0;\r\n        partnersInfo[msg.sender].promo = promo;\r\n        partnersInfo[msg.sender].create = true;\r\n    }\r\n\r\n    function checkPromo(string promo) constant returns(bool){\r\n        bytes32 result = stringTobytes32(promo);\r\n        return partnersPromo[result]!=address(0x0);\r\n    }\r\n\r\n    function checkPartner(address partner_address) constant returns(bool isPartner, bytes32 promo){\r\n        isPartner = partnersInfo[partner_address].create;\r\n        promo = '-1';\r\n        if(isPartner){\r\n            promo = partnersInfo[partner_address].promo;\r\n        }\r\n    }\r\n\r\n    function calc_partnerPercent(address partner) constant internal returns(uint16 percent){\r\n        percent = 0;\r\n        if(partnersInfo[partner].personal_percent > 0){\r\n            percent = partnersInfo[partner].personal_percent;\r\n        }\r\n        else{\r\n            uint256 attracted_investments = partnersInfo[partner].attracted_investments;\r\n            if(attracted_investments > 0){\r\n                if(attracted_investments < 3 ether){\r\n                    percent = 300; //1 = 0.01%, 10000 = 100%\r\n                }\r\n                else if(attracted_investments >= 3 ether && attracted_investments < 10 ether){\r\n                    percent = 500;\r\n                }\r\n                else if(attracted_investments >= 10 ether && attracted_investments < 100 ether){\r\n                    percent = 700;\r\n                }\r\n                else if(attracted_investments >= 100 ether){\r\n                    percent = 1000;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function partnerInfo(address partner_address) isOwner constant returns(bytes32 promo, uint256 attracted_investments, uint256[] h_datetime, uint256[] h_invest, address[] h_referrals){\r\n        if(partner_address != address(0x0) && partnersInfo[partner_address].create){\r\n            promo = partnersInfo[partner_address].promo;\r\n            attracted_investments = partnersInfo[partner_address].attracted_investments;\r\n\r\n            h_datetime = new uint256[](history[partner_address].length);\r\n            h_invest = new uint256[](history[partner_address].length);\r\n            h_referrals = new address[](history[partner_address].length);\r\n\r\n            for(uint256 i=0; i<history[partner_address].length; i++){\r\n                h_datetime[i] = history[partner_address][i].datetime;\r\n                h_invest[i] = history[partner_address][i].amount_invest;\r\n                h_referrals[i] = history[partner_address][i].referral;\r\n            }\r\n        }\r\n        else{\r\n            promo = '-1';\r\n            attracted_investments = 0;\r\n            h_datetime = new uint256[](0);\r\n            h_invest = new uint256[](0);\r\n            h_referrals = new address[](0);\r\n        }\r\n    }\r\n\r\n    function referralAmountInvest(address referral) constant external returns (uint256 amount){\r\n        amount = referralsInfo[referral];\r\n    }\r\n\r\n    function add_referral(address referral, string promo, uint256 amount) external returns(address partner, uint256 p_partner, uint256 p_referral){\r\n        bytes32 promo_code = stringTobytes32(promo);\r\n\r\n        p_partner = 0;\r\n        p_referral = 0;\r\n        partner = address(0x0);\r\n        if(partnersPromo[promo_code] != address(0x0) && partnersPromo[promo_code] != referral){\r\n            partner = partnersPromo[promo_code];\r\n            if (msg.sender == contractICO){\r\n                referralsInfo[referral] += amount;\r\n                amount_referral_invest += amount;\r\n                partnersInfo[partner].attracted_investments += amount;\r\n                history[partner].push(itemHistory(now, referral, amount));\r\n                p_partner = (amount*uint256(calc_partnerPercent(partner)))/10000;\r\n                p_referral = (amount*uint256(ref_percent))/10000;\r\n            }\r\n        }\r\n    }\r\n}","ABI":"[{\"constant\":false,\"inputs\":[{\"name\":\"referral\",\"type\":\"address\"},{\"name\":\"promo\",\"type\":\"string\"},{\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"add_referral\",\"outputs\":[{\"name\":\"partner\",\"type\":\"address\"},{\"name\":\"p_partner\",\"type\":\"uint256\"},{\"name\":\"p_referral\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"code\",\"type\":\"string\"}],\"name\":\"setPromoToPartner\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"promo\",\"type\":\"string\"}],\"name\":\"checkPromo\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"partner_address\",\"type\":\"address\"}],\"name\":\"checkPartner\",\"outputs\":[{\"name\":\"isPartner\",\"type\":\"bool\"},{\"name\":\"promo\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"new_address\",\"type\":\"address\"}],\"name\":\"setContractICO\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"amount_referral_invest\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"partner_address\",\"type\":\"address\"}],\"name\":\"partnerInfo\",\"outputs\":[{\"name\":\"promo\",\"type\":\"bytes32\"},{\"name\":\"attracted_investments\",\"type\":\"uint256\"},{\"name\":\"h_datetime\",\"type\":\"uint256[]\"},{\"name\":\"h_invest\",\"type\":\"uint256[]\"},{\"name\":\"h_referrals\",\"type\":\"address[]\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"contractICO\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"new_owner\",\"type\":\"address\"}],\"name\":\"changeOwner\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"referral\",\"type\":\"address\"}],\"name\":\"referralAmountInvest\",\"outputs\":[{\"name\":\"amount\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"partner\",\"type\":\"address\"},{\"name\":\"new_percent\",\"type\":\"uint16\"}],\"name\":\"setPartnerPercent\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"str\",\"type\":\"string\"}],\"name\":\"stringTobytes32\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"new_percent\",\"type\":\"uint16\"}],\"name\":\"setReferralPercent\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"partners\",\"type\":\"address[]\"},{\"name\":\"promo_codes\",\"type\":\"bytes32[]\"},{\"name\":\"attracted_invests\",\"type\":\"uint256[]\"}],\"name\":\"setPartnerFromPreICOAffiliate\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"ref_percent\",\"outputs\":[{\"name\":\"\",\"type\":\"uint16\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"}]","ContractName":"BMICOAffiliateProgramm","CompilerVersion":"v0.4.16+commit.d7661dd9","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://8be0252eb741a9a4e7a46aca7ad6c0f72737b1b428d58f2d59a931c00953e750"}]}