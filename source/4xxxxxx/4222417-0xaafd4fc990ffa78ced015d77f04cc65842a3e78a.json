{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.16;\r\n\r\ncontract Ethraffle_v1b {\r\n    struct Contestant {\r\n        address addr;\r\n        uint raffleId;\r\n    }\r\n\r\n    event RaffleResult(\r\n        uint indexed raffleId,\r\n        uint winningNumber,\r\n        address winningAddress,\r\n        address seed1,\r\n        address seed2,\r\n        uint seed3,\r\n        bytes32 randHash\r\n    );\r\n\r\n    event TicketPurchase(\r\n        uint indexed raffleId,\r\n        address contestant,\r\n        uint number\r\n    );\r\n\r\n    event TicketRefund(\r\n        uint indexed raffleId,\r\n        address contestant,\r\n        uint number\r\n    );\r\n\r\n    // Constants\r\n    uint public constant prize = 2.5 ether;\r\n    uint public constant fee = 0.03 ether;\r\n    uint public constant totalTickets = 50;\r\n    uint public constant pricePerTicket = (prize + fee) / totalTickets; // Make sure this divides evenly\r\n    address feeAddress;\r\n\r\n    // Other internal variables\r\n    bool public paused = false;\r\n    uint public raffleId = 1;\r\n    uint nextTicket = 0;\r\n    mapping (uint => Contestant) contestants;\r\n    uint[] gaps;\r\n\r\n    // Initialization\r\n    function Ethraffle() public {\r\n        feeAddress = msg.sender;\r\n    }\r\n\r\n    // Call buyTickets() when receiving Ether outside a function\r\n    function () payable public {\r\n        buyTickets();\r\n    }\r\n\r\n    function buyTickets() payable public {\r\n        if (paused) {\r\n            msg.sender.transfer(msg.value);\r\n            return;\r\n        }\r\n\r\n        uint moneySent = msg.value;\r\n\r\n        while (moneySent >= pricePerTicket && nextTicket < totalTickets) {\r\n            uint currTicket = 0;\r\n            if (gaps.length > 0) {\r\n                currTicket = gaps[gaps.length-1];\r\n                gaps.length--;\r\n            } else {\r\n                currTicket = nextTicket++;\r\n            }\r\n\r\n            contestants[currTicket] = Contestant(msg.sender, raffleId);\r\n            TicketPurchase(raffleId, msg.sender, currTicket);\r\n            moneySent -= pricePerTicket;\r\n        }\r\n\r\n        // Choose winner if we sold all the tickets\r\n        if (nextTicket == totalTickets) {\r\n            chooseWinner();\r\n        }\r\n\r\n        // Send back leftover money\r\n        if (moneySent > 0) {\r\n            msg.sender.transfer(moneySent);\r\n        }\r\n    }\r\n\r\n    function chooseWinner() private {\r\n        address seed1 = contestants[uint(block.coinbase) % totalTickets].addr;\r\n        address seed2 = contestants[uint(msg.sender) % totalTickets].addr;\r\n        uint seed3 = block.difficulty;\r\n        bytes32 randHash = keccak256(seed1, seed2, seed3);\r\n\r\n        uint winningNumber = uint(randHash) % totalTickets;\r\n        address winningAddress = contestants[winningNumber].addr;\r\n        RaffleResult(raffleId, winningNumber, winningAddress, seed1, seed2, seed3, randHash);\r\n\r\n        // Start next raffle\r\n        raffleId++;\r\n        nextTicket = 0;\r\n\r\n        // gaps.length = 0 isn't necessary here,\r\n        // because buyTickets() eventually clears\r\n        // the gaps array in the loop itself.\r\n\r\n        // Distribute prize and fee\r\n        winningAddress.transfer(prize);\r\n        feeAddress.transfer(fee);\r\n    }\r\n\r\n    // Get your money back before the raffle occurs\r\n    function getRefund() public {\r\n        uint refund = 0;\r\n        for (uint i = 0; i < totalTickets; i++) {\r\n            if (msg.sender == contestants[i].addr && raffleId == contestants[i].raffleId) {\r\n                refund += pricePerTicket;\r\n                contestants[i] = Contestant(address(0), 0);\r\n                gaps.push(i);\r\n                TicketRefund(raffleId, msg.sender, i);\r\n            }\r\n        }\r\n\r\n        if (refund > 0) {\r\n            msg.sender.transfer(refund);\r\n        }\r\n    }\r\n\r\n    // Refund everyone's money, start a new raffle, then pause it\r\n    function endRaffle() public {\r\n        if (msg.sender == feeAddress) {\r\n            paused = true;\r\n\r\n            for (uint i = 0; i < totalTickets; i++) {\r\n                if (raffleId == contestants[i].raffleId) {\r\n                    TicketRefund(raffleId, contestants[i].addr, i);\r\n                    contestants[i].addr.transfer(pricePerTicket);\r\n                }\r\n            }\r\n\r\n            RaffleResult(raffleId, totalTickets, address(0), address(0), address(0), 0, 0);\r\n            raffleId++;\r\n            nextTicket = 0;\r\n            gaps.length = 0;\r\n        }\r\n    }\r\n\r\n    function togglePause() public {\r\n        if (msg.sender == feeAddress) {\r\n            paused = !paused;\r\n        }\r\n    }\r\n\r\n    function kill() public {\r\n        if (msg.sender == feeAddress) {\r\n            selfdestruct(feeAddress);\r\n        }\r\n    }\r\n}","ABI":"[{\"constant\":false,\"inputs\":[],\"name\":\"kill\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"paused\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"Ethraffle\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"getRefund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"raffleId\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"togglePause\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"buyTickets\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalTickets\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"fee\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"prize\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"pricePerTicket\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"endRaffle\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"raffleId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"winningNumber\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"winningAddress\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"seed1\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"seed2\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"seed3\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"randHash\",\"type\":\"bytes32\"}],\"name\":\"RaffleResult\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"raffleId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"contestant\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"number\",\"type\":\"uint256\"}],\"name\":\"TicketPurchase\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"raffleId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"contestant\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"number\",\"type\":\"uint256\"}],\"name\":\"TicketRefund\",\"type\":\"event\"}]","ContractName":"Ethraffle_v1b","CompilerVersion":"v0.4.16+commit.d7661dd9","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://42163dc7d88679c091e1b7174a1577e370b2309436b3e04d4ba2224361b9c421"}]}