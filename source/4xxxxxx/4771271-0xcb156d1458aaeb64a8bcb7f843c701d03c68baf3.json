{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.18;\r\n\r\ncontract Terrus {\r\n  event PlotSale(\r\n    uint indexed _x,\r\n    uint indexed _y,\r\n    address _from,\r\n    address indexed _to,\r\n    uint _price,\r\n    bool _gift\r\n  );\r\n\r\n  event PlotTerrainUpdate(\r\n    uint indexed _x,\r\n    uint indexed _y,\r\n    address indexed _by,\r\n    uint _price,\r\n    bytes32 _newTerrain\r\n  );\r\n\r\n  event Withdrawal(\r\n    address _recipient,\r\n    uint _amount\r\n  );\r\n\r\n  struct Plot {\r\n    bool owned;\r\n    address owner;\r\n    uint x;\r\n    uint y;\r\n    bytes32 terrain;\r\n    uint saleCount;\r\n  }\r\n  mapping(uint => mapping(uint => Plot)) plots;\r\n\r\n  address owner;\r\n\r\n  mapping(uint => mapping(uint => address)) authorisedSaleAddresses;\r\n  mapping(uint => mapping(uint => uint)) authorisedSalePrices;\r\n\r\n  // Constructor\r\n  function Terrus() public {\r\n    owner = msg.sender;\r\n  }\r\n\r\n  // Modifiers\r\n  modifier ownerOnly() {\r\n    require(msg.sender == owner);\r\n    _;\r\n  }\r\n\r\n  modifier validNewTerrain(uint x, uint y, bytes32 newTerrain) {\r\n    // TODO\r\n    _;\r\n  }\r\n\r\n  modifier xyBounded(uint x, uint y) {\r\n    require(x < 1000);\r\n    require(y < 1000);\r\n    _;\r\n  }\r\n\r\n  // Public\r\n  function authoriseSale(uint x, uint y, address buyer, uint amount) public returns (bool) {\r\n    Plot memory plot = plots[x][y];\r\n    require(plot.owned);\r\n    require(plot.owner == msg.sender);\r\n    uint fee = getSaleFee();\r\n    require(amount >= fee);\r\n    authorisedSaleAddresses[x][y] = buyer;\r\n    authorisedSalePrices[x][y] = amount;\r\n    return true;\r\n  }\r\n\r\n  function buyPlot(uint x, uint y) xyBounded(x, y) public payable returns (bool) {\r\n    require(!plots[x][y].owned);\r\n    uint price = getPlotPrice();\r\n    require(price == msg.value);\r\n    address buyer = msg.sender;\r\n    plots[x][y] = Plot({\r\n      owned: true,\r\n      owner: buyer,\r\n      x: x,\r\n      y: y,\r\n      terrain: getInitialTerrain(x, y),\r\n      saleCount: 1\r\n    });\r\n    PlotSale(x, y, 0x0, buyer, price, false);\r\n    return true;\r\n  }\r\n\r\n  function completeSale(uint x, uint y) public payable returns (bool) {\r\n    address buyer = msg.sender;\r\n    require(authorisedSaleAddresses[x][y] != 0x0);\r\n    require(authorisedSaleAddresses[x][y] == buyer);\r\n    require(authorisedSalePrices[x][y] == msg.value);\r\n    uint price = msg.value;\r\n    uint fee = getSaleFee();\r\n    uint forSeller = price - fee;\r\n    Plot storage plot = plots[x][y];\r\n    address seller = plot.owner;\r\n    plot.owner = buyer;\r\n    plot.saleCount += 1;\r\n    authorisedSaleAddresses[x][y] = 0x0;\r\n    authorisedSalePrices[x][y] = 0;\r\n    seller.transfer(forSeller);\r\n    PlotSale(x, y, seller, buyer, price, false);\r\n    return true;\r\n  }\r\n\r\n  function deAuthoriseSale(uint x, uint y) public returns (bool) {\r\n    Plot storage plot = plots[x][y];\r\n    require(plot.owned);\r\n    require(plot.owner == msg.sender);\r\n    authorisedSaleAddresses[x][y] = 0x0;\r\n    authorisedSalePrices[x][y] = 0;\r\n    return true;\r\n  }\r\n\r\n  function getInitialTerrain(uint x, uint y) public pure returns (bytes32) {\r\n    return sha256(x, y);\r\n  }\r\n\r\n  function getOwner() public view returns (address) {\r\n    return owner;\r\n  }\r\n\r\n  function getPlot(uint x, uint y) public xyBounded(x, y) view returns (bool owned, address plotOwner, uint plotX, uint plotY, bytes32 plotTerrain) {\r\n    Plot memory plot = plots[x][y];\r\n    bytes32 terrain = plot.owned ? plot.terrain : getInitialTerrain(x, y);\r\n    return (plot.owned, plot.owner, x, y, terrain);\r\n  }\r\n\r\n  function getPlotPrice() public pure returns (uint) {\r\n    return 0.01 ether;\r\n  }\r\n\r\n  function getSaleFee() public pure returns (uint) {\r\n    return 0.01 ether;\r\n  }\r\n\r\n  function getSetNewTerrainPrice(uint x, uint y, bytes32 newTerrain) public xyBounded(x, y) validNewTerrain(x, y, newTerrain) view returns (uint) {\r\n    Plot memory plot = plots[x][y];\r\n    bytes32 currentTerrain = plot.owned ? plot.terrain : getInitialTerrain(x, y);\r\n    uint changed = 0;\r\n    for (uint i = 0; i < 32; i++) {\r\n      if (newTerrain[i] != currentTerrain[i]) {\r\n        changed += 1;\r\n      }\r\n    }\r\n    uint price = changed * (0.01 ether);\r\n    require(price >= 0);\r\n    return price;\r\n  }\r\n\r\n  function giftPlot(uint x, uint y, address recipient) public ownerOnly xyBounded(x, y) returns (bool) {\r\n    require(!plots[x][y].owned);\r\n    plots[x][y] = Plot({\r\n      owned: true,\r\n      owner: recipient,\r\n      x: x,\r\n      y: y,\r\n      terrain: getInitialTerrain(x, y),\r\n      saleCount: 1\r\n    });\r\n    PlotSale(x, y, 0x0, recipient, 0, true);\r\n    return true;\r\n  }\r\n\r\n  function ping() public pure returns (bytes4) {\r\n    return \"pong\";\r\n  }\r\n\r\n  // TODO TEST\r\n  function setNewTerrain(uint x, uint y, bytes32 newTerrain) public xyBounded(x, y) validNewTerrain(x, y, newTerrain) payable returns (bool) {\r\n    Plot storage plot = plots[x][y];\r\n    require(plot.owned);\r\n    require(plot.owner == msg.sender);\r\n    uint setPrice = getSetNewTerrainPrice(x, y, newTerrain);\r\n    require(msg.value == setPrice);\r\n    plot.terrain = newTerrain;\r\n    PlotTerrainUpdate(x, y, msg.sender, msg.value, newTerrain);\r\n    return true;\r\n  }\r\n\r\n  function setOwner(address newOwner) public ownerOnly returns (bool) {\r\n    owner = newOwner;\r\n    return true;\r\n  }\r\n\r\n  function withdrawEther(uint amount) public ownerOnly returns (bool) {\r\n    require(this.balance >= amount);\r\n    address recipient = msg.sender;\r\n    recipient.transfer(amount);\r\n    Withdrawal(recipient, amount);\r\n    return true;\r\n  }\r\n}","ABI":"[{\"constant\":false,\"inputs\":[{\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"setOwner\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"name\":\"getPlot\",\"outputs\":[{\"name\":\"owned\",\"type\":\"bool\"},{\"name\":\"plotOwner\",\"type\":\"address\"},{\"name\":\"plotX\",\"type\":\"uint256\"},{\"name\":\"plotY\",\"type\":\"uint256\"},{\"name\":\"plotTerrain\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"name\":\"deAuthoriseSale\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"withdrawEther\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"name\":\"completeSale\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"ping\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes4\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"name\":\"getInitialTerrain\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"},{\"name\":\"newTerrain\",\"type\":\"bytes32\"}],\"name\":\"setNewTerrain\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getOwner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"name\":\"buyPlot\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getSaleFee\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getPlotPrice\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"},{\"name\":\"buyer\",\"type\":\"address\"},{\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"authoriseSale\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"},{\"name\":\"newTerrain\",\"type\":\"bytes32\"}],\"name\":\"getSetNewTerrainPrice\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"},{\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"giftPlot\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_x\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"_y\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"_from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_price\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"_gift\",\"type\":\"bool\"}],\"name\":\"PlotSale\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_x\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"_y\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"_by\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_price\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"_newTerrain\",\"type\":\"bytes32\"}],\"name\":\"PlotTerrainUpdate\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"_recipient\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"Withdrawal\",\"type\":\"event\"}]","ContractName":"Terrus","CompilerVersion":"v0.4.19+commit.c4cbbb05","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://8b5dfe17a02a7ae956c2b69494dc0eadde35dba9639f2fcec66a9752882610fa"}]}