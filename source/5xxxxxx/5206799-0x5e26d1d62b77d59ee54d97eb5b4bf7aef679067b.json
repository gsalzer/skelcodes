{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity 0.4.15;\r\n\r\n\r\ncontract Owned {\r\n    address public owner;\r\n    modifier onlyOwner() {\r\n        require(isOwner(msg.sender));\r\n        _;\r\n    }\r\n\r\n    function Owned() { owner = msg.sender; }\r\n\r\n    function isOwner(address addr) public returns(bool) { return addr == owner; }\r\n\r\n    function transfer(address newOwner) public onlyOwner {\r\n        if (newOwner != address(this)) {\r\n            owner = newOwner;\r\n        }\r\n    }\r\n}\r\n\r\ncontract Proxy is Owned {\r\n    event Forwarded (address indexed destination, uint value, bytes data);\r\n    event Received (address indexed sender, uint value);\r\n\r\n    function () payable { Received(msg.sender, msg.value); }\r\n\r\n    function forward(address destination, uint value, bytes data) public onlyOwner {\r\n        require(executeCall(destination, value, data));\r\n        Forwarded(destination, value, data);\r\n    }\r\n\r\n    // copied from GnosisSafe\r\n    // https://github.com/gnosis/gnosis-safe-contracts/blob/master/contracts/GnosisSafe.sol\r\n    function executeCall(address to, uint256 value, bytes data) internal returns (bool success) {\r\n        assembly {\r\n            success := call(gas, to, value, add(data, 0x20), mload(data), 0, 0)\r\n        }\r\n    }\r\n}\r\n\r\n\r\ncontract IdentityManager {\r\n    uint adminTimeLock;\r\n    uint userTimeLock;\r\n    uint adminRate;\r\n\r\n    event LogIdentityCreated(\r\n        address indexed identity,\r\n        address indexed creator,\r\n        address owner,\r\n        address indexed recoveryKey);\r\n\r\n    event LogOwnerAdded(\r\n        address indexed identity,\r\n        address indexed owner,\r\n        address instigator);\r\n\r\n    event LogOwnerRemoved(\r\n        address indexed identity,\r\n        address indexed owner,\r\n        address instigator);\r\n\r\n    event LogRecoveryChanged(\r\n        address indexed identity,\r\n        address indexed recoveryKey,\r\n        address instigator);\r\n\r\n    event LogMigrationInitiated(\r\n        address indexed identity,\r\n        address indexed newIdManager,\r\n        address instigator);\r\n\r\n    event LogMigrationCanceled(\r\n        address indexed identity,\r\n        address indexed newIdManager,\r\n        address instigator);\r\n\r\n    event LogMigrationFinalized(\r\n        address indexed identity,\r\n        address indexed newIdManager,\r\n        address instigator);\r\n\r\n    mapping(address => mapping(address => uint)) owners;\r\n    mapping(address => address) recoveryKeys;\r\n    mapping(address => mapping(address => uint)) limiter;\r\n    mapping(address => uint) public migrationInitiated;\r\n    mapping(address => address) public migrationNewAddress;\r\n\r\n    modifier onlyOwner(address identity) {\r\n        require(isOwner(identity, msg.sender));\r\n        _;\r\n    }\r\n\r\n    modifier onlyOlderOwner(address identity) {\r\n        require(isOlderOwner(identity, msg.sender));\r\n        _;\r\n    }\r\n\r\n    modifier onlyRecovery(address identity) {\r\n        require(recoveryKeys[identity] == msg.sender);\r\n        _;\r\n    }\r\n\r\n    modifier rateLimited(address identity) {\r\n        require(limiter[identity][msg.sender] < (now - adminRate));\r\n        limiter[identity][msg.sender] = now;\r\n        _;\r\n    }\r\n\r\n    modifier validAddress(address addr) { //protects against some weird attacks\r\n        require(addr != address(0));\r\n        _;\r\n    }\r\n\r\n    /// @dev Contract constructor sets initial timelock limits\r\n    /// @param _userTimeLock Time before new owner added by recovery can control proxy\r\n    /// @param _adminTimeLock Time before new owner can add/remove owners\r\n    /// @param _adminRate Time period used for rate limiting a given key for admin functionality\r\n    function IdentityManager(uint _userTimeLock, uint _adminTimeLock, uint _adminRate) {\r\n        require(_adminTimeLock >= _userTimeLock);\r\n        adminTimeLock = _adminTimeLock;\r\n        userTimeLock = _userTimeLock;\r\n        adminRate = _adminRate;\r\n    }\r\n\r\n    /// @dev Creates a new proxy contract for an owner and recovery\r\n    /// @param owner Key who can use this contract to control proxy. Given full power\r\n    /// @param recoveryKey Key of recovery network or address from seed to recovery proxy\r\n    /// Gas cost of 289,311\r\n    function createIdentity(address owner, address recoveryKey) public validAddress(recoveryKey) {\r\n        Proxy identity = new Proxy();\r\n        owners[identity][owner] = now - adminTimeLock; // This is to ensure original owner has full power from day one\r\n        recoveryKeys[identity] = recoveryKey;\r\n        LogIdentityCreated(identity, msg.sender, owner,  recoveryKey);\r\n    }\r\n\r\n    /// @dev Creates a new proxy contract for an owner and recovery and allows an initial forward call which would be to set the registry in our case\r\n    /// @param owner Key who can use this contract to control proxy. Given full power\r\n    /// @param recoveryKey Key of recovery network or address from seed to recovery proxy\r\n    /// @param destination Address of contract to be called after proxy is created\r\n    /// @param data of function to be called at the destination contract\r\n    function createIdentityWithCall(address owner, address recoveryKey, address destination, bytes data) public validAddress(recoveryKey) {\r\n        Proxy identity = new Proxy();\r\n        owners[identity][owner] = now - adminTimeLock; // This is to ensure original owner has full power from day one\r\n        recoveryKeys[identity] = recoveryKey;\r\n        LogIdentityCreated(identity, msg.sender, owner,  recoveryKey);\r\n        identity.forward(destination, 0, data);\r\n    }\r\n\r\n    /// @dev Allows a user to transfer control of existing proxy to this contract. Must come through proxy\r\n    /// @param owner Key who can use this contract to control proxy. Given full power\r\n    /// @param recoveryKey Key of recovery network or address from seed to recovery proxy\r\n    /// Note: User must change owner of proxy to this contract after calling this\r\n    function registerIdentity(address owner, address recoveryKey) public validAddress(recoveryKey) {\r\n        require(recoveryKeys[msg.sender] == 0); // Deny any funny business\r\n        owners[msg.sender][owner] = now - adminTimeLock; // This is to ensure original owner has full power from day one\r\n        recoveryKeys[msg.sender] = recoveryKey;\r\n        LogIdentityCreated(msg.sender, msg.sender, owner, recoveryKey);\r\n    }\r\n\r\n    /// @dev Allows a user to forward a call through their proxy.\r\n    function forwardTo(Proxy identity, address destination, uint value, bytes data) public onlyOwner(identity) {\r\n        identity.forward(destination, value, data);\r\n    }\r\n\r\n    /// @dev Allows an olderOwner to add a new owner instantly\r\n    function addOwner(Proxy identity, address newOwner) public onlyOlderOwner(identity) rateLimited(identity) {\r\n        require(!isOwner(identity, newOwner));\r\n        owners[identity][newOwner] = now - userTimeLock;\r\n        LogOwnerAdded(identity, newOwner, msg.sender);\r\n    }\r\n\r\n    /// @dev Allows a recoveryKey to add a new owner with userTimeLock waiting time\r\n    function addOwnerFromRecovery(Proxy identity, address newOwner) public onlyRecovery(identity) rateLimited(identity) {\r\n        require(!isOwner(identity, newOwner));\r\n        owners[identity][newOwner] = now;\r\n        LogOwnerAdded(identity, newOwner, msg.sender);\r\n    }\r\n\r\n    /// @dev Allows an owner to remove another owner instantly\r\n    function removeOwner(Proxy identity, address owner) public onlyOlderOwner(identity) rateLimited(identity) {\r\n        // an owner should not be allowed to remove itself\r\n        require(msg.sender != owner);\r\n        delete owners[identity][owner];\r\n        LogOwnerRemoved(identity, owner, msg.sender);\r\n    }\r\n\r\n    /// @dev Allows an owner to change the recoveryKey instantly\r\n    function changeRecovery(Proxy identity, address recoveryKey) public\r\n        onlyOlderOwner(identity)\r\n        rateLimited(identity)\r\n        validAddress(recoveryKey)\r\n    {\r\n        recoveryKeys[identity] = recoveryKey;\r\n        LogRecoveryChanged(identity, recoveryKey, msg.sender);\r\n    }\r\n\r\n    /// @dev Allows an owner to begin process of transfering proxy to new IdentityManager\r\n    function initiateMigration(Proxy identity, address newIdManager) public\r\n        onlyOlderOwner(identity)\r\n        validAddress(newIdManager)\r\n    {\r\n        migrationInitiated[identity] = now;\r\n        migrationNewAddress[identity] = newIdManager;\r\n        LogMigrationInitiated(identity, newIdManager, msg.sender);\r\n    }\r\n\r\n    /// @dev Allows an owner to cancel the process of transfering proxy to new IdentityManager\r\n    function cancelMigration(Proxy identity) public onlyOwner(identity) {\r\n        address canceledManager = migrationNewAddress[identity];\r\n        delete migrationInitiated[identity];\r\n        delete migrationNewAddress[identity];\r\n        LogMigrationCanceled(identity, canceledManager, msg.sender);\r\n    }\r\n\r\n    /// @dev Allows an owner to finalize migration once adminTimeLock time has passed\r\n    /// WARNING: before transfering to a new address, make sure this address is \"ready to recieve\" the proxy.\r\n    /// Not doing so risks the proxy becoming stuck.\r\n    function finalizeMigration(Proxy identity) public onlyOlderOwner(identity) {\r\n        require(migrationInitiated[identity] != 0 && migrationInitiated[identity] + adminTimeLock < now);\r\n        address newIdManager = migrationNewAddress[identity];\r\n        delete migrationInitiated[identity];\r\n        delete migrationNewAddress[identity];\r\n        identity.transfer(newIdManager);\r\n        delete recoveryKeys[identity];\r\n        // We can only delete the owner that we know of. All other owners\r\n        // needs to be removed before a call to this method.\r\n        delete owners[identity][msg.sender];\r\n        LogMigrationFinalized(identity, newIdManager, msg.sender);\r\n    }\r\n\r\n    function isOwner(address identity, address owner) public constant returns (bool) {\r\n        return (owners[identity][owner] > 0 && (owners[identity][owner] + userTimeLock) <= now);\r\n    }\r\n\r\n    function isOlderOwner(address identity, address owner) public constant returns (bool) {\r\n        return (owners[identity][owner] > 0 && (owners[identity][owner] + adminTimeLock) <= now);\r\n    }\r\n\r\n    function isRecovery(address identity, address recoveryKey) public constant returns (bool) {\r\n        return recoveryKeys[identity] == recoveryKey;\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"recoveryKey\",\"type\":\"address\"}],\"name\":\"isRecovery\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"addOwner\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"isOlderOwner\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"owner\",\"type\":\"address\"},{\"name\":\"recoveryKey\",\"type\":\"address\"},{\"name\":\"destination\",\"type\":\"address\"},{\"name\":\"data\",\"type\":\"bytes\"}],\"name\":\"createIdentityWithCall\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"newIdManager\",\"type\":\"address\"}],\"name\":\"initiateMigration\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"migrationNewAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"addOwnerFromRecovery\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"recoveryKey\",\"type\":\"address\"}],\"name\":\"changeRecovery\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"}],\"name\":\"finalizeMigration\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"}],\"name\":\"cancelMigration\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"destination\",\"type\":\"address\"},{\"name\":\"value\",\"type\":\"uint256\"},{\"name\":\"data\",\"type\":\"bytes\"}],\"name\":\"forwardTo\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"owner\",\"type\":\"address\"},{\"name\":\"recoveryKey\",\"type\":\"address\"}],\"name\":\"registerIdentity\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"isOwner\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"migrationInitiated\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"owner\",\"type\":\"address\"},{\"name\":\"recoveryKey\",\"type\":\"address\"}],\"name\":\"createIdentity\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"identity\",\"type\":\"address\"},{\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"removeOwner\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"inputs\":[{\"name\":\"_userTimeLock\",\"type\":\"uint256\"},{\"name\":\"_adminTimeLock\",\"type\":\"uint256\"},{\"name\":\"_adminRate\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"identity\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"creator\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"recoveryKey\",\"type\":\"address\"}],\"name\":\"LogIdentityCreated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"identity\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"instigator\",\"type\":\"address\"}],\"name\":\"LogOwnerAdded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"identity\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"instigator\",\"type\":\"address\"}],\"name\":\"LogOwnerRemoved\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"identity\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"recoveryKey\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"instigator\",\"type\":\"address\"}],\"name\":\"LogRecoveryChanged\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"identity\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"newIdManager\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"instigator\",\"type\":\"address\"}],\"name\":\"LogMigrationInitiated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"identity\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"newIdManager\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"instigator\",\"type\":\"address\"}],\"name\":\"LogMigrationCanceled\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"identity\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"newIdManager\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"instigator\",\"type\":\"address\"}],\"name\":\"LogMigrationFinalized\",\"type\":\"event\"}]","ContractName":"IdentityManager","CompilerVersion":"v0.4.15+commit.bbb8e64f","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"0000000000000000000000000000000000000000000000000000000000000e10000000000000000000000000000000000000000000000000000000000001fa4000000000000000000000000000000000000000000000000000000000000004b0","Library":"","SwarmSource":"bzzr://0014d150a5111642f713577bb13892cd30f4752b5b55434f591f19fb0c25d8c4"}]}