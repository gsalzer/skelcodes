{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.22;\r\n\r\n/// @title ERC-721に準拠した契約のインタフェース\r\ncontract ERC721 {\r\n    // イベント\r\n    event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);\r\n    event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);\r\n\r\n    // 必要なメソッド\r\n    function balanceOf(address _owner) public view returns (uint256 _balance);\r\n    function ownerOf(uint256 _tokenId) external view returns (address _owner);\r\n    function approve(address _to, uint256 _tokenId) external;\r\n    function transfer(address _to, uint256 _tokenId) public;\r\n    function transferFrom(address _from, address _to, uint256 _tokenId) public;\r\n    function totalSupply() public view returns (uint);\r\n\r\n    // ERC-165 Compatibility (https://github.com/ethereum/EIPs/issues/165)\r\n    function supportsInterface(bytes4 _interfaceID) external view returns (bool);\r\n}\r\n\r\n/**\r\n * @title Ownable\r\n * @dev The Ownable contract has an owner address, and provides basic authorization control\r\n * functions, this simplifies the implementation of \"user permissions\".\r\n */\r\ncontract Ownable {\r\n    address public owner;\r\n\r\n    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);\r\n\r\n    /**\r\n    * @dev The Ownable constructor sets the original `owner` of the contract to the sender\r\n    * account.\r\n    */\r\n    function Ownable() public {\r\n        owner = msg.sender;\r\n    }\r\n\r\n\r\n    /**\r\n    * @dev Throws if called by any account other than the owner.\r\n    */\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n\r\n\r\n    /**\r\n    * @dev Allows the current owner to transfer control of the contract to a newOwner.\r\n    * @param newOwner The address to transfer ownership to.\r\n    */\r\n    function transferOwnership(address newOwner) public onlyOwner {\r\n        require(newOwner != address(0));\r\n        emit OwnershipTransferred(owner, newOwner);\r\n        owner = newOwner;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * @title Pausable\r\n * @dev Base contract which allows children to implement an emergency stop mechanism.\r\n */\r\ncontract Pausable is Ownable {\r\n    event Pause();\r\n    event Unpause();\r\n\r\n    bool public paused = false;\r\n\r\n\r\n    /**\r\n    * @dev Modifier to make a function callable only when the contract is not paused.\r\n    *               契約が一時停止されている場合にのみアクションを許可する\r\n    */\r\n    modifier whenNotPaused() {\r\n        require(!paused);\r\n        _;\r\n    }\r\n\r\n    /**\r\n    * @dev Modifier to make a function callable only when the contract is paused.\r\n    *               契約が一時停止されていない場合にのみアクションを許可する\r\n    */\r\n    modifier whenPaused() {\r\n        require(paused);\r\n        _;\r\n    }\r\n\r\n    /**\r\n    * @dev called by the owner to pause, triggers stopped state\r\n    *             一時停止するために所有者によって呼び出され、停止状態をトリガする\r\n    */\r\n    function pause() onlyOwner whenNotPaused public {\r\n        paused = true;\r\n        emit Pause();\r\n    }\r\n\r\n    /**\r\n    * @dev called by the owner to unpause, returns to normal state\r\n    *             ポーズをとるためにオーナーが呼び出し、通常の状態に戻ります\r\n    */\r\n    function unpause() onlyOwner whenPaused public {\r\n        paused = false;\r\n        emit Unpause();\r\n    }\r\n}\r\n\r\ncontract RocsCoreRe {\r\n\r\n    function getRoc(uint _tokenId) public returns (\r\n        uint rocId,\r\n        string dna,\r\n        uint marketsFlg);\r\n\r\n    function getRocIdToTokenId(uint _rocId) public view returns (uint);\r\n    function getRocIndexToOwner(uint _rocId) public view returns (address);\r\n}\r\n\r\ncontract ItemsBase is Pausable {\r\n    // ハント代\r\n    uint public huntingPrice = 5 finney;\r\n    function setHuntingPrice(uint256 price) public onlyOwner {\r\n        huntingPrice = price;\r\n    }\r\n\r\n    // ERC721\r\n    event Transfer(address from, address to, uint tokenId);\r\n    event ItemTransfer(address from, address to, uint tokenId);\r\n\r\n    // Itemの作成\r\n    event ItemCreated(address owner, uint tokenId, uint ticketId);\r\n\r\n    event HuntingCreated(uint huntingId, uint rocId);\r\n\r\n    /// @dev Itemの構造体\r\n    struct Item {\r\n        uint itemId;\r\n        uint8 marketsFlg;\r\n        uint rocId;\r\n        uint8 equipmentFlg;\r\n    }\r\n    Item[] public items;\r\n\r\n    // itemIdとtokenIdのマッピング\r\n    mapping(uint => uint) public itemIndex;\r\n    // itemIdからtokenIdを取得\r\n    function getItemIdToTokenId(uint _itemId) public view returns (uint) {\r\n        return itemIndex[_itemId];\r\n    }\r\n\r\n    /// @dev itemの所有するアドレスへのマッピング\r\n    mapping (uint => address) public itemIndexToOwner;\r\n    // @dev itemの所有者アドレスから所有するトークン数へのマッピング\r\n    mapping (address => uint) public itemOwnershipTokenCount;\r\n    /// @dev itemの呼び出しが承認されたアドレスへのマッピング\r\n    mapping (uint => address) public itemIndexToApproved;\r\n\r\n    /// @dev 特定のitem所有権をアドレスに割り当てます。\r\n    function _transfer(address _from, address _to, uint256 _tokenId) internal {\r\n        itemOwnershipTokenCount[_to]++;\r\n        itemOwnershipTokenCount[_from]--;\r\n        itemIndexToOwner[_tokenId] = _to;\r\n        // イベント開始\r\n        emit ItemTransfer(_from, _to, _tokenId);\r\n    }\r\n\r\n    address public rocCoreAddress;\r\n    RocsCoreRe rocCore;\r\n\r\n    function setRocCoreAddress(address _rocCoreAddress) public onlyOwner {\r\n        rocCoreAddress = _rocCoreAddress;\r\n        rocCore = RocsCoreRe(rocCoreAddress);\r\n    }\r\n    function getRocCoreAddress() \r\n        external\r\n        view\r\n        onlyOwner\r\n        returns (\r\n        address\r\n    ) {\r\n        return rocCore;\r\n    }\r\n\r\n    /// @dev Huntingの構造体\r\n    struct Hunting {\r\n        uint huntingId;\r\n    }\r\n    // Huntingのmapping rocHuntingIndex[rocId][tokenId] = Hunting\r\n    mapping(uint => mapping (uint => Hunting)) public rocHuntingIndex;\r\n\r\n    /// @notice Huntingを作成して保存する内部メソッド。 \r\n    /// @param _rocId \r\n    /// @param _huntingId \r\n    function _createRocHunting(\r\n        uint _rocId,\r\n        uint _huntingId\r\n    )\r\n        internal\r\n        returns (bool)\r\n    {\r\n        Hunting memory _hunting = Hunting({\r\n            huntingId: _huntingId\r\n        });\r\n\r\n        rocHuntingIndex[_rocId][_huntingId] = _hunting;\r\n        // HuntingCreatedイベント\r\n        emit HuntingCreated(_huntingId, _rocId);\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\n/// @title Item所有権を管理するコントラクト\r\n/// @dev OpenZeppelinのERC721ドラフト実装に準拠\r\ncontract ItemsOwnership is ItemsBase, ERC721 {\r\n\r\n    /// @notice ERC721で定義されている、置き換え不可能なトークンの名前と記号。\r\n    string public constant name = \"CryptoFeatherItems\";\r\n    string public constant symbol = \"CCHI\";\r\n\r\n    bytes4 constant InterfaceSignature_ERC165 = \r\n    bytes4(keccak256('supportsInterface(bytes4)'));\r\n\r\n    bytes4 constant InterfaceSignature_ERC721 =\r\n    bytes4(keccak256('name()')) ^\r\n    bytes4(keccak256('symbol()')) ^\r\n    bytes4(keccak256('balanceOf(address)')) ^\r\n    bytes4(keccak256('ownerOf(uint256)')) ^\r\n    bytes4(keccak256('approve(address,uint256)')) ^\r\n    bytes4(keccak256('transfer(address,uint256)')) ^\r\n    bytes4(keccak256('transferFrom(address,address,uint256)')) ^\r\n    bytes4(keccak256('totalSupply()'));\r\n\r\n    /// @notice Introspection interface as per ERC-165 (https://github.com/ethereum/EIPs/issues/165).\r\n    ///  この契約によって実装された標準化されたインタフェースでtrueを返します。\r\n    function supportsInterface(bytes4 _interfaceID) external view returns (bool)\r\n    {\r\n        // DEBUG ONLY\r\n        //require((InterfaceSignature_ERC165 == 0x01ffc9a7) && (InterfaceSignature_ERC721 == 0x9a20483d));\r\n        return ((_interfaceID == InterfaceSignature_ERC165) || (_interfaceID == InterfaceSignature_ERC721));\r\n    }\r\n\r\n    /// @dev 特定のアドレスに指定されたitemの現在の所有者であるかどうかをチェックします。\r\n    /// @param _claimant \r\n    /// @param _tokenId \r\n    function _owns(address _claimant, uint256 _tokenId) internal view returns (bool) {\r\n        return itemIndexToOwner[_tokenId] == _claimant;\r\n    }\r\n\r\n    /// @dev 特定のアドレスに指定されたitemが存在するかどうかをチェックします。\r\n    /// @param _claimant the address we are confirming kitten is approved for.\r\n    /// @param _tokenId kitten id, only valid when > 0\r\n    function _approvedFor(address _claimant, uint256 _tokenId) internal view returns (bool) {\r\n        return itemIndexToApproved[_tokenId] == _claimant;\r\n    }\r\n\r\n    /// @dev 以前の承認を上書きして、transferFrom（）に対して承認されたアドレスをマークします。\r\n    function _approve(uint256 _tokenId, address _approved) internal {\r\n        itemIndexToApproved[_tokenId] = _approved;\r\n    }\r\n\r\n    // 指定されたアドレスのitem数を取得します。\r\n    function balanceOf(address _owner) public view returns (uint256 count) {\r\n        return itemOwnershipTokenCount[_owner];\r\n    }\r\n\r\n    /// @notice itemの所有者を変更します。\r\n    /// @dev ERC-721への準拠に必要\r\n    function transfer(address _to, uint256 _tokenId) public whenNotPaused {\r\n        // 安全チェック\r\n        require(_to != address(0));\r\n        // 自分のitemしか送ることはできません。\r\n        require(_owns(msg.sender, _tokenId));\r\n        // 所有権の再割り当て、保留中の承認のクリア、転送イベントの送信\r\n        _transfer(msg.sender, _to, _tokenId);\r\n    }\r\n\r\n    /// @notice transferFrom（）を介して別のアドレスに特定のitemを転送する権利を与えます。\r\n    /// @dev ERC-721への準拠に必要\r\n    function approve(address _to, uint256 _tokenId) external whenNotPaused {\r\n        // 所有者のみが譲渡承認を認めることができます。\r\n        require(_owns(msg.sender, _tokenId));\r\n        // 承認を登録します（以前の承認を置き換えます）。\r\n        _approve(_tokenId, _to);\r\n        // 承認イベントを発行する。\r\n        emit Approval(msg.sender, _to, _tokenId);\r\n    }\r\n\r\n    /// @notice item所有者の変更を行います。を転送します。そのアドレスには、以前の所有者から転送承認が与えられています。\r\n    /// @dev ERC-721への準拠に必要\r\n    function transferFrom(address _from, address _to, uint256 _tokenId) public whenNotPaused {\r\n        // 安全チェック。\r\n        require(_to != address(0));\r\n        // 承認と有効な所有権の確認\r\n        require(_approvedFor(msg.sender, _tokenId));\r\n        require(_owns(_from, _tokenId));\r\n        // 所有権を再割り当てします（保留中の承認をクリアし、転送イベントを発行します）。\r\n        _transfer(_from, _to, _tokenId);\r\n    }\r\n\r\n    /// @notice 現在存在するitemの総数を返します。\r\n    /// @dev ERC-721への準拠に必要です。\r\n    function totalSupply() public view returns (uint) {\r\n        return items.length - 1;\r\n    }\r\n\r\n    /// @notice 指定されたitemの現在所有権が割り当てられているアドレスを返します。\r\n    /// @dev ERC-721への準拠に必要です。\r\n    function ownerOf(uint256 _tokenId) external view returns (address owner) {\r\n        owner = itemIndexToOwner[_tokenId];\r\n        require(owner != address(0));\r\n    }\r\n\r\n    /// @dev この契約に所有権を割り当て、NFTを強制終了します。\r\n    /// @param _owner \r\n    /// @param _tokenId \r\n    function _escrow(address _owner, uint256 _tokenId) internal {\r\n        // it will throw if transfer fails\r\n        transferFrom(_owner, this, _tokenId);\r\n    }\r\n\r\n}\r\n\r\n/// @title Itemに関する管理を行うコントラクト\r\ncontract ItemsBreeding is ItemsOwnership {\r\n\r\n    /// @notice Itemを作成して保存。 \r\n    /// @param _itemId \r\n    /// @param _marketsFlg \r\n    /// @param _rocId \r\n    /// @param _equipmentFlg \r\n    /// @param _owner \r\n    function _createItem(\r\n        uint _itemId,\r\n        uint _marketsFlg,\r\n        uint _rocId,\r\n        uint _equipmentFlg,\r\n        address _owner\r\n    )\r\n        internal\r\n        returns (uint)\r\n    {\r\n        Item memory _item = Item({\r\n            itemId: _itemId,\r\n            marketsFlg: uint8(_marketsFlg),\r\n            rocId: _rocId,\r\n            equipmentFlg: uint8(_equipmentFlg)\r\n        });\r\n\r\n        uint newItemId = items.push(_item) - 1;\r\n        // 同一のトークンIDが発生した場合は実行を停止します\r\n        require(newItemId == uint(newItemId));\r\n        // RocCreatedイベント\r\n        emit ItemCreated(_owner, newItemId, _itemId);\r\n\r\n        // これにより所有権が割り当てられ、ERC721ドラフトごとに転送イベントが発行されます\r\n        itemIndex[_itemId] = newItemId;\r\n        _transfer(0, _owner, newItemId);\r\n\r\n        return newItemId;\r\n    }\r\n\r\n    /// @notice アイテムの装備状態を更新します。 \r\n    /// @param _reItems \r\n    /// @param _inItems \r\n    /// @param _rocId \r\n    function equipmentItem(\r\n        uint[] _reItems,\r\n        uint[] _inItems,\r\n        uint _rocId\r\n    )\r\n        external\r\n        whenNotPaused\r\n        returns(bool)\r\n    {\r\n        uint checkTokenId = rocCore.getRocIdToTokenId(_rocId);\r\n        uint i;\r\n        uint itemTokenId;\r\n        Item memory item;\r\n        // 解除\r\n        for (i = 0; i < _reItems.length; i++) {\r\n            itemTokenId = getItemIdToTokenId(_reItems[i]);\r\n            // itemのパラメータチェック\r\n            item = items[itemTokenId];\r\n            // マーケットへの出品中か確認してください。\r\n            require(uint(item.marketsFlg) == 0);\r\n            // アイテム装着中か確認してください。\r\n            require(uint(item.equipmentFlg) == 1);\r\n            // 装着チックが同一か確認してください。\r\n            require(uint(item.rocId) == _rocId);\r\n            // 装備解除\r\n            items[itemTokenId].rocId = 0;\r\n            items[itemTokenId].equipmentFlg = 0;\r\n            // アイテムのオーナーが違えばチックのオーナーをセットしなおします。\r\n            address itemOwner = itemIndexToOwner[itemTokenId];\r\n            address checkOwner = rocCore.getRocIndexToOwner(checkTokenId);\r\n            if (itemOwner != checkOwner) {\r\n                itemIndexToOwner[itemTokenId] = checkOwner;\r\n            }\r\n        }\r\n        // 装着\r\n        for (i = 0; i < _inItems.length; i++) {\r\n            itemTokenId = getItemIdToTokenId(_inItems[i]);\r\n            // itemのパラメータチェック\r\n            item = items[itemTokenId];\r\n            // itemのオーナーである事\r\n            require(_owns(msg.sender, itemTokenId));\r\n            // マーケットへの出品中か確認してください。\r\n            require(uint(item.marketsFlg) == 0);\r\n            // アイテム未装備か確認してください。\r\n            require(uint(item.equipmentFlg) == 0);\r\n            // 装備処理\r\n            items[itemTokenId].rocId = _rocId;\r\n            items[itemTokenId].equipmentFlg = 1;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /// @notice 消費した事で削除の処理を行います。\r\n    /// @param _itemId \r\n    function usedItem(\r\n        uint _itemId\r\n    )\r\n        external\r\n        whenNotPaused\r\n        returns(bool)\r\n    {\r\n        uint itemTokenId = getItemIdToTokenId(_itemId);\r\n        Item memory item = items[itemTokenId];\r\n        // itemのオーナーである事\r\n        require(_owns(msg.sender, itemTokenId));\r\n        // マーケットへの出品中か確認してください。\r\n        require(uint(item.marketsFlg) == 0);\r\n        // アイテム未装備か確認してください。\r\n        require(uint(item.equipmentFlg) == 0);\r\n        delete itemIndex[_itemId];\r\n        delete items[itemTokenId];\r\n        delete itemIndexToOwner[itemTokenId];\r\n        return true;\r\n    }\r\n\r\n    /// @notice Huntingの処理を行います。\r\n    /// @param _rocId \r\n    /// @param _huntingId \r\n    /// @param _items \r\n    function processHunting(\r\n        uint _rocId,\r\n        uint _huntingId,\r\n        uint[] _items\r\n    )\r\n        external\r\n        payable\r\n        whenNotPaused\r\n        returns(bool)\r\n    {\r\n        require(msg.value >= huntingPrice);\r\n\r\n        uint checkTokenId = rocCore.getRocIdToTokenId(_rocId);\r\n        uint marketsFlg;\r\n        ( , , marketsFlg) = rocCore.getRoc(checkTokenId);\r\n\r\n        // markets中か確認してください。\r\n        require(marketsFlg == 0);\r\n        bool createHunting = false;\r\n        // Hunting処理\r\n        require(_huntingId > 0);\r\n        createHunting = _createRocHunting(\r\n            _rocId,\r\n            _huntingId\r\n        );\r\n\r\n        uint i;\r\n        for (i = 0; i < _items.length; i++) {\r\n            _createItem(\r\n                _items[i],\r\n                0,\r\n                0,\r\n                0,\r\n                msg.sender\r\n            );\r\n        }\r\n\r\n        // 超過分を買い手に返す\r\n        uint256 bidExcess = msg.value - huntingPrice;\r\n        msg.sender.transfer(bidExcess);\r\n\r\n        return createHunting;\r\n    }\r\n\r\n    /// @notice Itemを作成します。イベント用\r\n    /// @param _items \r\n    /// @param _owners \r\n    function createItems(\r\n        uint[] _items,\r\n        address[] _owners\r\n    )\r\n        external onlyOwner\r\n        returns (uint)\r\n    {\r\n        uint i;\r\n        uint createItemId;\r\n        for (i = 0; i < _items.length; i++) {\r\n            createItemId = _createItem(\r\n                _items[i],\r\n                0,\r\n                0,\r\n                0,\r\n                _owners[i]\r\n            );\r\n        }\r\n        return createItemId;\r\n    }\r\n\r\n}\r\n\r\n/// @title ItemのMarketに関する処理\r\ncontract ItemsMarkets is ItemsBreeding {\r\n\r\n    event ItemMarketsCreated(uint256 tokenId, uint128 marketsPrice);\r\n    event ItemMarketsSuccessful(uint256 tokenId, uint128 marketsPriceice, address buyer);\r\n    event ItemMarketsCancelled(uint256 tokenId);\r\n\r\n    // ERC721\r\n    event Transfer(address from, address to, uint tokenId);\r\n\r\n    // NFT上のMarket\r\n    struct ItemMarkets {\r\n        // 登録時のNFT売手\r\n        address seller;\r\n        // Marketの価格\r\n        uint128 marketsPrice;\r\n    }\r\n\r\n    // トークンIDから対応するマーケットへの出品にマップします。\r\n    mapping (uint256 => ItemMarkets) tokenIdToItemMarkets;\r\n\r\n    // マーケットへの出品の手数料を設定\r\n    uint256 public ownerCut = 0;\r\n    function setOwnerCut(uint256 _cut) public onlyOwner {\r\n        require(_cut <= 10000);\r\n        ownerCut = _cut;\r\n    }\r\n\r\n    /// @notice Itemマーケットへの出品を作成し、開始します。\r\n    /// @param _itemId \r\n    /// @param _marketsPrice \r\n    function createItemSaleMarkets(\r\n        uint256 _itemId,\r\n        uint256 _marketsPrice\r\n    )\r\n        external\r\n        whenNotPaused\r\n    {\r\n        require(_marketsPrice == uint256(uint128(_marketsPrice)));\r\n\r\n        // チェック用のtokenIdをセット\r\n        uint itemTokenId = getItemIdToTokenId(_itemId);\r\n        // itemのオーナーである事\r\n        require(_owns(msg.sender, itemTokenId));\r\n        // itemのパラメータチェック\r\n        Item memory item = items[itemTokenId];\r\n        // マーケットへの出品中か確認してください。\r\n        require(uint(item.marketsFlg) == 0);\r\n        // 装備中か確認してください。\r\n        require(uint(item.rocId) == 0);\r\n        require(uint(item.equipmentFlg) == 0);\r\n        // 承認\r\n        _approve(itemTokenId, msg.sender);\r\n        // マーケットへの出品セット\r\n        _escrow(msg.sender, itemTokenId);\r\n        ItemMarkets memory itemMarkets = ItemMarkets(\r\n            msg.sender,\r\n            uint128(_marketsPrice)\r\n        );\r\n\r\n        // マーケットへの出品FLGをセット\r\n        items[itemTokenId].marketsFlg = 1;\r\n\r\n        _itemAddMarkets(itemTokenId, itemMarkets);\r\n    }\r\n\r\n    /// @dev マーケットへの出品を公開マーケットへの出品のリストに追加します。 \r\n    ///  また、ItemMarketsCreatedイベントを発生させます。\r\n    /// @param _tokenId The ID of the token to be put on markets.\r\n    /// @param _markets Markets to add.\r\n    function _itemAddMarkets(uint256 _tokenId, ItemMarkets _markets) internal {\r\n        tokenIdToItemMarkets[_tokenId] = _markets;\r\n        emit ItemMarketsCreated(\r\n            uint256(_tokenId),\r\n            uint128(_markets.marketsPrice)\r\n        );\r\n    }\r\n\r\n    /// @dev マーケットへの出品を公開マーケットへの出品のリストから削除します。\r\n    /// @param _tokenId \r\n    function _itemRemoveMarkets(uint256 _tokenId) internal {\r\n        delete tokenIdToItemMarkets[_tokenId];\r\n    }\r\n\r\n    /// @dev 無条件にマーケットへの出品を取り消します。\r\n    /// @param _tokenId \r\n    function _itemCancelMarkets(uint256 _tokenId) internal {\r\n        _itemRemoveMarkets(_tokenId);\r\n        emit ItemMarketsCancelled(_tokenId);\r\n    }\r\n\r\n    /// @dev まだ獲得されていないマーケットへの出品をキャンセルします。\r\n    ///  元の所有者にNFTを返します。\r\n    /// @notice これは、契約が一時停止している間に呼び出すことができる状態変更関数です。\r\n    /// @param _itemId \r\n    function itemCancelMarkets(uint _itemId) external {\r\n        uint itemTokenId = getItemIdToTokenId(_itemId);\r\n        ItemMarkets storage markets = tokenIdToItemMarkets[itemTokenId];\r\n        address seller = markets.seller;\r\n        require(msg.sender == seller);\r\n        _itemCancelMarkets(itemTokenId);\r\n        itemIndexToOwner[itemTokenId] = seller;\r\n        items[itemTokenId].marketsFlg = 0;\r\n    }\r\n\r\n    /// @dev 契約が一時停止されたときにマーケットへの出品をキャンセルします。\r\n    ///  所有者だけがこれを行うことができ、NFTは売り手に返されます。 \r\n    ///  緊急時にのみ使用してください。\r\n    /// @param _itemId \r\n    function itemCancelMarketsWhenPaused(uint _itemId) whenPaused onlyOwner external {\r\n        uint itemTokenId = getItemIdToTokenId(_itemId);\r\n        ItemMarkets storage markets = tokenIdToItemMarkets[itemTokenId];\r\n        address seller = markets.seller;\r\n        _itemCancelMarkets(itemTokenId);\r\n        itemIndexToOwner[itemTokenId] = seller;\r\n        items[itemTokenId].marketsFlg = 0;\r\n    }\r\n\r\n    /// @dev マーケットへの出品入札\r\n    ///  十分な量のEtherが供給されればNFTの所有権を移転する。\r\n    /// @param _itemId \r\n    function itemBid(uint _itemId) external payable whenNotPaused {\r\n        uint itemTokenId = getItemIdToTokenId(_itemId);\r\n        // マーケットへの出品構造体への参照を取得する\r\n        ItemMarkets storage markets = tokenIdToItemMarkets[itemTokenId];\r\n\r\n        uint128 sellingPrice = uint128(markets.marketsPrice);\r\n        // 入札額が価格以上である事を確認する。\r\n        // msg.valueはweiの数\r\n        require(msg.value >= sellingPrice);\r\n        // マーケットへの出品構造体が削除される前に、販売者への参照を取得します。\r\n        address seller = markets.seller;\r\n\r\n        // マーケットへの出品を削除します。\r\n        _itemRemoveMarkets(itemTokenId);\r\n\r\n        if (sellingPrice > 0) {\r\n            // 競売人のカットを計算します。\r\n            uint128 marketseerCut = uint128(_computeCut(sellingPrice));\r\n            uint128 sellerProceeds = sellingPrice - marketseerCut;\r\n\r\n            // 売り手に送金する\r\n            seller.transfer(sellerProceeds);\r\n        }\r\n\r\n        // 超過分を買い手に返す\r\n        msg.sender.transfer(msg.value - sellingPrice);\r\n        // イベント\r\n        emit ItemMarketsSuccessful(itemTokenId, sellingPrice, msg.sender);\r\n\r\n        _transfer(seller, msg.sender, itemTokenId);\r\n        // マーケットへの出品FLGをセット\r\n        items[itemTokenId].marketsFlg = 0;\r\n    }\r\n\r\n    /// @dev 手数料計算\r\n    /// @param _price \r\n    function _computeCut(uint128 _price) internal view returns (uint) {\r\n        return _price * ownerCut / 10000;\r\n    }\r\n\r\n}\r\n\r\n/// @title CryptoFeather\r\ncontract ItemsCore is ItemsMarkets {\r\n\r\n    // コア契約が壊れてアップグレードが必要な場合に設定します\r\n    address public newContractAddress;\r\n\r\n    /// @dev 一時停止を無効にすると、契約を一時停止する前にすべての外部契約アドレスを設定する必要があります。\r\n    function unpause() public onlyOwner whenPaused {\r\n        require(newContractAddress == address(0));\r\n        // 実際に契約を一時停止しないでください。\r\n        super.unpause();\r\n    }\r\n\r\n    // @dev 利用可能な残高を取得できるようにします。\r\n    function withdrawBalance(uint _subtractFees) external onlyOwner {\r\n        uint256 balance = address(this).balance;\r\n        if (balance > _subtractFees) {\r\n            owner.transfer(balance - _subtractFees);\r\n        }\r\n    }\r\n\r\n    /// @notice tokenIdからItemに関するすべての関連情報を返します。\r\n    /// @param _tokenId \r\n    function getItem(uint _tokenId)\r\n        external\r\n        view\r\n        returns (\r\n        uint itemId,\r\n        uint marketsFlg,\r\n        uint rocId,\r\n        uint equipmentFlg\r\n    ) {\r\n        Item memory item = items[_tokenId];\r\n        itemId = uint(item.itemId);\r\n        marketsFlg = uint(item.marketsFlg);\r\n        rocId = uint(item.rocId);\r\n        equipmentFlg = uint(item.equipmentFlg);\r\n    }\r\n\r\n    /// @notice itemIdからItemに関するすべての関連情報を返します。\r\n    /// @param _itemId \r\n    function getItemItemId(uint _itemId)\r\n        external\r\n        view\r\n        returns (\r\n        uint itemId,\r\n        uint marketsFlg,\r\n        uint rocId,\r\n        uint equipmentFlg\r\n    ) {\r\n        Item memory item = items[getItemIdToTokenId(_itemId)];\r\n        itemId = uint(item.itemId);\r\n        marketsFlg = uint(item.marketsFlg);\r\n        rocId = uint(item.rocId);\r\n        equipmentFlg = uint(item.equipmentFlg);\r\n    }\r\n\r\n    /// @notice itemIdからMarkets情報を返します。\r\n    /// @param _itemId \r\n    function getMarketsItemId(uint _itemId)\r\n        external\r\n        view\r\n        returns (\r\n        address seller,\r\n        uint marketsPrice\r\n    ) {\r\n        uint itemTokenId = getItemIdToTokenId(_itemId);\r\n        ItemMarkets storage markets = tokenIdToItemMarkets[itemTokenId];\r\n        seller = markets.seller;\r\n        marketsPrice = uint(markets.marketsPrice);\r\n    }\r\n\r\n    /// @notice itemIdからオーナー情報を返します。\r\n    /// @param _itemId \r\n    function getItemIndexToOwner(uint _itemId)\r\n        external\r\n        view\r\n        returns (\r\n        address owner\r\n    ) {\r\n        uint itemTokenId = getItemIdToTokenId(_itemId);\r\n        owner = itemIndexToOwner[itemTokenId];\r\n    }\r\n\r\n    /// @notice rocIdとhuntingIdからhuntingの存在チェック\r\n    /// @param _rocId \r\n    /// @param _huntingId \r\n    function getHunting(uint _rocId, uint _huntingId)\r\n        public\r\n        view\r\n        returns (\r\n        uint huntingId\r\n    ) {\r\n        Hunting memory hunting = rocHuntingIndex[_rocId][_huntingId];\r\n        huntingId = uint(hunting.huntingId);\r\n    }\r\n\r\n    /// @notice _rocIdからオーナー情報を返します。\r\n    /// @param _rocId \r\n    function getRocOwnerItem(uint _rocId)\r\n        external\r\n        view\r\n        returns (\r\n        address owner\r\n    ) {\r\n        uint checkTokenId = rocCore.getRocIdToTokenId(_rocId);\r\n        owner = rocCore.getRocIndexToOwner(checkTokenId);\r\n    }\r\n\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"getItemIdToTokenId\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_interfaceID\",\"type\":\"bytes4\"}],\"name\":\"supportsInterface\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_tokenId\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"getItemIndexToOwner\",\"outputs\":[{\"name\":\"owner\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"rocHuntingIndex\",\"outputs\":[{\"name\":\"huntingId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"huntingPrice\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_rocId\",\"type\":\"uint256\"},{\"name\":\"_huntingId\",\"type\":\"uint256\"},{\"name\":\"_items\",\"type\":\"uint256[]\"}],\"name\":\"processHunting\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"itemBid\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getRocCoreAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_tokenId\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_rocId\",\"type\":\"uint256\"},{\"name\":\"_huntingId\",\"type\":\"uint256\"}],\"name\":\"getHunting\",\"outputs\":[{\"name\":\"huntingId\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_tokenId\",\"type\":\"uint256\"}],\"name\":\"getItem\",\"outputs\":[{\"name\":\"itemId\",\"type\":\"uint256\"},{\"name\":\"marketsFlg\",\"type\":\"uint256\"},{\"name\":\"rocId\",\"type\":\"uint256\"},{\"name\":\"equipmentFlg\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"unpause\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_rocCoreAddress\",\"type\":\"address\"}],\"name\":\"setRocCoreAddress\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_reItems\",\"type\":\"uint256[]\"},{\"name\":\"_inItems\",\"type\":\"uint256[]\"},{\"name\":\"_rocId\",\"type\":\"uint256\"}],\"name\":\"equipmentItem\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"},{\"name\":\"_marketsPrice\",\"type\":\"uint256\"}],\"name\":\"createItemSaleMarkets\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"paused\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_tokenId\",\"type\":\"uint256\"}],\"name\":\"ownerOf\",\"outputs\":[{\"name\":\"owner\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"itemOwnershipTokenCount\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"newContractAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"count\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"itemCancelMarketsWhenPaused\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"getItemItemId\",\"outputs\":[{\"name\":\"itemId\",\"type\":\"uint256\"},{\"name\":\"marketsFlg\",\"type\":\"uint256\"},{\"name\":\"rocId\",\"type\":\"uint256\"},{\"name\":\"equipmentFlg\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"rocCoreAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_cut\",\"type\":\"uint256\"}],\"name\":\"setOwnerCut\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"itemCancelMarkets\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"price\",\"type\":\"uint256\"}],\"name\":\"setHuntingPrice\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"ownerCut\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"pause\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"itemIndexToApproved\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"itemIndex\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_items\",\"type\":\"uint256[]\"},{\"name\":\"_owners\",\"type\":\"address[]\"}],\"name\":\"createItems\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_tokenId\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"getMarketsItemId\",\"outputs\":[{\"name\":\"seller\",\"type\":\"address\"},{\"name\":\"marketsPrice\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"items\",\"outputs\":[{\"name\":\"itemId\",\"type\":\"uint256\"},{\"name\":\"marketsFlg\",\"type\":\"uint8\"},{\"name\":\"rocId\",\"type\":\"uint256\"},{\"name\":\"equipmentFlg\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_itemId\",\"type\":\"uint256\"}],\"name\":\"usedItem\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_subtractFees\",\"type\":\"uint256\"}],\"name\":\"withdrawBalance\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_rocId\",\"type\":\"uint256\"}],\"name\":\"getRocOwnerItem\",\"outputs\":[{\"name\":\"owner\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"itemIndexToOwner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"tokenId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"marketsPrice\",\"type\":\"uint128\"}],\"name\":\"ItemMarketsCreated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"tokenId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"marketsPriceice\",\"type\":\"uint128\"},{\"indexed\":false,\"name\":\"buyer\",\"type\":\"address\"}],\"name\":\"ItemMarketsSuccessful\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"ItemMarketsCancelled\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_approved\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_tokenId\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"ItemTransfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"tokenId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"ticketId\",\"type\":\"uint256\"}],\"name\":\"ItemCreated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"huntingId\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"rocId\",\"type\":\"uint256\"}],\"name\":\"HuntingCreated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[],\"name\":\"Pause\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[],\"name\":\"Unpause\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"previousOwner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"}]","ContractName":"ItemsCore","CompilerVersion":"v0.4.22+commit.4cb486ee","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://67c4d0c7c9b3d34c9afededcf3941b70050f334370dc7c742af1485f4a8b2eb9"}]}