{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.24;\r\n\r\ncontract EthCalendar {\r\n    // Initial price of a day is 0.003 ETH\r\n    uint256 constant initialDayPrice = 3000000000000000 wei;\r\n\r\n    // Address of the contract owner\r\n    address contractOwner;\r\n\r\n    // Mapping of addresses to the pending withdrawal amount\r\n    mapping(address => uint256) pendingWithdrawals;\r\n\r\n    // Mapping of day ids to their structs\r\n    mapping(uint16 => Day) dayStructs;\r\n\r\n    // Fired when a day was bought\r\n    event DayBought(uint16 dayId);\r\n\r\n    // Holds all information about a day\r\n    struct Day {\r\n        address owner;\r\n        string message;\r\n        uint256 sellprice;\r\n        uint256 buyprice;\r\n    }\r\n\r\n    // Set contract owner on deploy\r\n    constructor() public {\r\n        contractOwner = msg.sender;\r\n    }\r\n\r\n    // Ensures sender is the contract owner\r\n    modifier onlyContractOwner() {\r\n        require(msg.sender == contractOwner, \"sender must be contract owner\");\r\n        _;\r\n    }\r\n\r\n    // Ensures dayid is in valid range\r\n    modifier onlyValidDay (uint16 dayId) {\r\n        require(dayId >= 0 && dayId <= 365, \"day id must be between 0 and 365\");\r\n        _;\r\n    }\r\n\r\n    // Ensures sender is the owner of a specific day\r\n    modifier onlyDayOwner(uint16 dayId) {\r\n        require(msg.sender == dayStructs[dayId].owner, \"sender must be owner of day\");\r\n        _;\r\n    }\r\n\r\n    // Ensures sender is not the owner of a specific day\r\n    modifier notDayOwner(uint16 dayId) {\r\n        require(msg.sender != dayStructs[dayId].owner, \"sender can't be owner of day\");\r\n        _;\r\n    }\r\n\r\n    // Ensures message is of a valid length\r\n    modifier onlyValidMessage(string message) {\r\n        require(bytes(message).length > 0, \"message has to be set\");\r\n        _;\r\n    }\r\n\r\n    // Ensures the updated sellprice is below the here defined moving maximum.\r\n    // The maximum is oriented to the price the day is bought.\r\n    // Into baseprice the buyprice needs to be passed. This could be either msg.value or a stored value from previous tx.\r\n    modifier onlyValidSellprice(uint256 sellprice, uint256 baseprice) {\r\n        // Set the moving maximum to twice the paid amount\r\n        require(sellprice > 0 && sellprice <= baseprice * 2, \"new sell price must be lower than or equal to twice the paid price\");\r\n        _;\r\n    }\r\n\r\n    // Ensures the transfered value of the tx is large enough to pay for a specific day\r\n    modifier onlySufficientPayment(uint16 dayId) {\r\n        // The current price needs to be covered by the sent amount.\r\n        // It is possible to pay more than needed.\r\n        require(msg.value >= getCurrentPrice(dayId), \"tx value must be greater than or equal to price of day\");\r\n        _;\r\n    }\r\n\r\n    // Any address can buy a day for the specified minimum price.\r\n    // A sell price and a message need to be specified in this call.\r\n    // The new sell price has a maximum of twice the paid amount.\r\n    // A day can be bought for more than the specified sell price. So the maximum new sell price can be arbitrary high.\r\n    function buyDay(uint16 dayId, uint256 sellprice, string message) public payable\r\n        onlyValidDay(dayId)\r\n        notDayOwner(dayId)\r\n        onlyValidMessage(message)\r\n        onlySufficientPayment(dayId)\r\n        onlyValidSellprice(sellprice, msg.value) {\r\n\r\n        if (hasOwner(dayId)) {\r\n            // Day already has an owner\r\n            // Contract owner takes 2% cut on transaction\r\n            uint256 contractOwnerCut = (msg.value * 200) / 10000;\r\n            uint256 dayOwnerShare = msg.value - contractOwnerCut;\r\n\r\n            // Credit contract owner and day owner their shares\r\n            pendingWithdrawals[contractOwner] += contractOwnerCut;\r\n            pendingWithdrawals[dayStructs[dayId].owner] += dayOwnerShare;\r\n        } else {\r\n            // Day has no owner yet.\r\n            // Contract owner gets credited the initial transaction\r\n            pendingWithdrawals[contractOwner] += msg.value;\r\n        }\r\n\r\n        // Update the data of the day bought\r\n        dayStructs[dayId].owner = msg.sender;\r\n        dayStructs[dayId].message = message;\r\n        dayStructs[dayId].sellprice = sellprice;\r\n        dayStructs[dayId].buyprice = msg.value;\r\n\r\n        emit DayBought(dayId);\r\n    }\r\n\r\n    // Owner can change price of his days\r\n    function changePrice(uint16 dayId, uint256 sellprice) public\r\n        onlyValidDay(dayId)\r\n        onlyDayOwner(dayId)\r\n        onlyValidSellprice(sellprice, dayStructs[dayId].buyprice) {\r\n        dayStructs[dayId].sellprice = sellprice;\r\n    }\r\n\r\n    // Owner can change personal message of his days\r\n    function changeMessage(uint16 dayId, string message) public\r\n        onlyValidDay(dayId)\r\n        onlyDayOwner(dayId)\r\n        onlyValidMessage(message) {\r\n        dayStructs[dayId].message = message;\r\n    }\r\n\r\n    // Owner can tranfer his day to another address\r\n    function transferDay(uint16 dayId, address recipient) public\r\n        onlyValidDay(dayId)\r\n        onlyDayOwner(dayId) {\r\n        dayStructs[dayId].owner = recipient;\r\n    }\r\n\r\n    // Returns day details\r\n    function getDay (uint16 dayId) public view\r\n        onlyValidDay(dayId)\r\n    returns (uint16 id, address owner, string message, uint256 sellprice, uint256 buyprice) {\r\n        return(  \r\n            dayId,\r\n            dayStructs[dayId].owner,\r\n            dayStructs[dayId].message,\r\n            getCurrentPrice(dayId),\r\n            dayStructs[dayId].buyprice\r\n        );    \r\n    }\r\n\r\n    // Returns the senders balance\r\n    function getBalance() public view\r\n    returns (uint256 amount) {\r\n        return pendingWithdrawals[msg.sender];\r\n    }\r\n\r\n    // User can withdraw his balance\r\n    function withdraw() public {\r\n        uint256 amount = pendingWithdrawals[msg.sender];\r\n        pendingWithdrawals[msg.sender] = 0;\r\n        msg.sender.transfer(amount);\r\n    }\r\n\r\n    // Returns whether or not the day is already bought\r\n    function hasOwner(uint16 dayId) private view\r\n    returns (bool dayHasOwner) {\r\n        return dayStructs[dayId].owner != address(0);\r\n    }\r\n\r\n    // Returns the price the day currently can be bought for\r\n    function getCurrentPrice(uint16 dayId) private view\r\n    returns (uint256 currentPrice) {\r\n        return hasOwner(dayId) ?\r\n            dayStructs[dayId].sellprice :\r\n            initialDayPrice;\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"getBalance\",\"outputs\":[{\"name\":\"amount\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"withdraw\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"dayId\",\"type\":\"uint16\"}],\"name\":\"getDay\",\"outputs\":[{\"name\":\"id\",\"type\":\"uint16\"},{\"name\":\"owner\",\"type\":\"address\"},{\"name\":\"message\",\"type\":\"string\"},{\"name\":\"sellprice\",\"type\":\"uint256\"},{\"name\":\"buyprice\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dayId\",\"type\":\"uint16\"},{\"name\":\"sellprice\",\"type\":\"uint256\"}],\"name\":\"changePrice\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dayId\",\"type\":\"uint16\"},{\"name\":\"sellprice\",\"type\":\"uint256\"},{\"name\":\"message\",\"type\":\"string\"}],\"name\":\"buyDay\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dayId\",\"type\":\"uint16\"},{\"name\":\"message\",\"type\":\"string\"}],\"name\":\"changeMessage\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dayId\",\"type\":\"uint16\"},{\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"transferDay\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"dayId\",\"type\":\"uint16\"}],\"name\":\"DayBought\",\"type\":\"event\"}]","ContractName":"EthCalendar","CompilerVersion":"v0.4.24+commit.e67f0147","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://825a08c841a2c6e2aff84b4027db19440e12143f0c1749dfeb269cb96ba7ae46"}]}