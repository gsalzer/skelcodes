{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.24;\r\n\r\ncontract ExchangeAdmin {\r\n    address public owner;\r\n    address public newOwner;\r\n\r\n    event OwnershipTransferred(address indexed _from, address indexed _to);\r\n\r\n    constructor() public {\r\n        owner = msg.sender;\r\n    }\r\n\r\n    modifier onlyAdmin {\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n\r\n    function transferOwnership(address _newOwner) public onlyAdmin {\r\n        newOwner = _newOwner;\r\n    }\r\n    function acceptOwnership() public {\r\n        require(msg.sender == newOwner);\r\n        emit OwnershipTransferred(owner, newOwner);\r\n        owner = newOwner;\r\n        newOwner = address(0);\r\n    }\r\n}\r\nlibrary StringYokes {\r\n        function zint_bytes32ToString(bytes32 x) public pure returns (string) {\r\n        bytes memory bytesString = new bytes(32);\r\n        uint charCount = 0;\r\n        for (uint j = 0; j < 32; j++) {\r\n            byte char = byte(bytes32(uint(x) * 2 ** (8 * j)));\r\n            if (char != 0) {\r\n                bytesString[charCount] = char;\r\n                charCount++;\r\n            }\r\n        }\r\n        bytes memory bytesStringTrimmed = new bytes(charCount);\r\n        for (j = 0; j < charCount; j++) {\r\n            bytesStringTrimmed[j] = bytesString[j];\r\n        }\r\n        return string(bytesStringTrimmed);\r\n    }\r\n    function zint_convert(string key) public pure returns (bytes32 ret) {\r\n        if (bytes(key).length > 32) revert();\r\n        assembly {\r\n          ret := mload(add(key, 32))\r\n        }\r\n    }\r\n}    \r\ncontract Game is ExchangeAdmin {\r\n    \r\n    bool expired;\r\n    \r\n    struct Better {\r\n        bool used;\r\n        address betterAddress;\r\n        uint contribAmount;\r\n    }\r\n    \r\n    struct Side {\r\n        uint totalPledged;\r\n        bytes32 sideName;\r\n        address[] usedAddresses;\r\n        mapping (address => Better) contribDb;\r\n    }\r\n    string gName;\r\n    bytes32[] sides;\r\n    uint allSidesPledged;\r\n    uint expiry;\r\n    mapping (bytes32 => Side) public sideData;\r\n    mapping (bytes32 => uint) public idToNameRef;\r\n    \r\n    constructor (string gameName, uint gameExpiry, bytes32[] gameSides) public {\r\n        gName = gameName;\r\n        expiry = gameExpiry;\r\n        for (uint i = 0; i<gameSides.length; i++) {\r\n            sideData[gameSides[i]].sideName=gameSides[i];\r\n            idToNameRef[gameSides[i]]=i;\r\n            sides.push(gameSides[i]);\r\n        }\r\n        expired = false;\r\n        allSidesPledged = 0;\r\n    }\r\n    \r\n    function getGameName() view public returns (string) {\r\n        return gName;\r\n    }\r\n    function getGameSides() view public returns (bytes32[]) {\r\n        return sides;\r\n    }\r\n    function isNotExpired() view public returns (bool) {\r\n        return ((now < expiry) && !expired);\r\n    }\r\n    function getNumSides() view public returns (uint) {\r\n        return sides.length;\r\n    }\r\n    function getStrFromId(uint toConv) view public returns (string) {\r\n        return StringYokes.zint_bytes32ToString(sides[toConv]);\r\n    }\r\n    function getIdFromStr(string toConv) view public returns (uint) {\r\n        return idToNameRef[StringYokes.zint_convert(toConv)];\r\n    }\r\n    \r\n    function placeBet(address a, uint value, string betSide) public payable {\r\n        require(isNotExpired());\r\n        bytes32 index = StringYokes.zint_convert(betSide);\r\n        sideData[index].totalPledged+=value;\r\n        allSidesPledged+=value;\r\n        if (sideData[index].contribDb[a].used) {\r\n            value+=sideData[index].contribDb[a].contribAmount;\r\n        }\r\n        else {\r\n            sideData[index].usedAddresses.push(a);\r\n            sideData[index].contribDb[a].used=true;\r\n        }\r\n        sideData[index].contribDb[a].contribAmount+=value;\r\n    }\r\n    \r\n    function allSidesPledgedAmount() public view returns (uint) {\r\n        return allSidesPledged;\r\n    }\r\n    \r\n    function checkSidePledge(uint i) public view returns (uint) {\r\n        return sideData[sides[i]].totalPledged;\r\n    }\r\n    function dish(string winner, address profit) public onlyAdmin payable {\r\n        require(!expired);\r\n        expired = true;\r\n        bytes32 winByte = StringYokes.zint_convert(winner);\r\n        uint totalGameContrib = allSidesPledged;\r\n        uint totalSideContrib = (sideData[winByte].totalPledged);\r\n        for (uint i = 0; i<sideData[winByte].usedAddresses.length; i++) {\r\n            address recip = sideData[winByte].usedAddresses[i];\r\n            uint contribAmount = sideData[winByte].contribDb[recip].contribAmount;\r\n            uint winAddition = (925*1000*contribAmount*(totalGameContrib-totalSideContrib))/(1000000*totalSideContrib);\r\n            recip.transfer(contribAmount+winAddition);\r\n        }\r\n        profit.transfer(address(this).balance);\r\n    }\r\n    function refund() public onlyAdmin payable {\r\n        for (uint i = 0; i<sides.length; i++) {\r\n            for (uint j = 0; j<sideData[sides[i]].usedAddresses.length; j++) {\r\n            address recip = sideData[sides[i]].usedAddresses[j];\r\n            uint contribAmount = sideData[sides[i]].contribDb[recip].contribAmount;\r\n            recip.transfer(contribAmount);\r\n            }\r\n        }\r\n    }\r\n    \r\n}\r\n\r\ncontract BEthy is ExchangeAdmin {\r\n    Game[] current;\r\n    uint etherBalance;\r\n    \r\n    mapping (bytes32 => uint) public references;\r\n    \r\n    constructor () public {\r\n    }\r\n    \r\n    function addGame(string gameName, uint gameExpiry, bytes32[] gameSides) onlyAdmin public {\r\n        current.push(new Game(gameName, gameExpiry, gameSides));\r\n        references[StringYokes.zint_convert(gameName)]=current.length-1;\r\n    }\r\n    \r\n    function numGames() view public returns (uint) {\r\n        return current.length;\r\n    }\r\n    \r\n    function getName(uint i) view public returns (string, bool, uint) {\r\n       return (current[i].getGameName(), current[i].isNotExpired(), current[i].allSidesPledgedAmount());\r\n    }\r\n    \r\n    function getSidesById(uint i, uint j) view public returns (string, uint) {\r\n        return (StringYokes.zint_bytes32ToString(current[i].getGameSides()[j]), current[i].checkSidePledge(j));\r\n    }\r\n    \r\n    function getSides(string str, uint j) view public returns (string, uint) {\r\n        return getSidesById(references[StringYokes.zint_convert(str)], j);\r\n    }\r\n    \r\n    function getGameNumSides(uint i) view public returns (uint) {\r\n        return current[i].getNumSides();\r\n    }\r\n    function _byteToString(bytes32 x) public pure returns (string) {\r\n        return StringYokes.zint_bytes32ToString(x);\r\n    }\r\n    function _stringToByte(string x) public pure returns (bytes32) {\r\n        return StringYokes.zint_convert(x);\r\n    }\r\n    \r\n    function () public payable {\r\n        etherBalance+=msg.value;\r\n    }\r\n    \r\n    function getBalance() public view returns (uint) {\r\n        return etherBalance;\r\n    }\r\n    function getAddBal() public view returns (uint) {\r\n        return address(this).balance;\r\n    }\r\n    \r\n    function placeBet(uint gameId, string betSide) payable public {\r\n        require(msg.value!=0);\r\n        etherBalance+=msg.value;\r\n        current[gameId].placeBet.value(msg.value)(msg.sender, msg.value, betSide);\r\n    }\r\n    \r\n    function placeBet(string gameId, string betSide) payable public {\r\n        placeBet(references[StringYokes.zint_convert(gameId)], betSide);\r\n    }\r\n    \r\n    function checkGameAmount(uint gameId) public view returns (uint) {\r\n        return current[gameId].allSidesPledgedAmount();\r\n    }\r\n    function checkGameSideAmount(uint gameId, uint sideNum) public view returns (uint) {\r\n        return current[gameId].checkSidePledge(sideNum);\r\n    }\r\n    \r\n    function endGame(uint gameId, string winningSide, address beneficiary) public onlyAdmin {//returns (address[10], uint[10]) {\r\n        current[gameId].dish(winningSide, beneficiary);\r\n    }\r\n    function endGame(uint gameId, uint winningId, address profit) public onlyAdmin {\r\n        endGame(gameId, current[gameId].getStrFromId(winningId), profit);\r\n    }\r\n}","ABI":"[{\"constant\":false,\"inputs\":[{\"name\":\"gameId\",\"type\":\"uint256\"},{\"name\":\"winningId\",\"type\":\"uint256\"},{\"name\":\"profit\",\"type\":\"address\"}],\"name\":\"endGame\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getBalance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"gameId\",\"type\":\"uint256\"},{\"name\":\"sideNum\",\"type\":\"uint256\"}],\"name\":\"checkGameSideAmount\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"i\",\"type\":\"uint256\"},{\"name\":\"j\",\"type\":\"uint256\"}],\"name\":\"getSidesById\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"gameName\",\"type\":\"string\"},{\"name\":\"gameExpiry\",\"type\":\"uint256\"},{\"name\":\"gameSides\",\"type\":\"bytes32[]\"}],\"name\":\"addGame\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"gameId\",\"type\":\"string\"},{\"name\":\"betSide\",\"type\":\"string\"}],\"name\":\"placeBet\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"name\":\"references\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"str\",\"type\":\"string\"},{\"name\":\"j\",\"type\":\"uint256\"}],\"name\":\"getSides\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"gameId\",\"type\":\"uint256\"},{\"name\":\"betSide\",\"type\":\"string\"}],\"name\":\"placeBet\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getAddBal\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"i\",\"type\":\"uint256\"}],\"name\":\"getName\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"},{\"name\":\"\",\"type\":\"bool\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"gameId\",\"type\":\"uint256\"},{\"name\":\"winningSide\",\"type\":\"string\"},{\"name\":\"beneficiary\",\"type\":\"address\"}],\"name\":\"endGame\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"acceptOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"gameId\",\"type\":\"uint256\"}],\"name\":\"checkGameAmount\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"x\",\"type\":\"string\"}],\"name\":\"_stringToByte\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"numGames\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"newOwner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"i\",\"type\":\"uint256\"}],\"name\":\"getGameNumSides\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"x\",\"type\":\"bytes32\"}],\"name\":\"_byteToString\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_to\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"}]","ContractName":"BEthy","CompilerVersion":"v0.4.24+commit.e67f0147","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"StringYokes:5773F46912Cf938d9ec86FBd7080846C2933BDbc","SwarmSource":"bzzr://068abe50147aeef940c9917183850f75671525b88cbb06d27ab1364923033581"}]}