{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.7.5;\r\n\r\ninterface erc20 {\r\n    function balanceOf(address _owner) external view returns (uint balance);\r\n    function transfer(address _to, uint _value) external returns (bool success);\r\n    function transferFrom(address _from, address _to, uint _value) external returns (bool success);\r\n    function allowance(address _owner, address _spender) external view returns (uint remaining);\r\n    function decimals() external view returns(uint digits);    \r\n}\r\n\r\ninterface erc20Validation {\r\n    function balanceOf(address _address, address _tokenAddress) external view returns (uint balance);    \r\n}\r\n\r\ncontract bazarswap\r\n{\t\r\n\r\naddress public _owner;\r\n\r\nuint public fee;\r\nuint public feeDecimals;\r\n\r\naddress public payoutAddress;\r\n\r\nmodifier onlyOwner(){\r\n    require(msg.sender == _owner);\r\n     _;\r\n}\r\n\t\r\nconstructor() {\r\n\t_owner = msg.sender;\r\n\tfeeDecimals = 1000000;\r\n}\r\n\r\nevent AddTokenEvent(address indexed _tokenAddress);\r\nevent SetForSaleEvent(address indexed _seller, address indexed _tokenAddress, uint _balance, uint _weiPriceUnitToken, bool update);\r\nevent RemovedFromSaleEvent(address indexed _seller, address indexed _tokenAddress);\r\nevent SoldEvent(address indexed _seller, address indexed _buyer, address indexed _tokenAddress, uint256 _balance, uint _weiPriceUnitToken, uint _totalPrice, uint _fee);\r\n\r\nmapping (address => address) public SecondaryValidation;\r\nmapping (address => mapping (address => uint)) public weiPriceUnitTokenList;\r\n\r\nfunction SetForSale(address tokenAddress, uint weiPriceUnitToken) public\r\n{\t\r\n\tif (weiPriceUnitToken == 0) revert('price cannot be zero');\r\n\t\t\r\n\terc20 token = erc20(tokenAddress);\r\n\tuint balance = token.balanceOf(msg.sender);\r\n\t\r\n\tif (SecondaryValidation[tokenAddress] != 0x0000000000000000000000000000000000000000)\r\n\t{\r\n\t\terc20Validation vc = erc20Validation(SecondaryValidation[tokenAddress]);\r\n\t\tbalance = vc.balanceOf(msg.sender, tokenAddress);\r\n\t}\r\n\t\r\n\tif (balance == 0) revert('balance cannot be zero');\r\n\tif (token.allowance(msg.sender, address(this)) < balance) revert('approve not granted');\r\n\t\r\n\tif (weiPriceUnitTokenList[msg.sender][tokenAddress] == 0)\r\n\t{\r\n\t\temit AddTokenEvent(tokenAddress);\r\n\t\temit SetForSaleEvent(msg.sender, tokenAddress, balance, weiPriceUnitToken, false);\r\n\t}\r\n\telse\r\n\t{\r\n\t\temit SetForSaleEvent(msg.sender, tokenAddress, balance, weiPriceUnitToken, true);\r\n\t}\r\n\t\r\n\tweiPriceUnitTokenList[msg.sender][tokenAddress] = weiPriceUnitToken;\r\n}\r\n\r\nfunction Buy(address seller, address tokenAddress) public payable\r\n{\t\r\n\tif (seller == msg.sender) revert('buyer and seller cannot be the same');\r\n\t\r\n\terc20 token = erc20(tokenAddress);\r\n\tuint allowance = getAvailableBalanceForSale(seller, tokenAddress);\r\n\t\r\n\tuint sellerPrice = weiPriceUnitTokenList[seller][tokenAddress] * allowance / 10**token.decimals();\r\n\tuint buyFee = fee * sellerPrice / feeDecimals;\r\n\t\r\n\tif ((msg.value != sellerPrice + buyFee) || msg.value == 0) revert('Price sent not correct');\r\n\t\r\n\ttoken.transferFrom(seller, msg.sender, allowance);\r\n\t\r\n\tif(!payable(seller).send(sellerPrice)) revert('Error while sending payment to seller');\t\r\n\t\r\n\temit SoldEvent(seller, msg.sender, tokenAddress, allowance, weiPriceUnitTokenList[seller][tokenAddress], (sellerPrice + buyFee), buyFee);\r\n\t\r\n\tweiPriceUnitTokenList[seller][tokenAddress] = 0;\r\n}\r\n\r\nfunction RemoveFromSale(address tokenAddress, bool checkAllowance) public\r\n{\r\n\tif (getTokenAllowance(msg.sender, tokenAddress) > 0 && checkAllowance) revert('Approve Needs to be Removed First');\r\n\tif (weiPriceUnitTokenList[msg.sender][tokenAddress] != 0)\r\n\t{\t\t\r\n\t\tweiPriceUnitTokenList[msg.sender][tokenAddress] = 0;\r\n\t\temit RemovedFromSaleEvent(msg.sender, tokenAddress);\r\n\t}\r\n\telse\r\n\t{\r\n\t\trevert('Token not set for sale');\r\n\t}\r\n}\r\n\r\nfunction getWeiPriceUnitTokenList(address seller, address tokenAddress) public view returns(uint) \r\n{\r\n\treturn weiPriceUnitTokenList[seller][tokenAddress];\r\n}\r\n\r\nfunction getFinalPrice(address seller, address tokenAddress) public view returns(uint) \r\n{\r\n\terc20 token = erc20(tokenAddress);\r\n\tuint allowance = getAvailableBalanceForSale(seller, tokenAddress);\r\n\tuint sellerPrice = weiPriceUnitTokenList[seller][tokenAddress] * allowance / 10**token.decimals();\r\n\tuint buyFee = fee * sellerPrice / feeDecimals;\r\n\treturn sellerPrice + buyFee;\r\n}\r\n\r\nfunction getFinalPriceWithoutFee(address seller, address tokenAddress) public view returns(uint) \r\n{\r\n\terc20 token = erc20(tokenAddress);\r\n\tuint allowance = getAvailableBalanceForSale(seller, tokenAddress);\r\n\tuint sellerPrice = weiPriceUnitTokenList[seller][tokenAddress] * allowance / 10**token.decimals();\r\n\treturn sellerPrice;\r\n}\r\n\r\nfunction getTokenAllowance(address seller, address tokenAddress) public view returns(uint)\r\n{\r\n\terc20 token = erc20(tokenAddress);\r\n\treturn token.allowance(seller, address(this));\r\n}\r\n\r\nfunction getAvailableBalanceForSale(address seller, address tokenAddress) public view returns(uint)\r\n{\r\n\tuint allowance = erc20(tokenAddress).allowance(seller, address(this));\r\n\tif (SecondaryValidation[tokenAddress] == 0x0000000000000000000000000000000000000000)\r\n\t{\r\n\t    uint balance = erc20(tokenAddress).balanceOf(seller);\r\n\t\tif (balance > allowance)\r\n\t\t\treturn allowance;\r\n\t\telse\r\n\t\t\treturn balance;\t\t\r\n\t}\r\n\telse\r\n\t{\t\r\n\t\tuint balance = erc20Validation(SecondaryValidation[tokenAddress]).balanceOf(seller, tokenAddress);\r\n\t\tif (balance > allowance)\r\n\t\t\treturn allowance;\r\n\t\telse\r\n\t\t\treturn balance;\r\n\t}\r\n}\r\n\r\nfunction setForSaleBalance(address seller, address tokenAddress) public view returns(uint)\r\n{\r\n\tif (SecondaryValidation[tokenAddress] == 0x0000000000000000000000000000000000000000)\r\n\t{\r\n\t    return erc20(tokenAddress).balanceOf(seller);\t\t\t\r\n\t}\r\n\telse\r\n\t{\t\r\n\t\treturn erc20Validation(SecondaryValidation[tokenAddress]).balanceOf(seller, tokenAddress);\t\t\r\n\t}\r\n}\r\n\r\nfunction setSecondaryValidation(address tokenAddress, address validationContractAddress) public onlyOwner\r\n{\r\n\tSecondaryValidation[tokenAddress] = validationContractAddress;\r\n}\r\n\r\nfunction setFee(uint _fee) public onlyOwner\r\n{\r\n\tfee = _fee;\r\n}\r\n\r\nfunction setPayoutAddress(address _address) public onlyOwner\r\n{\r\n\tpayoutAddress = _address;\r\n}\r\n\r\nfunction setFeeDecimals(uint _feeDecimals) public onlyOwner\r\n{\r\n\tfeeDecimals = _feeDecimals;\r\n}\r\n\r\nfunction approvePayout() public\r\n{\r\n\tif(!payable(payoutAddress).send(address(this).balance)) revert('Error while sending payment');\t\r\n}\r\n}","ABI":"[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_tokenAddress\",\"type\":\"address\"}],\"name\":\"AddTokenEvent\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_seller\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_tokenAddress\",\"type\":\"address\"}],\"name\":\"RemovedFromSaleEvent\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_seller\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_tokenAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"_balance\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"_weiPriceUnitToken\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"bool\",\"name\":\"update\",\"type\":\"bool\"}],\"name\":\"SetForSaleEvent\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_seller\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_buyer\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"_tokenAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"_balance\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"_weiPriceUnitToken\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"_totalPrice\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"_fee\",\"type\":\"uint256\"}],\"name\":\"SoldEvent\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"Buy\",\"outputs\":[],\"stateMutability\":\"payable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"internalType\":\"bool\",\"name\":\"checkAllowance\",\"type\":\"bool\"}],\"name\":\"RemoveFromSale\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"SecondaryValidation\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"weiPriceUnitToken\",\"type\":\"uint256\"}],\"name\":\"SetForSale\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"_owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"approvePayout\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"fee\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"feeDecimals\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"getAvailableBalanceForSale\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"getFinalPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"getFinalPriceWithoutFee\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"getTokenAllowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"getWeiPriceUnitTokenList\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"payoutAddress\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_fee\",\"type\":\"uint256\"}],\"name\":\"setFee\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_feeDecimals\",\"type\":\"uint256\"}],\"name\":\"setFeeDecimals\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"setForSaleBalance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_address\",\"type\":\"address\"}],\"name\":\"setPayoutAddress\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"validationContractAddress\",\"type\":\"address\"}],\"name\":\"setSecondaryValidation\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"weiPriceUnitTokenList\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]","ContractName":"bazarswap","CompilerVersion":"v0.7.5+commit.eb77ed08","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"None","Proxy":"0","Implementation":"","SwarmSource":"ipfs://1d50e5d492404057c223d95db350444188a1bd11614579324c40fd5f74df739c"}]}