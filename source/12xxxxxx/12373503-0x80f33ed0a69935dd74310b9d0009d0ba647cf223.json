{"status":"1","message":"OK","result":[{"SourceCode":"// actions.sol -- Tinlake actions\r\n// Copyright (C) 2020 Centrifuge\r\n\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU Affero General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU Affero General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU Affero General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\npragma solidity >=0.5.15 <0.6.0;\r\n\r\ninterface NFTLike {\r\n    function approve(address usr, uint token) external;\r\n    function transferFrom(address src, address dst, uint token) external;\r\n}\r\n\r\ninterface ERC20Like {\r\n    function approve(address usr, uint amount) external;\r\n    function transfer(address dst, uint amount) external;\r\n    function transferFrom(address src, address dst, uint amount) external;\r\n}\r\n\r\ninterface ShelfLike {\r\n    function pile() external returns(address);\r\n    function lock(uint loan) external;\r\n    function unlock(uint loan) external;\r\n    function issue(address registry, uint token) external returns(uint loan);\r\n    function close(uint loan) external;\r\n    function borrow(uint loan, uint amount) external;\r\n    function withdraw(uint loan, uint amount, address usr) external;\r\n    function repay(uint loan, uint amount) external;\r\n    function shelf(uint loan) external returns(address registry,uint256 tokenId,uint price,uint principal, uint initial);\r\n}\r\n\r\ninterface PileLike {\r\n    function debt(uint loan) external returns(uint);\r\n}\r\n\r\ncontract Actions {\r\n\r\n    // --- Events ---\r\n    event Issue(address indexed shelf, address indexed registry, uint indexed token);\r\n    event Transfer(address indexed registry, uint indexed token);\r\n    event Lock(address indexed shelf, uint indexed loan);\r\n    event BorrowWithdraw(address indexed shelf, uint indexed loan, uint amount, address indexed usr);\r\n    event Repay(address indexed shelf, address indexed erc20, uint indexed loan, uint amount);\r\n    event Unlock(address indexed shelf, address indexed registry, uint token, uint indexed loan);\r\n    event Close(address indexed shelf, uint indexed loan);\r\n    event ApproveNFT(address indexed registry, address indexed usr, uint tokenAmount);\r\n    event ApproveERC20(address indexed erc20, address indexed usr, uint amount);\r\n    event TransferERC20(address indexed erc20, address indexed dst, uint amount);\r\n\r\n    // --- Borrower Actions ---\r\n    function issue(address shelf, address registry, uint token) public returns (uint loan) {\r\n        loan = ShelfLike(shelf).issue(registry, token);\r\n        // proxy approve shelf to take nft\r\n        NFTLike(registry).approve(shelf, token);\r\n        \r\n        emit Issue(shelf, registry, token);\r\n        return loan;\r\n    }\r\n\r\n    function transfer(address registry, uint token) public {\r\n        // transfer nft from borrower to proxy\r\n        NFTLike(registry).transferFrom(msg.sender, address(this), token);\r\n        emit Transfer(registry, token);\r\n    }\r\n\r\n    function lock(address shelf, uint loan) public {\r\n        ShelfLike(shelf).lock(loan);\r\n        emit Lock(shelf, loan);\r\n    }\r\n\r\n    function borrowWithdraw(address shelf, uint loan, uint amount, address usr) public {\r\n        ShelfLike(shelf).borrow(loan, amount);\r\n        ShelfLike(shelf).withdraw(loan, amount, usr);\r\n        emit BorrowWithdraw(shelf, loan, amount, usr);\r\n    }\r\n\r\n    function repay(address shelf, address erc20, uint loan, uint amount) public {\r\n        // don't allow repaying more than the debt as currency would get stuck in the proxy\r\n        uint debt = PileLike(ShelfLike(shelf).pile()).debt(loan);\r\n        if (amount > debt) {\r\n            amount = debt;\r\n        }\r\n\r\n        _repay(shelf, erc20, loan, amount);\r\n    }\r\n\r\n    function repayFullDebt(address shelf, address pile, address erc20, uint loan) public {\r\n        _repay(shelf, erc20, loan, PileLike(pile).debt(loan));\r\n    }\r\n\r\n    function _repay(address shelf, address erc20, uint loan, uint amount) internal {\r\n        // transfer money from borrower to proxy\r\n        ERC20Like(erc20).transferFrom(msg.sender, address(this), amount);\r\n        ERC20Like(erc20).approve(address(shelf), amount);\r\n        ShelfLike(shelf).repay(loan, amount);\r\n        emit Repay(shelf, erc20, loan, amount);\r\n    }\r\n\r\n    function unlock(address shelf, address registry, uint token, uint loan) public {\r\n        ShelfLike(shelf).unlock(loan);\r\n        NFTLike(registry).transferFrom(address(this), msg.sender, token);\r\n        emit Unlock(shelf, registry, token, loan);\r\n    }\r\n\r\n    function close(address shelf, uint loan) public {\r\n        ShelfLike(shelf).close(loan);\r\n        emit Close(shelf, loan);\r\n    }\r\n\r\n    // --- Borrower Wrappers ---\r\n    function transferIssue(address shelf, address registry, uint token) public returns (uint loan) {\r\n        transfer(registry, token);\r\n        return issue(shelf, registry, token);\r\n    }\r\n\r\n    function lockBorrowWithdraw(address shelf, uint loan, uint amount, address usr) public {\r\n        lock(shelf, loan);\r\n        borrowWithdraw(shelf, loan, amount, usr);\r\n    }\r\n\r\n    function transferIssueLockBorrowWithdraw(address shelf, address registry, uint token, uint amount, address usr) public {\r\n        uint loan = transferIssue(shelf, registry, token);\r\n        lockBorrowWithdraw(shelf, loan, amount, usr);\r\n    }\r\n\r\n    function repayUnlockClose(address shelf, address pile, address registry, uint token, address erc20, uint loan) public {\r\n        repayFullDebt(shelf, pile, erc20, loan);\r\n        unlock(shelf, registry, token, loan);\r\n        close(shelf, loan);\r\n    }\r\n\r\n    // --- Misc Functions ---\r\n    function approveNFT(address registry, address usr, uint tokenAmount) public {\r\n        NFTLike(registry).approve(usr, tokenAmount);\r\n        emit ApproveNFT(registry, usr, tokenAmount);\r\n    }\r\n\r\n    function approveERC20(address erc20, address usr, uint amount) public {\r\n        ERC20Like(erc20).approve(usr, amount);\r\n        emit ApproveERC20(erc20, usr, amount);\r\n    }\r\n\r\n    function transferERC20(address erc20, address dst, uint amount) public {\r\n        ERC20Like(erc20).transfer(dst, amount);\r\n        emit TransferERC20(erc20, dst, amount);\r\n    }\r\n\r\n}","ABI":"[{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"ApproveERC20\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"tokenAmount\",\"type\":\"uint256\"}],\"name\":\"ApproveNFT\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"}],\"name\":\"BorrowWithdraw\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"Close\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"}],\"name\":\"Issue\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"Lock\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"Repay\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"TransferERC20\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"Unlock\",\"type\":\"event\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"approveERC20\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"tokenAmount\",\"type\":\"uint256\"}],\"name\":\"approveNFT\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"}],\"name\":\"borrowWithdraw\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"close\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"}],\"name\":\"issue\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"lock\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"}],\"name\":\"lockBorrowWithdraw\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"repay\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"pile\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"repayFullDebt\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"pile\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"repayUnlockClose\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"erc20\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"transferERC20\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"}],\"name\":\"transferIssue\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"}],\"name\":\"transferIssueLockBorrowWithdraw\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"shelf\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"registry\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"token\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"loan\",\"type\":\"uint256\"}],\"name\":\"unlock\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]","ContractName":"Actions","CompilerVersion":"v0.5.15+commit.6a57276f","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"None","Proxy":"0","Implementation":"","SwarmSource":"bzzr://a09ed7b54272063921292420c794b1b5e5ecc6345b70c73d8a02fd238ffcb28f"}]}