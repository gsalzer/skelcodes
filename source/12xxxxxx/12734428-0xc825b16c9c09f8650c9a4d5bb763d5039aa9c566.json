{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity >=0.7.0;\r\npragma experimental ABIEncoderV2;\r\n\r\ncontract Addresses {\r\n\taddress constant public ACTIONS = 0x80F33ED0A69935dd74310b9D0009D0BA647Cf223;\r\n\taddress constant public ASSESSOR = 0x76343D8BDACAFbabE2a4476ec004Ac3D5501DdF8;\r\n\taddress constant public COLLECTOR = 0x813B7c6692A56ff440eD6C638b7357d040bC8958;\r\n\taddress constant public COORDINATOR = 0x3e3f323a95018Ee133D47c4841f5AF235E2aF4f5;\r\n\taddress constant public FEED = 0xd9b2471F5c7494254b8d52f4aB3146e747ABc9AB;\r\n\taddress constant public JUNIOR_MEMBERLIST = 0x364B69aFc0101Af31089C5aE234D8444C355e8a0;\r\n\taddress constant public JUNIOR_OPERATOR = 0x54c2B9AE8D556c74677dA2e286c8198b354E7d27;\r\n\taddress constant public JUNIOR_TOKEN = 0xD7a70741B44F5ddaB371c2D2EB9D030A7c1a4BA0;\r\n\taddress constant public JUNIOR_TRANCHE = 0xF53EBEDAe8E3e0C77BA12e26c504ee1B0Eccd147;\r\n\taddress constant public PILE = 0xAAEaCfcCc3d3249f125Ba0644495560309C266cB;\r\n\taddress constant public POOL_ADMIN = 0x68c19d14937e43ACa58538628ac2F99e167F2C9C;\r\n\taddress constant public PROXY_REGISTRY = 0xC9045c815bF123ad12EA75b9A7c579C1e05051f9;\r\n\taddress constant public RESERVE = 0x5Aa3F927619d522d21AE9522F018030038aDC0E6;\r\n\taddress constant public ROOT = 0x235893Bf9695F68a922daC055598401D832b538b;\r\n\taddress constant public SENIOR_MEMBERLIST = 0x3e77f47e5e1Ec71fabE473347400A06d9Af13eE3;\r\n\taddress constant public SENIOR_OPERATOR = 0x2844b69835F182190eB6F602C6cfA2981E143c20;\r\n\taddress constant public SENIOR_TOKEN = 0x419A0B6f55Ff030cC50c6C5178d579D5828D8Db8;\r\n\taddress constant public SENIOR_TRANCHE = 0xB9c79d0721E378D9CF8D18a1e74CB462D57B571F;\r\n\taddress constant public SHELF = 0x4Ca7049E61629407a7E829564C1Dd2538d70182C;\r\n\taddress constant public TINLAKE_CURRENCY = 0xad3E3Fc59dff318BecEaAb7D00EB4F68b1EcF195;\r\n\taddress constant public TITLE = 0x33a764604EA9624B4258d7d6dCc08Ce2b8EDa825; \r\n\taddress constant public POOL_REGISTRY = 0xddf1C516Cf87126c6c610B52FD8d609E67Fb6033;\r\n}\r\n\r\n\r\ninterface SpellTinlakeRootLike {\r\n    function relyContract(address, address) external;\r\n}\r\ninterface SpellReserveLike {\r\n    function payout(uint currencyAmount) external;\r\n}\r\n\r\ninterface DependLike {\r\n    function depend(bytes32, address) external;\r\n}\r\n\r\ninterface AuthLike {\r\n    function rely(address) external;\r\n    function deny(address) external;\r\n    function wards(address) external returns(uint);\r\n}\r\n\r\ninterface PoolRegistryLike {\r\n  function file(address pool, bool live, string memory name, string memory data) external;\r\n  function find(address pool) external view returns (bool live, string memory name, string memory data);\r\n}\r\n\r\ninterface MigrationLike {\r\n    function migrate(address) external;\r\n}\r\n\r\ninterface SpellERC20Like {\r\n    function balanceOf(address) external view returns (uint256);\r\n    function transferFrom(address, address, uint) external returns (bool);\r\n    function approve(address, uint) external;\r\n}\r\n\r\ncontract TinlakeSpell is Addresses {\r\n\r\n    bool public done;\r\n    string constant public description = \"Tinlake Reserve migration spell\";\r\n\r\n    // TODO: replace the following address\r\n    address constant public RESERVE_NEW = 0xB12e705733042610174ed22F6726d26DB12DBdFE;\r\n    string constant public IPFS_HASH = \"QmbaWWRy2MAsABKvCstdWmLzdKfvujTEQNq7qWuz2sr6sg\";\r\n\r\n    function cast() public {\r\n        require(!done, \"spell-already-cast\");\r\n        done = true;\r\n        execute();\r\n    }\r\n\r\n    function execute() internal {\r\n        SpellTinlakeRootLike root = SpellTinlakeRootLike(ROOT);\r\n\r\n        // set spell as ward on the core contract to be able to wire the new contracts correctly\r\n        root.relyContract(SHELF, address(this));\r\n        root.relyContract(COLLECTOR, address(this));\r\n        root.relyContract(JUNIOR_TRANCHE, address(this));\r\n        root.relyContract(SENIOR_TRANCHE, address(this));\r\n        // root.relyContract(CLERK, address(this));\r\n        root.relyContract(ASSESSOR, address(this));\r\n        root.relyContract(COORDINATOR, address(this));\r\n        root.relyContract(RESERVE, address(this));\r\n        root.relyContract(RESERVE_NEW, address(this));\r\n        \r\n        migrateReserve();\r\n        updateRegistry();\r\n    }\r\n\r\n    function migrateReserve() internal {\r\n        MigrationLike(RESERVE_NEW).migrate(RESERVE);\r\n\r\n        // migrate dependencies \r\n        DependLike(RESERVE_NEW).depend(\"assessor\", ASSESSOR);\r\n        DependLike(RESERVE_NEW).depend(\"currency\", TINLAKE_CURRENCY);\r\n        DependLike(RESERVE_NEW).depend(\"shelf\", SHELF);\r\n        // DependLike(RESERVE_NEW).depend(\"lending\", CLERK);\r\n        DependLike(RESERVE_NEW).depend(\"pot\", RESERVE_NEW);\r\n        DependLike(SHELF).depend(\"distributor\", RESERVE_NEW);\r\n        DependLike(SHELF).depend(\"lender\", RESERVE_NEW);\r\n        DependLike(COLLECTOR).depend(\"distributor\", RESERVE_NEW);\r\n        DependLike(JUNIOR_TRANCHE).depend(\"reserve\", RESERVE_NEW);\r\n        DependLike(SENIOR_TRANCHE).depend(\"reserve\", RESERVE_NEW);\r\n        // DependLike(CLERK).depend(\"reserve\", RESERVE_NEW); \r\n        DependLike(ASSESSOR).depend(\"reserve\", RESERVE_NEW);\r\n        DependLike(COORDINATOR).depend(\"reserve\", RESERVE_NEW);\r\n\r\n        // migrate permissions\r\n        AuthLike(RESERVE_NEW).rely(JUNIOR_TRANCHE);\r\n        AuthLike(RESERVE_NEW).rely(SENIOR_TRANCHE);\r\n        AuthLike(RESERVE_NEW).rely(ASSESSOR);\r\n        // AuthLike(RESERVE_NEW).rely(CLERK);\r\n\r\n        // AuthLike(CLERK).rely(RESERVE_NEW);\r\n        // AuthLike(CLERK).deny(RESERVE);\r\n        AuthLike(ASSESSOR).rely(RESERVE_NEW);\r\n        AuthLike(ASSESSOR).deny(RESERVE);\r\n        \r\n        // migrate reserve balance\r\n        SpellERC20Like currency = SpellERC20Like(TINLAKE_CURRENCY);\r\n        uint balanceReserve = currency.balanceOf(RESERVE);\r\n        SpellReserveLike(RESERVE).payout(balanceReserve);\r\n        currency.transferFrom(address(this), RESERVE_NEW, balanceReserve);\r\n    }\r\n\r\n    function updateRegistry() internal {\r\n        PoolRegistryLike(POOL_REGISTRY).file(ROOT, true, \"Pezesha-1\", IPFS_HASH);\r\n    }\r\n}","ABI":"[{\"inputs\":[],\"name\":\"ACTIONS\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"ASSESSOR\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"COLLECTOR\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"COORDINATOR\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"FEED\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"IPFS_HASH\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"JUNIOR_MEMBERLIST\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"JUNIOR_OPERATOR\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"JUNIOR_TOKEN\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"JUNIOR_TRANCHE\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"PILE\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"POOL_ADMIN\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"POOL_REGISTRY\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"PROXY_REGISTRY\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"RESERVE\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"RESERVE_NEW\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"ROOT\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"SENIOR_MEMBERLIST\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"SENIOR_OPERATOR\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"SENIOR_TOKEN\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"SENIOR_TRANCHE\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"SHELF\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"TINLAKE_CURRENCY\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"TITLE\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"cast\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"description\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"done\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]","ContractName":"TinlakeSpell","CompilerVersion":"v0.7.6+commit.7338295f","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"None","Proxy":"0","Implementation":"","SwarmSource":"ipfs://8e4e922786f1df53c015be64082dceddd779507978f0911a518320515b3c2292"}]}