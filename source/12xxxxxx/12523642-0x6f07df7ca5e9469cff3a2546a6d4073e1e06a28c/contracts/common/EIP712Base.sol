pragma solidity 0.6.6;

import { Initializable } from "@openzeppelin/contracts-upgradeable/proxy/Initializable.sol";

contract EIP712Base is Initializable {
	struct EIP712Domain {
		string name;
		string version;
		address verifyingContract;
		bytes32 salt;
	}

	string public constant ERC712_VERSION = "1";

	bytes32 internal constant EIP712_DOMAIN_TYPEHASH =
		keccak256(
			bytes(
				"EIP712Domain(string name,string version,address verifyingContract,bytes32 salt)"
			)
		);
	bytes32 internal domainSeperator;

	function _initializeEIP712(string memory name) internal initializer {
		_setDomainSeperator(name);
	}

	function _setDomainSeperator(string memory name) internal {
		domainSeperator = keccak256(
			abi.encode(
				EIP712_DOMAIN_TYPEHASH,
				keccak256(bytes(name)),
				keccak256(bytes(ERC712_VERSION)),
				address(this),
				bytes32(getChainId())
			)
		);
	}

	function getDomainSeperator() public view returns (bytes32) {
		return domainSeperator;
	}

	function getChainId() public pure returns (uint256) {
		uint256 id;
		assembly {
			id := chainid()
		}
		return id;
	}

	function toTypedMessageHash(bytes32 messageHash) internal view returns (bytes32) {
		return keccak256(abi.encodePacked("\x19\x01", getDomainSeperator(), messageHash));
	}
}

