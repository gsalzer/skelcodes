{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.8.1;\r\n\r\ncontract ClockBoxContract {\r\n    mapping(address => uint256) private _balances;\r\n\r\n    mapping(address => mapping(address => uint256)) private _allowances;\r\n\r\n    // lockedBalances of sender\r\n    mapping(address => uint256) internal _lockedBalances;\r\n\r\n    mapping(bytes32 => Keeper) internal keepers;\r\n\r\n    uint256 internal feePercentage;\r\n\r\n    // address to pay fee to\r\n    address payable internal feeAddress;\r\n\r\n    uint256 private _totalSupply;\r\n\r\n    string private _name;\r\n    string private _symbol;\r\n    uint8 private _decimals;\r\n\r\n    address public admin;\r\n\r\n    struct Keeper {\r\n        address sender;\r\n        uint256 value;\r\n        address recipient;\r\n        uint256 dateLocked;\r\n        uint256 lockUntill;\r\n    }\r\n\r\n    event NewKeeper(\r\n        address indexed sender,\r\n        uint256 value,\r\n        address indexed recipient,\r\n        uint256 dateLocked, // block.timestamp\r\n        uint256 indexed lockUntill, // timestamp (millisecond)\r\n        bytes32 hash\r\n    );\r\n\r\n    event Transfer(address from, address to, uint256 value);\r\n\r\n    event Approval(address from, address recipient, uint256 amount);\r\n\r\n    constructor(address _admin, address _feeAddress) {\r\n        _name = \"ClockBox\";\r\n        _symbol = \"CLOCK\";\r\n        _decimals = 16;\r\n        admin = _admin;\r\n        mint(100000000 * 10**decimals());\r\n\r\n        // 0.25% of value stored in the contract\r\n        feePercentage = 25;\r\n        feeAddress = payable(_feeAddress);\r\n    }\r\n\r\n    function name() public view returns (string memory) {\r\n        return _name;\r\n    }\r\n\r\n    function symbol() public view returns (string memory) {\r\n        return _symbol;\r\n    }\r\n\r\n    function decimals() public view returns (uint8) {\r\n        return _decimals;\r\n    }\r\n\r\n    function totalSupply() public view returns (uint256) {\r\n        return _totalSupply;\r\n    }\r\n\r\n    function balanceOf(address account) public view returns (uint256) {\r\n        return _balances[account];\r\n    }\r\n\r\n    /// Transfer value from sender to recipient\r\n    function transfer(address recipient, uint256 amount) public returns (bool) {\r\n        _transfer(msg.sender, recipient, amount);\r\n\r\n        return true;\r\n    }\r\n\r\n    /// Returns the amount of value a spender is allowed to spend on behalf of the owner\r\n    function allowance(address _owner, address spender) public view returns (uint256) {\r\n        return _allowances[_owner][spender];\r\n    }\r\n\r\n    // Set amount that a spender is allowed to spend on behalf of the sender\r\n    function approve(address spender, uint256 amount) public returns (bool) {\r\n        _approve(msg.sender, spender, amount);\r\n\r\n        return true;\r\n    }\r\n\r\n    /// Allows spender transfer from owner using allowance\r\n    function transferFrom(\r\n        address sender,\r\n        address recipient,\r\n        uint256 amount\r\n    ) public returns (bool) {\r\n        _transfer(sender, recipient, amount);\r\n\r\n        uint256 currentAllowance = _allowances[sender][msg.sender];\r\n        require(currentAllowance >= amount, \"Amount exceeds allowance\");\r\n        _approve(sender, msg.sender, currentAllowance - amount);\r\n\r\n        return true;\r\n    }\r\n\r\n    function increaseAllowance(address spender, uint256 addedValue) public returns (bool) {\r\n        uint256 currentAllowance = _allowances[msg.sender][spender];\r\n        _approve(msg.sender, spender, currentAllowance + addedValue);\r\n        return true;\r\n    }\r\n\r\n    // Create new token\r\n    function mint(uint256 _amount) public onlyAdmin returns (bool) {\r\n        _mint(msg.sender, _amount);\r\n\r\n        return true;\r\n    }\r\n\r\n    // destroy tokens\r\n    function burn(uint256 _amount) public onlyAdmin returns (bool) {\r\n        _burn(msg.sender, _amount);\r\n\r\n        return true;\r\n    }\r\n\r\n    function decreaseAllowance(address spender, uint256 subtractedValue) public returns (bool) {\r\n        uint256 currentAllowance = _allowances[msg.sender][spender];\r\n        require(currentAllowance >= subtractedValue, \"Decreased allowance below zero\");\r\n        _approve(msg.sender, spender, currentAllowance - subtractedValue);\r\n\r\n        return true;\r\n    }\r\n\r\n    /// Set amount a spender can spend on behalf of the owner\r\n    function _approve(\r\n        address _owner,\r\n        address spender,\r\n        uint256 amount\r\n    ) internal {\r\n        require(_owner != address(0), \"Approve from zero address\");\r\n        require(spender != address(0), \"Approve to zero address\");\r\n\r\n        _allowances[_owner][spender] = amount;\r\n        emit Approval(_owner, spender, amount);\r\n    }\r\n\r\n    function _transfer(\r\n        address sender,\r\n        address recipient,\r\n        uint256 amount\r\n    ) internal {\r\n        require(sender != address(0), \"Transfering from zero address\");\r\n        require(recipient != address(0), \"Transfering to zero address\");\r\n\r\n        uint256 senderBalance = _balances[sender];\r\n        require(senderBalance >= amount, \"Insuffiencet balance\");\r\n        _balances[sender] = senderBalance - amount;\r\n        _balances[recipient] += amount;\r\n\r\n        emit Transfer(sender, recipient, amount);\r\n    }\r\n\r\n    /// create new tokens and emit event from the zero address\r\n    function _mint(address account, uint256 amount) internal {\r\n        require(account != address(0), \"Mint to the zero address\");\r\n\r\n        _totalSupply += amount;\r\n        _balances[account] += amount;\r\n        emit Transfer(address(0), account, amount);\r\n    }\r\n\r\n    /// Destroy tokens - Send amount\r\n    function _burn(address account, uint256 amount) internal {\r\n        require(account != address(0), \"Burn from the zero address\");\r\n\r\n        uint256 accountBalance = _balances[account];\r\n        require(accountBalance >= amount, \"Burn amount exceeds balance\");\r\n        _balances[account] = accountBalance - amount;\r\n        _totalSupply -= amount;\r\n\r\n        emit Transfer(account, address(0), amount);\r\n    }\r\n\r\n    /*\r\n        ## Overview\r\n\r\n        Accept ETH from users, deduct 0.25% from the value sent\r\n        store the new amount in the smart contract (vault).\r\n        Emits a NewKeeper event for every new storage to the vault\r\n        When the lock time elapses, the stored value is sent to the intended recipient\r\n        The withdraw function is called by the dapp and this is trigger by outside schecdular\r\n        A `Transfer` event is also emited after every withdrawal\r\n\r\n        The smart contract is uses an owner priviliage to prevent anyone from sending ETH out.\r\n        Only the smart contract creator has priviliage to send ETH out.\r\n    */\r\n\r\n    // recieves ether from recipient\r\n    function vault(address _recipient, uint256 _lockTime) external payable {\r\n        uint256 fee = calculateFee(msg.value);\r\n        uint256 value = deductFeeFromValue(msg.value);\r\n        _lockedBalances[msg.sender] += value;\r\n\r\n        bytes32 hash = makeHash(msg.sender, _recipient, _lockTime);\r\n\r\n        // register keeper\r\n        keepers[hash] = (Keeper(msg.sender, value, _recipient, block.timestamp, _lockTime));\r\n\r\n        feeAddress.transfer(fee);\r\n        emit NewKeeper(msg.sender, value, _recipient, block.timestamp, _lockTime, hash);\r\n    }\r\n\r\n    function calculateFee(uint256 _valueSent) public view largerThen10000wie(_valueSent) returns (uint256) {\r\n        uint256 fee = (_valueSent * feePercentage) / 10000;\r\n\r\n        return fee;\r\n    }\r\n\r\n    function deductFeeFromValue(uint256 _valueSent) public view largerThen10000wie(_valueSent) returns (uint256) {\r\n        uint256 _value = _valueSent - calculateFee(_valueSent);\r\n\r\n        return _value;\r\n    }\r\n\r\n    function makeHash(\r\n        address _sender,\r\n        address _recipient,\r\n        uint256 _lockTime\r\n    ) internal pure returns (bytes32) {\r\n        bytes32 hash = keccak256(abi.encode(_sender, _recipient, _lockTime));\r\n\r\n        return hash;\r\n    }\r\n\r\n    /// Returns sender locked balance\r\n    function balanceOfInValut() external view returns (uint256) {\r\n        return _lockedBalances[msg.sender];\r\n    }\r\n\r\n    /// Returns balance in the vault after fee has been deducted\r\n    function balanceOfvault() external view returns (uint256) {\r\n        return address(this).balance;\r\n    }\r\n\r\n    /// Returns  the balnce of the address fees are been paid to\r\n    /// restricted to onlyOwner\r\n    function balanceOfFeeAddress() external view onlyAdmin returns (uint256) {\r\n        return address(feeAddress).balance;\r\n    }\r\n\r\n    /// Returns the record of a keeper\r\n    function getKeeper(bytes32 _hash) external view returns (Keeper memory) {\r\n        return keepers[_hash];\r\n    }\r\n\r\n    /// withdraw from the vault. Restricted to onlyOwner\r\n    function withdraw(bytes32 _hash) external onlyAdmin returns (bool) {\r\n        _withdrawFromvault(_hash);\r\n\r\n        return true;\r\n    }\r\n\r\n    // transfer ether from this smart contract to recipient\r\n    function _withdrawFromvault(bytes32 _hash) internal returns (bool) {\r\n        address to = keepers[_hash].recipient;\r\n        address payable recipient = payable(to);\r\n        address from = keepers[_hash].sender;\r\n        uint256 value = keepers[_hash].value;\r\n\r\n        // delete the record from valut - prevent double withdrawal(spending)\r\n        delete keepers[_hash];\r\n        /// @Review: should the record be deleted or should a field be updated that it has been withdrawn??\r\n\r\n        // transfer the value to the recipient\r\n        recipient.transfer(value);\r\n\r\n        emit Transfer(from, to, value);\r\n\r\n        return true;\r\n    }\r\n\r\n    modifier largerThen10000wie(uint256 _value) {\r\n        require((_value / 10000) * 10000 == _value, \"Amount is too low.\");\r\n        _;\r\n    }\r\n\r\n    modifier onlyAdmin() {\r\n        require(msg.sender == admin, \"Only owner can perform this operation\");\r\n\r\n        _;\r\n    }\r\n}","ABI":"[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_admin\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_feeAddress\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"dateLocked\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"lockUntill\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"bytes32\",\"name\":\"hash\",\"type\":\"bytes32\"}],\"name\":\"NewKeeper\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"admin\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"account\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"balanceOfFeeAddress\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"balanceOfInValut\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"balanceOfvault\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_valueSent\",\"type\":\"uint256\"}],\"name\":\"calculateFee\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"subtractedValue\",\"type\":\"uint256\"}],\"name\":\"decreaseAllowance\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_valueSent\",\"type\":\"uint256\"}],\"name\":\"deductFeeFromValue\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"_hash\",\"type\":\"bytes32\"}],\"name\":\"getKeeper\",\"outputs\":[{\"components\":[{\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"dateLocked\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"lockUntill\",\"type\":\"uint256\"}],\"internalType\":\"struct ClockBoxContract.Keeper\",\"name\":\"\",\"type\":\"tuple\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"addedValue\",\"type\":\"uint256\"}],\"name\":\"increaseAllowance\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_lockTime\",\"type\":\"uint256\"}],\"name\":\"vault\",\"outputs\":[],\"stateMutability\":\"payable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"_hash\",\"type\":\"bytes32\"}],\"name\":\"withdraw\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]","ContractName":"ClockBoxContract","CompilerVersion":"v0.8.4+commit.c7e474f2","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"000000000000000000000000b33b10b3d1d16e233ac3dea7c467f5913bb94ae20000000000000000000000003ceca0d228b02e4324bfe2865927e9c1f8c25e54","EVMVersion":"Default","Library":"","LicenseType":"None","Proxy":"0","Implementation":"","SwarmSource":"ipfs://b54847fc51a23ecf863481d9f1ebdb0d51c8bb155c2fb82d71d6b0ac1f4108aa"}]}