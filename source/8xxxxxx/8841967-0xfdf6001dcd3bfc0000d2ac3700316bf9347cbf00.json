{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity 0.5.11; // optimization runs: 200, evm version: petersburg\r\n\r\n\r\ninterface DharmaSmartWalletFactoryV1Interface {\r\n  function newSmartWallet(address userSigningKey) external returns (address wallet);\r\n}\r\n\r\n\r\ninterface DharmaSmartWalletImplementationV0Interface {\r\n  function setUserSigningKey(\r\n    address userSigningKey,\r\n    uint256 minimumActionGas,\r\n    bytes calldata userSignature,\r\n    bytes calldata dharmaSignature\r\n  ) external;\r\n  function getUserSigningKey() external view returns (address userSigningKey);\r\n}\r\n\r\n\r\n/**\r\n * A contract to update the user signing key on a smart wallet deployed or\r\n * counterfactually determined by a DharmaSmartWalletFactoryV1 contract, using\r\n * an existing smart wallet or deploying the smart wallet if necessary. Note\r\n * that this helper only supports V1 smart wallet factories - future versions\r\n * have similar functionality included directly, which improves reliability and\r\n * efficiency.\r\n */\r\ncontract SmartWalletFactoryV1UserSigningKeyUpdater {\r\n  function updateUserSigningKey(\r\n    address smartWallet,\r\n    DharmaSmartWalletFactoryV1Interface smartWalletFactory,\r\n    address currentUserSigningKey,\r\n    address newUserSigningKey,\r\n    uint256 minimumActionGas,\r\n    bytes calldata userSignature,\r\n    bytes calldata dharmaSignature\r\n  ) external returns (\r\n    DharmaSmartWalletImplementationV0Interface wallet\r\n  ) {\r\n    // Deploy a new smart wallet if needed. Factory emits a corresponding event.\r\n    wallet = _deployNewSmartWalletIfNeeded(\r\n      smartWalletFactory, currentUserSigningKey, smartWallet\r\n    );\r\n\r\n    // Set new user signing key. Smart wallet emits a corresponding event.\r\n    wallet.setUserSigningKey(\r\n      newUserSigningKey, minimumActionGas, userSignature, dharmaSignature\r\n    );\r\n  }\r\n\r\n  function _deployNewSmartWalletIfNeeded(\r\n    DharmaSmartWalletFactoryV1Interface smartWalletFactory,\r\n    address userSigningKey,\r\n    address expectedSmartWallet\r\n  ) internal returns (\r\n    DharmaSmartWalletImplementationV0Interface smartWallet\r\n  ) {\r\n    // Only deploy if a smart wallet doesn't already exist at expected address.\r\n    uint256 size;\r\n    assembly { size := extcodesize(expectedSmartWallet) }\r\n    if (size == 0) {\r\n      // Deploy the smart wallet.\r\n      smartWallet = DharmaSmartWalletImplementationV0Interface(\r\n        smartWalletFactory.newSmartWallet(userSigningKey)\r\n      );\r\n    } else {\r\n      // Reuse the supplied smart wallet address. Note that this helper does\r\n      // not perform an extcodehash check, meaning that a contract that is\r\n      // not actually a smart wallet may be supplied instead.\r\n      smartWallet = DharmaSmartWalletImplementationV0Interface(\r\n        expectedSmartWallet\r\n      );\r\n\r\n      // Ensure that the smart wallet in question has the right key.\r\n      require(\r\n        smartWallet.getUserSigningKey() == userSigningKey,\r\n        \"Existing user signing key differs from supplied current signing key.\"\r\n      );\r\n    }\r\n  }\r\n}","ABI":"[{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"smartWallet\",\"type\":\"address\"},{\"internalType\":\"contract DharmaSmartWalletFactoryV1Interface\",\"name\":\"smartWalletFactory\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"currentUserSigningKey\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"newUserSigningKey\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"minimumActionGas\",\"type\":\"uint256\"},{\"internalType\":\"bytes\",\"name\":\"userSignature\",\"type\":\"bytes\"},{\"internalType\":\"bytes\",\"name\":\"dharmaSignature\",\"type\":\"bytes\"}],\"name\":\"updateUserSigningKey\",\"outputs\":[{\"internalType\":\"contract DharmaSmartWalletImplementationV0Interface\",\"name\":\"wallet\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]","ContractName":"SmartWalletFactoryV1UserSigningKeyUpdater","CompilerVersion":"v0.5.11+commit.c082d0b4","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"","LicenseType":"MIT","SwarmSource":"bzzr://b0b341f3c9ee4c09cee2a5814368a8edd4c03c91d261d84ffee53f75cca8493b"}]}