{"status":"1","message":"OK","result":[{"SourceCode":"{\"Bank.sol\":{\"content\":\"pragma solidity ^0.5.0;\\nimport \\\"./SmartLoan.sol\\\";\\nimport \\\"./TimeSim.sol\\\";\\n\\n/*\\nThis contract should not be considered as a part of the Securitization contracts\\nIts merely a tool to facilitate creation and tracking of loans and therefore\\nonly contains the most basic functionalites\\n*/\\ncontract Bank {\\n  uint256 public LoansNumber;\\n  address public BankDirector;\\n  address public TmpLoanAddress;\\n  address public TimeAddress;\\n  address public Securitization;\\n  mapping(address =\\u003e address) public AccountsToLoans;\\n  address[] public Loans;\\n  TimeSim Time;\\n  SmartLoan TmpLoan;\\n\\n  modifier OnlyDirector {\\n    require(msg.sender == BankDirector, \\\"Invalid BankDirector\\\");\\n    _;\\n    // if (msg.sender == BankDirector) _;\\n    // else revert(\\\"\\\");\\n  }\\n\\n  function SetSecuritization(address sfc) public {\\n    Securitization = sfc;\\n  }\\n\\n  constructor() public {\\n    Time = new TimeSim();\\n    TimeAddress = address(Time);\\n    BankDirector = msg.sender;\\n  }\\n\\n  function GetLoanAddress() public view returns (address) {\\n    return AccountsToLoans[msg.sender];\\n  }\\n  function getLoans() public view returns (address[] memory) {\\n    return Loans;\\n  }\\n  function NewOwner(address payable LedgerAddress) public {\\n    for (uint256 i = 0; i \\u003c LoansNumber; i++) {\\n      SmartLoan(Loans[i]).Transfer(LedgerAddress);\\n    }\\n  }\\n  function Pay() public payable {\\n    for (uint256 i = 0; i \\u003c LoansNumber; i++) {\\n      SmartLoan(Loans[i]).PayIn(); //.value(1200000).gas(2500)();\\n    }\\n  }\\n\\n  function NewLoan(\\n    address _Borrower,\\n    uint256 _Balance,\\n    uint256 _InterestRateBPS,\\n    uint256 _TermMonths\\n  ) public OnlyDirector returns (address) {\\n    TmpLoan = new SmartLoan(address(this), _Balance, _InterestRateBPS, _TermMonths, TimeAddress);\\n    TmpLoanAddress = address(TmpLoan);\\n    AccountsToLoans[_Borrower] = TmpLoanAddress;\\n    Loans.push(TmpLoanAddress);\\n    LoansNumber++;\\n    return TmpLoanAddress;\\n  }\\n\\n  function() external payable {}\\n\\n}\\n\"},\"SmartLoan.sol\":{\"content\":\"pragma solidity ^0.5.0;\\n\\nimport \\\"./TimeSim.sol\\\";\\ncontract SmartLoan {\\n  /*\\n  TO DO:\\n  move the state variables into a struct\\n  check for overflows\\n  */\\n\\n  /*\\n  The SmartLoan contract represents the loan which the originator grants to the\\n  borrowers. The originator sends the loan balance to the borrower and deploys the\\n  contract code on the blockchain. The code allows to track the loan, to make\\n  payments to the loan and to withdraw funds from it.\\n  */\\n\\n  /*\\n  Variables\\n  -------------------------------------------------------------------------------\\n  */\\n  uint256 public OriginalBalance;\\n  uint256 public CurrentBalance;\\n  uint256 public IntPaidIn;\\n  uint256 public PrinPaidIn;\\n  uint256 public MonthlyInstallment;\\n  uint256 public InterestRateBasisPoints;\\n  uint256 public OriginalTermMonths;\\n  uint256 public RemainingTermMonths;\\n  uint256 public NextPaymentDate;\\n  uint256 public PaymentsMade;\\n  uint256 public OverdueDays;\\n\\n  uint256 public Now;\\n  uint256[120] public PaymentDates;\\n\\n  bool public ContractCurrent = true;\\n\\n  address payable public LenderAddress;\\n  address public TimeAddress;\\n\\n  TimeSim Time;\\n\\n  /*\\nModifiers\\n-------------------------------------------------------------------------------\\n*/\\n  modifier OnlyLender {\\n    require(msg.sender == LenderAddress, \\\"Error lender address\\\");\\n    _;\\n  }\\n\\n  /*\\n    Constructor\\n    -------------------------------------------------------------------------------\\n    •\\tlenderAddress: This is the adress of an account on the blockchain. The account\\n    can be controlled by a human or another contract. Whoever controls this account\\n    is allowed to withdraw paidin funds from the Smartloan contract.\\n    •\\tbalance: The principal balance of the loan which must be repaid by the\\n      borrower\\n    •\\tinterestRateBasisPoints: The interstate charged on the loan. It is given in\\n      basispoints i.e. the input for 5% interest would be 500\\n    •\\ttermMonths: The term of the loan in moths. In this implementation fixed to 12.\\n    */\\n  constructor(\\n    address payable lenderAddress,\\n    uint256 balance,\\n    uint256 interestRateBasisPoints,\\n    uint256 termMonths,\\n    address timeAddress\\n  ) public {\\n    LenderAddress = lenderAddress;\\n    TimeAddress = timeAddress;\\n    OriginalBalance = balance;\\n    CurrentBalance = balance;\\n    InterestRateBasisPoints = interestRateBasisPoints;\\n    OriginalTermMonths = termMonths;\\n    RemainingTermMonths = termMonths;\\n    Time = TimeSim(timeAddress);\\n\\n    /*\\n    the calculation of the monhtly installment needs divions. Since floats are not\\n    availabe, we make the calc in a way to reduce rounding error:\\n    */\\n    uint256 MonthlyInstallment1 = (\\n        interestRateBasisPoints * (10000 * termMonths + interestRateBasisPoints) ** termMonths\\n      ) /\\n      1000000;\\n    uint256 MonthlyInstallment2 = (\\n        (10000 * termMonths + interestRateBasisPoints) **\\n          termMonths *\\n          10000 *\\n          termMonths -\\n          10000 **\\n          (termMonths + 1) *\\n          termMonths **\\n          (termMonths + 1)\\n      ) /\\n      1000000;\\n\\n    // if (MonthlyInstallment2 != 0)\\n    //   MonthlyInstallment = balance * (MonthlyInstallment1) / (MonthlyInstallment2 + 1);\\n\\n    if (MonthlyInstallment2 != 0)\\n      MonthlyInstallment = balance * MonthlyInstallment1 / (MonthlyInstallment2 + 1);\\n\\n    for (uint256 k = 0; k \\u003c termMonths; k++) {\\n      PaymentDates[k] = now + (k + 1) * 30 days;\\n    }\\n\\n    NextPaymentDate = PaymentDates[0];\\n  }\\n\\n  /*\\n  Function to read the state\\n  */\\n  function Read() public view returns (uint256[11] memory) {\\n    return [\\n      OverdueDays,\\n      OriginalBalance,\\n      CurrentBalance,\\n      NextPaymentDate,\\n      IntPaidIn,\\n      PrinPaidIn,\\n      MonthlyInstallment,\\n      InterestRateBasisPoints,\\n      OriginalTermMonths,\\n      RemainingTermMonths,\\n      address(this).balance\\n    ];\\n  }\\n\\n  /*\\n  self explanatory\\n  */\\n  function ReadTime() public view returns (address) {\\n    return TimeAddress;\\n  }\\n\\n  /*\\n  Updates the state after installment is paid in\\n  */\\n  function ContractCurrentUpdate() private returns (uint256) {\\n    PaymentsMade = OriginalTermMonths - RemainingTermMonths;\\n    NextPaymentDate = PaymentDates[PaymentsMade];\\n\\n    if (Time.Now() \\u003e NextPaymentDate \\u0026\\u0026 RemainingTermMonths != 0) {\\n      ContractCurrent = false;\\n      OverdueDays = (Time.Now() - NextPaymentDate) / (60 * 60 * 24);\\n      return OverdueDays;\\n    }\\n\\n    OverdueDays = 0;\\n    ContractCurrent = true;\\n    return OverdueDays;\\n  }\\n\\n  /*\\n  This function is essential for transfer of ownership. The lenderAddress owner\\n  has the option to grant its rights to withdraw funds from the loan to another\\n  party. In our case this will be another contract on the blockchain to which the\\n  originator \\\"sells \\\" the loan.\\n  */\\n  function Transfer(address payable NewLender) public OnlyLender() {\\n    LenderAddress = NewLender;\\n  }\\n\\n  /*\\n  Allows the borrower to pay an installment. The installments are of equal size\\n  depending on the interest rate, original balance and loanterm. The installment\\n  has an interest and a principal portion, it is not possible to pay more or less\\n  than one installment by using this function. Upon payment of the installment,\\n  the contract updates its status information (see below).\\n  */\\n  function PayIn() public payable {\\n    uint256 Principal;\\n    uint256 Interest;\\n\\n    require(msg.value == MonthlyInstallment, \\\"Invalid MonthlyInstallment\\\");\\n    require(RemainingTermMonths != 0, \\\"RemainingTermMonths == 0\\\");\\n    //if (msg.value != MonthlyInstallment) throw;\\n    //if (RemainingTermMonths == 0) throw;\\n\\n    RemainingTermMonths--;\\n    Principal = CalculatePVOfInstallment(OriginalTermMonths - RemainingTermMonths);\\n    Interest = MonthlyInstallment - Principal;\\n    CurrentBalance -= Principal;\\n    IntPaidIn += Interest;\\n    PrinPaidIn += Principal;\\n\\n    ContractCurrentUpdate();\\n  }\\n\\n  /*\\n  Allows the lenderAddress owner to withdraw funds from the contract. This\\n  function also passes along the status of the loan.\\n  */\\n  function WithdrawIntPrin() public OnlyLender returns (uint256[10] memory) {\\n    uint256 intPaidIn = IntPaidIn;\\n    uint256 prinPaidIn = PrinPaidIn;\\n\\n    OverdueDays = ContractCurrentUpdate();\\n\\n    LenderAddress.transfer(IntPaidIn + PrinPaidIn);\\n    //if(LenderAddress.send(IntPaidIn + PrinPaidIn)==false) throw;\\n\\n    IntPaidIn = 0;\\n    PrinPaidIn = 0;\\n\\n    return [\\n      OverdueDays,\\n      OriginalBalance,\\n      CurrentBalance,\\n      NextPaymentDate,\\n      intPaidIn,\\n      prinPaidIn,\\n      MonthlyInstallment,\\n      InterestRateBasisPoints,\\n      OriginalTermMonths,\\n      RemainingTermMonths\\n    ];\\n  }\\n\\n  /*\\n  Function used for Present Vaule calc in the Principal portion calculation\\n  */\\n  function CalculatePVOfInstallment(uint256 periods) public view returns (uint256) {\\n    uint256 PV = MonthlyInstallment *\\n      (10000 * OriginalTermMonths) **\\n      periods /\\n      (10000 * OriginalTermMonths + InterestRateBasisPoints) **\\n      periods;\\n\\n    return PV;\\n  }\\n\\n}\\n\"},\"TimeSim.sol\":{\"content\":\"pragma solidity ^0.5.0;\\n\\n/*\\nThis is for simulation of passing time. Only necessary for testing\\n*/\\ncontract TimeSim {\\n  uint256 public Now;\\n  constructor() public {\\n    Now = now;\\n  }\\n  function Step() public {\\n    Now += 30 days;\\n  }\\n}\\n\"}}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"BankDirector\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"AccountsToLoans\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"GetLoanAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"LedgerAddress\",\"type\":\"address\"}],\"name\":\"NewOwner\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"sfc\",\"type\":\"address\"}],\"name\":\"SetSecuritization\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"Pay\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_Borrower\",\"type\":\"address\"},{\"name\":\"_Balance\",\"type\":\"uint256\"},{\"name\":\"_InterestRateBPS\",\"type\":\"uint256\"},{\"name\":\"_TermMonths\",\"type\":\"uint256\"}],\"name\":\"NewLoan\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"LoansNumber\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"TimeAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"Loans\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getLoans\",\"outputs\":[{\"name\":\"\",\"type\":\"address[]\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"Securitization\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"TmpLoanAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"}]","ContractName":"Bank","CompilerVersion":"v0.5.8+commit.23d335f2","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","LicenseType":"None","SwarmSource":"bzzr://087fdfba79a217ff71db99c2d3434d68d941e73a8ffaa7c2990fbe3567eefaa0"}]}