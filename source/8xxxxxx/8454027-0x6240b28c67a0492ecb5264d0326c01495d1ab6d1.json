{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.5.10;\r\n\r\ncontract Oracle {\r\n\r\n     /** Contract Constructor\r\n    * @param ethPrice the starting price of ETH in USD, represented as 150000000 = 150.00 USD\r\n    * @dev The message sender is assigned as the contract administrator\r\n    */\r\n    constructor (uint ethPrice) public {\r\n        admins[msg.sender] = true;\r\n        addAsset(\"ETHUSD\", ethPrice);\r\n    }\r\n\r\n    Asset[] public assets;\r\n    uint[8][] private prices; // includes 6 decimal places, 12000000 = 12.000000\r\n    mapping(address => bool) public admins;\r\n    mapping(address => bool) public readers;\r\n    uint public constant UPDATE_TIME_MIN = 18 hours;  // 18\r\n    uint public constant SETTLE_TIME_MIN = 5 days;   // 5\r\n    uint public constant EDIT_TIME_MAX = 30 minutes;   // allows oracle to rectify obvious mistakes\r\n    \r\n    struct Asset {\r\n        bytes32 name;\r\n        uint8 currentDay;\r\n        uint lastUpdateTime;\r\n        uint lastSettleTime;\r\n        bool isFinalDay;\r\n    }\r\n\r\n\r\n    event AssetAdded(\r\n        uint indexed id,\r\n        bytes32 name,\r\n        uint price\r\n    );\r\n\r\n\r\n    event PriceUpdated(\r\n        uint indexed id,\r\n        bytes32 indexed name,\r\n        uint price,\r\n        uint timestamp,\r\n        uint8 dayNumber\r\n    );\r\n\r\n        event PriceCorrected(\r\n        uint indexed id,\r\n        bytes32 indexed name,\r\n        uint price,\r\n        uint timestamp,\r\n        uint8 dayNumber\r\n    );\r\n\r\n        modifier onlyAdmin()\r\n    {\r\n        require(admins[msg.sender]);\r\n        _;\r\n    }\r\n\r\n     /** Grant administrator priviledges to a user\r\n    * @param newAdmin the address to promote\r\n    */\r\n    function addAdmin(address newAdmin)\r\n        public\r\n        onlyAdmin\r\n    {\r\n        admins[newAdmin] = true;\r\n    }\r\n\r\n    /** Add a new asset tracked by the Oracle\r\n    * @param _name the plaintext name of the asset\r\n    * @param _startPrice the starting price of the asset in USD * 10^6, eg 120000 = $0.120000\r\n    * @dev this should usually be called on a Settlement Day\r\n    * @return id the newly assigned ID of the asset\r\n    */\r\n    function addAsset(bytes32 _name, uint _startPrice)\r\n        public\r\n        returns (uint _assetID)\r\n    {\r\n        require (admins[msg.sender] || msg.sender == address(this));\r\n        // Fill the asset struct\r\n        Asset memory asset;\r\n        asset.name = _name;\r\n        asset.currentDay = 0;\r\n        asset.lastUpdateTime = now;\r\n        asset.lastSettleTime = now - 5 days;\r\n        assets.push(asset);\r\n        uint[8] memory _prices;\r\n        _prices[0] = _startPrice;\r\n        prices.push(_prices);\r\n        emit AssetAdded(assets.length - 1, _name, _startPrice);\r\n        return assets.length - 1;\r\n    }\r\n\r\n\r\n    /** Quickly fix an erroneous price\r\n    * @param _assetID the id of the asset to change\r\n    * @param _newPrice the new price to change to\r\n    * @dev this must be called within 30 minutes of the lates price update occurence\r\n    */\r\n    \r\n    function editPrice(uint _assetID, uint _newPrice)\r\n        public\r\n        onlyAdmin\r\n    {\r\n        Asset storage asset = assets[_assetID];\r\n        require(now < asset.lastUpdateTime + EDIT_TIME_MAX);\r\n        prices[_assetID][asset.currentDay] = _newPrice;\r\n        emit PriceCorrected(_assetID, asset.name, _newPrice, now, asset.currentDay);\r\n    }\r\n\r\n    /** Grant an address permision to access private information about the assets\r\n    * @param newReader the address of the account to grant reading priviledges\r\n    * @dev this allows the reader to use the getCurrentPricesFunction\r\n    */\r\n    function addReader(address newReader)\r\n        public\r\n        onlyAdmin\r\n    {\r\n        readers[newReader] = true;\r\n    }\r\n\r\n    /** Return the entire current price array for a given asset\r\n    * @param _assetID the asset id of the desired asset\r\n    * @return _priceHist the price array for the asset\r\n    * @dev only the admin and addresses granted readership may call this function\r\n    */\r\n    function getAllPrices(uint _assetID)\r\n        public\r\n        view\r\n        returns (uint[8] memory _priceHist)\r\n    {\r\n        require (admins[msg.sender] || readers[msg.sender]);\r\n        _priceHist = prices[_assetID];\r\n    }\r\n\r\n    /** Return only the latest prices\r\n    * @param _assetID the asset id of the desired asset\r\n    * @return _price the latest price of the given asset\r\n    * @dev only the admin or a designated reader may call this function\r\n    */\r\n    function getCurrentPrice(uint _assetID)\r\n        public\r\n        view\r\n        returns (uint _price)\r\n    {\r\n        require (admins[msg.sender] || readers[msg.sender]);\r\n        _price =  prices[_assetID][assets[_assetID].currentDay];\r\n    }\r\n\r\n    /** Get the timestamp of the last price update time\r\n    * @param _assetID the asset id of the desired asset\r\n    * @return timestamp the price update timestamp\r\n    */\r\n    function getLastUpdateTime(uint _assetID)\r\n        public\r\n        view\r\n        returns (uint timestamp)\r\n    {\r\n        timestamp = assets[_assetID].lastUpdateTime;\r\n    }\r\n\r\n    /** Get the timestamp of the last settle update time\r\n    * @param _assetID the asset id of the desired asset\r\n    * @return timestamp the settle timestamp\r\n    */\r\n    function getLastSettleTime(uint _assetID)\r\n        public\r\n        view\r\n        returns (uint timestamp)\r\n    {\r\n        timestamp = assets[_assetID].lastSettleTime;\r\n    }\r\n    /**\r\n    * @param _assetID the asset id of the desired asset\r\n    * pulls the day relevant for new AssetSwap takes\r\n    */\r\n    function getStartDay(uint _assetID)\r\n        public\r\n        view\r\n        returns (uint8 _startDay)\r\n    {\r\n        if (assets[_assetID].isFinalDay) _startDay = 7;\r\n        else if (assets[_assetID].currentDay == 7) _startDay = 1;\r\n        else _startDay = assets[_assetID].currentDay + 1;\r\n    }\r\n\r\n     /** Show if the current day is the final price update before settle\r\n    * @param _assetID the asset id of the desired asset\r\n    * @return true if it is the final day, false otherwise\r\n    * This makes sure the oracle cannot sneak it a settlement unaware\r\n    */\r\n    function isFinalDay(uint _assetID)\r\n        public\r\n        view\r\n        returns (bool)\r\n    {\r\n        return assets[_assetID].isFinalDay;\r\n    }\r\n\r\n    /** Show if the last price update was a settle price update\r\n    * @param _assetID the asset id of the desired asset\r\n    * @return true if the last update was a settle, false otherwise\r\n    */\r\n    function isSettleDay(uint _assetID)\r\n        public\r\n        view\r\n        returns (bool)\r\n    {\r\n        return (assets[_assetID].currentDay == 7);\r\n    }\r\n\r\n    /** Remove administrator priviledges from a user\r\n    * @param toRemove the address to demote\r\n    * @notice you may not remove yourself\r\n    */\r\n    function removeAdmin(address toRemove)\r\n        public\r\n        onlyAdmin\r\n    {\r\n        require(toRemove != msg.sender);\r\n        admins[toRemove] = false;\r\n    }\r\n\r\n      /** Publishes an asset price. Does not initiate a settlement.\r\n    * @param _assetID the ID of the asset to update\r\n    * @param _price the current price of the asset * 10^6\r\n    * @param finalDayStatus true if this is the last intraweek price update (the next will be a settle)\r\n    * @dev this can only be called after the required time has elapsed since the most recent price update\r\n    * @dev if finalDayStatus is true this function cannot be called again until after settle\r\n    */\r\n    function intraWeekPrice(uint _assetID, uint _price, bool finalDayStatus)\r\n        public\r\n        onlyAdmin\r\n    {\r\n        Asset storage asset = assets[_assetID];\r\n        // Prevent price update too early\r\n      require(now > asset.lastUpdateTime + UPDATE_TIME_MIN);\r\n    require(!asset.isFinalDay);\r\n        if (asset.currentDay == 7) {\r\n             asset.currentDay = 1;\r\n             uint[8] memory newPrices;\r\n             newPrices[0] = prices[_assetID][7];\r\n             newPrices[1] = _price;\r\n             prices[_assetID] = newPrices;\r\n        } else {\r\n            asset.currentDay = asset.currentDay + 1;\r\n            prices[_assetID][asset.currentDay] = _price;\r\n            asset.isFinalDay = finalDayStatus;\r\n        }\r\n        asset.lastUpdateTime = now;\r\n        emit PriceUpdated(_assetID, asset.name, _price, now, asset.currentDay);\r\n    }\r\n    \r\n        /** Publishes an asset price. Does not initiate a settlement.\r\n    * @param _assetID the ID of the asset to update\r\n    * @param _price the current price of the asset * 10^6\r\n    * @dev this can only be called after the required time has elapsed since the most recent price update\r\n    * @dev if finalDayStatus is true this function cannot be called again until after settle\r\n    */\r\n    function settlePrice(uint _assetID, uint _price)\r\n        public\r\n        onlyAdmin\r\n    {\r\n        Asset storage asset = assets[_assetID];\r\n        // Prevent price update too early\r\n        require(now > asset.lastUpdateTime + UPDATE_TIME_MIN);\r\n        require(asset.isFinalDay);\r\n        require(now > asset.lastSettleTime + SETTLE_TIME_MIN,\r\n            \"Sufficient time must pass between weekly price updates.\");\r\n             asset.currentDay = 7;\r\n             prices[_assetID][7] = _price;\r\n             asset.lastSettleTime = now;\r\n             asset.isFinalDay = false;\r\n        asset.lastUpdateTime = now;\r\n        emit PriceUpdated(_assetID, asset.name, _price, now, 7);\r\n        \r\n    }\r\n\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"name\":\"getAllPrices\",\"outputs\":[{\"name\":\"_priceHist\",\"type\":\"uint256[8]\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"name\":\"getLastSettleTime\",\"outputs\":[{\"name\":\"timestamp\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"toRemove\",\"type\":\"address\"}],\"name\":\"removeAdmin\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"name\":\"isFinalDay\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"name\":\"getStartDay\",\"outputs\":[{\"name\":\"_startDay\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"admins\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"readers\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"},{\"name\":\"_price\",\"type\":\"uint256\"},{\"name\":\"finalDayStatus\",\"type\":\"bool\"}],\"name\":\"intraWeekPrice\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"newAdmin\",\"type\":\"address\"}],\"name\":\"addAdmin\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"},{\"name\":\"_price\",\"type\":\"uint256\"}],\"name\":\"settlePrice\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_name\",\"type\":\"bytes32\"},{\"name\":\"_startPrice\",\"type\":\"uint256\"}],\"name\":\"addAsset\",\"outputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"name\":\"isSettleDay\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"newReader\",\"type\":\"address\"}],\"name\":\"addReader\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"SETTLE_TIME_MIN\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"EDIT_TIME_MAX\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"name\":\"getCurrentPrice\",\"outputs\":[{\"name\":\"_price\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"UPDATE_TIME_MIN\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"assets\",\"outputs\":[{\"name\":\"name\",\"type\":\"bytes32\"},{\"name\":\"currentDay\",\"type\":\"uint8\"},{\"name\":\"lastUpdateTime\",\"type\":\"uint256\"},{\"name\":\"lastSettleTime\",\"type\":\"uint256\"},{\"name\":\"isFinalDay\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"},{\"name\":\"_newPrice\",\"type\":\"uint256\"}],\"name\":\"editPrice\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_assetID\",\"type\":\"uint256\"}],\"name\":\"getLastUpdateTime\",\"outputs\":[{\"name\":\"timestamp\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"ethPrice\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"id\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"name\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"price\",\"type\":\"uint256\"}],\"name\":\"AssetAdded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"id\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"name\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"price\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"timestamp\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"dayNumber\",\"type\":\"uint8\"}],\"name\":\"PriceUpdated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"id\",\"type\":\"uint256\"},{\"indexed\":true,\"name\":\"name\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"price\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"timestamp\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"dayNumber\",\"type\":\"uint8\"}],\"name\":\"PriceCorrected\",\"type\":\"event\"}]","ContractName":"Oracle","CompilerVersion":"v0.5.10+commit.5a6ea5b1","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"000000000000000000000000000000000000000000000000000000000a1183c0","Library":"","SwarmSource":"bzzr://bed84fbbbbf34512179a02fc934dea9d39d9f357dc805d6e7a29207d066a2e41"}]}