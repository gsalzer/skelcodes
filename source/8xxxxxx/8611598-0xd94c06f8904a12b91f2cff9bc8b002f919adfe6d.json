{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.5.11;\r\n\r\ncontract StockBet {\r\n    \r\n    event GameCreated(uint bet);\r\n    event GameOpened(uint256 initialPrice);\r\n    event GameClosed();\r\n    event OracleSet(address oracle);\r\n    event FinalPriceSet(uint256 finalPrice);\r\n    event PlayerBet(address player, uint guess);\r\n    \r\n    event PlayersWin(uint result, uint256 splitJackpot);\r\n    event OwnerWins(address owner);\r\n    \r\n    enum State {\r\n        SETUP, PRICE_SET, OPEN, CLOSED, PLAYERS_WIN, OWNER_WIN\r\n    }\r\n\r\n    enum PaidStatus {\r\n        UNDEFINED,\r\n        NOT_PAID,\r\n        PAID\r\n    }\r\n    \r\n    struct Guess {\r\n        mapping (address => PaidStatus) players;\r\n        uint guesses_number;\r\n    }\r\n    \r\n    address payable public owner;\r\n    address public oracle;\r\n    State public state;\r\n\r\n    mapping (uint => Guess) public guesses;\r\n\r\n    uint256 public bet;\r\n    uint256 splitJackpot;\r\n    uint public result;\r\n    uint256 public initialPrice;\r\n    uint256 public finalPrice;\r\n\r\n    uint constant UP = 1;\r\n    uint constant DOWN = 0;\r\n    \r\n    \r\n    // ----------MODIFIERS--------------------\r\n    modifier byPlayer(){\r\n        require(msg.sender != oracle);\r\n        _;\r\n    }\r\n    \r\n    modifier byOwner(){\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n    \r\n    modifier byOracle(){\r\n        require(msg.sender == oracle);\r\n        _;\r\n    }\r\n    \r\n    modifier inState(State expected) {\r\n        require(state == expected);\r\n        _;\r\n    }\r\n    // -------------------------------------\r\n\r\n    \r\n    constructor(uint256 _bet) public {\r\n        require(_bet > 0);\r\n        \r\n        owner = msg.sender;\r\n        state = State.SETUP;\r\n        bet = _bet;\r\n        \r\n        emit GameCreated(bet);\r\n    }\r\n    \r\n    function setOracle(address _oracle) public payable byOwner inState(State.SETUP) {\r\n        oracle = _oracle;\r\n        \r\n        emit OracleSet(oracle);\r\n    }\r\n    \r\n    function setInitialPrice(uint256 _value) public payable byOracle inState(State.SETUP) {\r\n        initialPrice = _value;\r\n        state = State.OPEN;\r\n        \r\n        emit GameOpened(initialPrice);\r\n    }\r\n\r\n    function closeGame() public byOwner inState(State.OPEN){\r\n        state = State.CLOSED;\r\n\r\n        emit GameClosed();\r\n    }\r\n    \r\n    function betUp() public payable byPlayer inState(State.OPEN){\r\n        require(msg.value == (bet*0.001 ether));\r\n\r\n        guesses[UP].guesses_number++;\r\n        guesses[UP].players[msg.sender] = PaidStatus.NOT_PAID;\r\n\r\n        emit PlayerBet(msg.sender, UP);\r\n    }\r\n    \r\n    function betDown() public payable byPlayer inState(State.OPEN){\r\n        require(msg.value == (bet*0.001 ether));\r\n\r\n        guesses[DOWN].guesses_number++;\r\n        guesses[DOWN].players[msg.sender] = PaidStatus.NOT_PAID;\r\n        \r\n        emit PlayerBet(msg.sender, DOWN);\r\n    }\r\n    \r\n    \r\n    function setFinalPrice(uint256 _value) public payable byOracle inState(State.CLOSED) {\r\n        // require(isValidNumber(_result));\r\n        \r\n        finalPrice = _value;\r\n        \r\n        emit FinalPriceSet(finalPrice);\r\n        \r\n        if(finalPrice > initialPrice){\r\n            result = UP;\r\n        }else{\r\n            result = DOWN;\r\n        }\r\n        \r\n        \r\n        if(guesses[result].guesses_number > 0){\r\n            state = State.PLAYERS_WIN;\r\n            splitJackpot = getBalance()/guesses[result].guesses_number;\r\n            emit PlayersWin(result, splitJackpot);\r\n        }else{\r\n            state = State.OWNER_WIN;\r\n            emit OwnerWins(owner);\r\n        }\r\n    }\r\n    \r\n    function collectOwnerWinnings() public byOwner inState(State.OWNER_WIN){\r\n        selfdestruct(owner);\r\n    }\r\n    \r\n    function collectPlayerWinnings() public byPlayer inState(State.PLAYERS_WIN){\r\n        if(guesses[result].players[msg.sender] == PaidStatus.NOT_PAID){\r\n            guesses[result].players[msg.sender] = PaidStatus.PAID;\r\n            msg.sender.transfer(splitJackpot);\r\n        } else revert();\r\n    }\r\n\r\n    function getBalance() private view returns (uint256){\r\n        return address(this).balance;\r\n    }\r\n    \r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"bet\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"initialPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"guesses\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"guesses_number\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"result\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"betDown\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"closeGame\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_oracle\",\"type\":\"address\"}],\"name\":\"setOracle\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"oracle\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address payable\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"setInitialPrice\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"finalPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"betUp\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"setFinalPrice\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"state\",\"outputs\":[{\"internalType\":\"enum StockBet.State\",\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"collectOwnerWinnings\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"collectPlayerWinnings\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_bet\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"bet\",\"type\":\"uint256\"}],\"name\":\"GameCreated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"initialPrice\",\"type\":\"uint256\"}],\"name\":\"GameOpened\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[],\"name\":\"GameClosed\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"oracle\",\"type\":\"address\"}],\"name\":\"OracleSet\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"finalPrice\",\"type\":\"uint256\"}],\"name\":\"FinalPriceSet\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"player\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"guess\",\"type\":\"uint256\"}],\"name\":\"PlayerBet\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"result\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"splitJackpot\",\"type\":\"uint256\"}],\"name\":\"PlayersWin\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"OwnerWins\",\"type\":\"event\"}]","ContractName":"StockBet","CompilerVersion":"v0.5.11+commit.c082d0b4","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"0000000000000000000000000000000000000000000000000000000000000004","Library":"","LicenseType":"None","SwarmSource":"bzzr://28ec0837ffb8dfb3caccb45f6069c54dfc26dd2a357930b911c58e149bbad86b"}]}