{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.5.2;\r\n\r\ncontract Toss {\r\n\r\n    enum GameState {bidMade, bidAccepted, bidOver}\r\n    GameState public currentState;\r\n    uint public wager;\r\n    address payable public player1;\r\n    address payable public player2;\r\n    uint8 public result;\r\n    uint public acceptationBlockNumber;\r\n\r\n    event tossUpdatedEvent();\r\n\r\n    modifier onlyState(GameState expectedState) {\r\n        require(expectedState == currentState, \"Current state does not match expected case\");\r\n        _;\r\n    }\r\n\r\n    constructor() public payable {\r\n        wager = msg.value;\r\n        player1 = msg.sender;\r\n        currentState = GameState.bidMade;\r\n        emit tossUpdatedEvent();\r\n    }\r\n \r\n    function acceptBid() public onlyState(GameState.bidMade) payable {\r\n        require(msg.value == wager, \"Payment should be equal to current wager\");\r\n        player2 = msg.sender;\r\n        currentState = GameState.bidAccepted;\r\n        acceptationBlockNumber = block.number;\r\n        emit tossUpdatedEvent();\r\n    }\r\n\r\n    function closeBid() public onlyState(GameState.bidAccepted) {\r\n\r\n        // Get fees\r\n        uint fee = (address(this).balance)/100;\r\n        (0x9A660374103a0787A69847A670Fc3Aa19f82E2Ff).transfer(fee);\r\n\r\n        // Get toss result\r\n        result = tossCoin();\r\n\r\n        // heads: p1 wins\r\n        if(result == 0){\r\n            player1.transfer(address(this).balance);\r\n            currentState = GameState.bidOver;\r\n        }\r\n\r\n        // tail: p2 wins\r\n        else if(result == 1){\r\n            player2.transfer(address(this).balance);\r\n            currentState = GameState.bidOver;\r\n        }\r\n        emit tossUpdatedEvent();\r\n    }\r\n\r\n    function getToss() public view returns (uint, uint , address, address, uint8, uint) {\r\n        return (wager, uint(currentState), player1, player2, result, acceptationBlockNumber);\r\n    }\r\n\r\n    function tossCoin() private view returns (uint8) {\r\n        require (block.number > acceptationBlockNumber + 1, \"The toss shouldn't be performed at this block\");\r\n        return uint8(uint256(blockhash(acceptationBlockNumber+1))%2);\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"currentState\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"player2\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"result\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"wager\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"acceptationBlockNumber\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"player1\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"acceptBid\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"closeBid\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getToss\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"uint8\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[],\"name\":\"tossUpdatedEvent\",\"type\":\"event\"}]","ContractName":"Toss","CompilerVersion":"v0.5.7+commit.6da8b019","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://319e45c18f7cdb9a25b3ffb66785c21d039b017af18eb94a589a43178bfa0242"}]}