{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.5.2;\r\n\r\n// File: node_modules/openzeppelin-solidity/contracts/access/Roles.sol\r\n\r\n/**\r\n * @title Roles\r\n * @dev Library for managing addresses assigned to a Role.\r\n */\r\nlibrary Roles {\r\n    struct Role {\r\n        mapping (address => bool) bearer;\r\n    }\r\n\r\n    /**\r\n     * @dev give an account access to this role\r\n     */\r\n    function add(Role storage role, address account) internal {\r\n        require(account != address(0));\r\n        require(!has(role, account));\r\n\r\n        role.bearer[account] = true;\r\n    }\r\n\r\n    /**\r\n     * @dev remove an account's access to this role\r\n     */\r\n    function remove(Role storage role, address account) internal {\r\n        require(account != address(0));\r\n        require(has(role, account));\r\n\r\n        role.bearer[account] = false;\r\n    }\r\n\r\n    /**\r\n     * @dev check if an account has this role\r\n     * @return bool\r\n     */\r\n    function has(Role storage role, address account) internal view returns (bool) {\r\n        require(account != address(0));\r\n        return role.bearer[account];\r\n    }\r\n}\r\n\r\n// File: node_modules/openzeppelin-solidity/contracts/access/roles/PauserRole.sol\r\n\r\ncontract PauserRole {\r\n    using Roles for Roles.Role;\r\n\r\n    event PauserAdded(address indexed account);\r\n    event PauserRemoved(address indexed account);\r\n\r\n    Roles.Role private _pausers;\r\n\r\n    constructor () internal {\r\n        _addPauser(msg.sender);\r\n    }\r\n\r\n    modifier onlyPauser() {\r\n        require(isPauser(msg.sender));\r\n        _;\r\n    }\r\n\r\n    function isPauser(address account) public view returns (bool) {\r\n        return _pausers.has(account);\r\n    }\r\n\r\n    function addPauser(address account) public onlyPauser {\r\n        _addPauser(account);\r\n    }\r\n\r\n    function renouncePauser() public {\r\n        _removePauser(msg.sender);\r\n    }\r\n\r\n    function _addPauser(address account) internal {\r\n        _pausers.add(account);\r\n        emit PauserAdded(account);\r\n    }\r\n\r\n    function _removePauser(address account) internal {\r\n        _pausers.remove(account);\r\n        emit PauserRemoved(account);\r\n    }\r\n}\r\n\r\n// File: node_modules/openzeppelin-solidity/contracts/lifecycle/Pausable.sol\r\n\r\n/**\r\n * @title Pausable\r\n * @dev Base contract which allows children to implement an emergency stop mechanism.\r\n */\r\ncontract Pausable is PauserRole {\r\n    event Paused(address account);\r\n    event Unpaused(address account);\r\n\r\n    bool private _paused;\r\n\r\n    constructor () internal {\r\n        _paused = false;\r\n    }\r\n\r\n    /**\r\n     * @return true if the contract is paused, false otherwise.\r\n     */\r\n    function paused() public view returns (bool) {\r\n        return _paused;\r\n    }\r\n\r\n    /**\r\n     * @dev Modifier to make a function callable only when the contract is not paused.\r\n     */\r\n    modifier whenNotPaused() {\r\n        require(!_paused);\r\n        _;\r\n    }\r\n\r\n    /**\r\n     * @dev Modifier to make a function callable only when the contract is paused.\r\n     */\r\n    modifier whenPaused() {\r\n        require(_paused);\r\n        _;\r\n    }\r\n\r\n    /**\r\n     * @dev called by the owner to pause, triggers stopped state\r\n     */\r\n    function pause() public onlyPauser whenNotPaused {\r\n        _paused = true;\r\n        emit Paused(msg.sender);\r\n    }\r\n\r\n    /**\r\n     * @dev called by the owner to unpause, returns to normal state\r\n     */\r\n    function unpause() public onlyPauser whenPaused {\r\n        _paused = false;\r\n        emit Unpaused(msg.sender);\r\n    }\r\n}\r\n\r\n// File: contracts/Adminable.sol\r\n\r\ncontract Adminable {\r\n    using Roles for Roles.Role;\r\n\r\n    event AdminAdded(address indexed account);\r\n    event AdminRemoved(address indexed account);\r\n\r\n    Roles.Role private _admins;\r\n\r\n    constructor () internal {\r\n        _addAdmin(msg.sender);\r\n    }\r\n\r\n    modifier onlyAdmin() {\r\n        require(isAdmin(msg.sender));\r\n        _;\r\n    }\r\n\r\n    function isAdmin(address account) public view returns (bool) {\r\n        return _admins.has(account);\r\n    }\r\n\r\n    function addAdmin(address account) public onlyAdmin {\r\n        _addAdmin(account);\r\n    }\r\n\r\n    function renounceAdmin() public {\r\n        _removeAdmin(msg.sender);\r\n    }\r\n\r\n    function _addAdmin(address account) internal {\r\n        _admins.add(account);\r\n        emit AdminAdded(account);\r\n    }\r\n\r\n    function _removeAdmin(address account) internal {\r\n        _admins.remove(account);\r\n        emit AdminRemoved(account);\r\n    }\r\n}\r\n\r\n// File: contracts/Authorizable.sol\r\n\r\ncontract Authorizable is Adminable {\r\n\r\n    address public authorizedAddress;\r\n    \r\n    modifier onlyAuthorized() {\r\n        require(msg.sender == authorizedAddress);\r\n        _;\r\n    }\r\n\r\n    function updateAuthorizedAddress(address _address) onlyAdmin public {\r\n        authorizedAddress = _address;\r\n    }\r\n\r\n}\r\n\r\n// File: contracts/SoarStorage.sol\r\n\r\n/**\r\n    @title Soar Storage\r\n    @author Marek Tlacbaba (marek@soar.earth)\r\n    @dev This smart contract behave as simple storage and can be \r\n    accessed only by authorized caller who is responsible for any\r\n    checks and validation. The authorized caller can updated by \r\n    admins so it allows to update application logic \r\n    and keeping data and events untouched.\r\n*/\r\n\r\n//TODO\r\n// use safeMath\r\ncontract SoarStorage is Authorizable {\r\n\r\n    /**\r\n    Status: \r\n        0 - unknown\r\n        1 - created\r\n        2 - updated\r\n        3 - deleted\r\n    */\r\n    struct ListingObject {\r\n        address owner;\r\n        address sponsor;\r\n        bytes12 geohash;\r\n        mapping (address => mapping (bytes32 => uint )) sales;\r\n        uint256 salesCount;\r\n        uint8 status;\r\n    }\r\n\r\n    uint public counter = 0;\r\n    mapping (bytes32 => ListingObject) internal listings;\r\n\r\n    event Listing (\r\n        bytes32 filehash,\r\n        address indexed owner,\r\n        address indexed sponsor,\r\n        string previewUrl, \r\n        string url, \r\n        string pointWKT,\r\n        bytes12 geohash, \r\n        string metadata\r\n    );\r\n\r\n    event ListingUpdated (\r\n        bytes32 filehash,\r\n        address indexed owner, \r\n        address indexed sponsor,\r\n        string previewUrl, \r\n        string url, \r\n        string pointWKT,\r\n        bytes12 geohash, \r\n        string metadata \r\n    );\r\n\r\n    event ListingDeleted (\r\n        bytes32 filehash,\r\n        address indexed owner,\r\n        address indexed sponsor\r\n    );\r\n\r\n    event Sale(\r\n        address indexed buyer, \r\n        bytes32 id, \r\n        address indexed owner, \r\n        address sponsor,\r\n        bytes32 indexed filehash,\r\n        uint price \r\n    );\r\n\r\n    function putListing (\r\n        bytes32 _filehash,\r\n        address _owner,\r\n        address _sponsor,\r\n        string memory _previewUrl, \r\n        string memory _url, \r\n        string memory _pointWKT, \r\n        bytes12 _geohash, \r\n        string memory _metadata\r\n    ) \r\n        public \r\n        onlyAuthorized \r\n    {\r\n        listings[_filehash].owner = _owner;\r\n        listings[_filehash].sponsor = _sponsor;\r\n        listings[_filehash].geohash = _geohash;\r\n        listings[_filehash].status = 1;\r\n        counter++;\r\n        emit Listing(\r\n            _filehash, \r\n            _owner,\r\n            _sponsor, \r\n            _previewUrl, \r\n            _url, \r\n            _pointWKT, \r\n            _geohash, \r\n            _metadata\r\n        );\r\n    }\r\n\r\n    function updateListing (\r\n        bytes32 _filehash,\r\n        address _owner,\r\n        address _sponsor,\r\n        string memory _previewUrl, \r\n        string memory _url, \r\n        string memory _pointWKT, \r\n        bytes12 _geohash, \r\n        string memory _metadata \r\n    ) \r\n        public \r\n        onlyAuthorized \r\n    {\r\n        listings[_filehash].geohash = _geohash;\r\n        listings[_filehash].status = 2;\r\n        emit ListingUpdated(\r\n            _filehash, \r\n            _owner,\r\n            _sponsor, \r\n            _previewUrl, \r\n            _url, \r\n            _pointWKT, \r\n            _geohash, \r\n            _metadata\r\n        );\r\n    }\r\n\r\n    function deleteListing(\r\n        bytes32 _filehash \r\n    )\r\n        public \r\n        onlyAuthorized \r\n    {\r\n        listings[_filehash].status = 3;\r\n        counter--;\r\n        emit ListingDeleted(_filehash, listings[_filehash].owner, listings[_filehash].sponsor);\r\n    }\r\n\r\n    function putSale (\r\n        address _buyer,\r\n        bytes32 _id,\r\n        bytes32 _filehash, \r\n        uint256 _price\r\n    ) \r\n        public \r\n        onlyAuthorized \r\n    {\r\n        listings[_filehash].sales[_buyer][_id] = _price;\r\n        listings[_filehash].salesCount++;\r\n        emit Sale(_buyer, _id, listings[_filehash].owner, listings[_filehash].sponsor, _filehash, _price);\r\n    }\r\n\r\n    function getListingDetails(bytes32 _filehash, address _user, bytes32 _id) \r\n        public view\r\n        returns (\r\n            address owner_,\r\n            address sponsor_,\r\n            bytes12 geohash_,\r\n            uint8 status_,\r\n            uint256 sale_\r\n        )\r\n    {\r\n        owner_ = listings[_filehash].owner;\r\n        sponsor_ = listings[_filehash].sponsor;\r\n        geohash_ = listings[_filehash].geohash;\r\n        status_ = listings[_filehash].status;\r\n        sale_ = listings[_filehash].sales[_user][_id];\r\n    }\r\n}\r\n\r\n// File: contracts/Soar.sol\r\n\r\n/**\r\n    @title Soar\r\n    @author Marek Tlacbaba (marek@soar.earth)\r\n    @dev Main Soar smart contract with bussiness logic composing\r\n    all other parts together and it is by design upgradable. When all\r\n    development is finished then all admins can be removed and no more \r\n    upgrade will be allowed.\r\n*/\r\n \r\ncontract Soar is Pausable, Adminable {\r\n\r\n    // attributes\r\n    address public soarStorageAddress;\r\n\r\n    // contracts\r\n    SoarStorage private soarStorageContract;\r\n\r\n    bytes32 private emptyUserId = \"00000000000000000000000000000000\";\r\n    address private emptySponsor = address(0);\r\n\r\n    mapping (address => mapping ( address => bool)) private sponsors;\r\n\r\n    event SponsorAdminAdded(address indexed sponsor, address admin);\r\n    event SponsorAdminRemoved(address indexed sponsor, address admin);\r\n\r\n    modifier listingExistAndNotDeleted(bytes32 _filehash) {\r\n        (,,,uint8 status,) = soarStorageContract.getListingDetails(_filehash, msg.sender, emptyUserId);\r\n        require(status == 1 || status == 2, \"Listing must exist and not be deleted\");\r\n        _;\r\n    }\r\n\r\n    modifier listingNotExistOrDeleted(bytes32 _filehash) {\r\n        (,,,uint8 status,) = soarStorageContract.getListingDetails(_filehash, msg.sender, emptyUserId);\r\n        require(status == 0 || status == 3, \"Listing can not exist or must be deleted\");\r\n        _;\r\n    }\r\n\r\n    modifier onlySponsor(address _sponsor) {\r\n        require(sponsors[_sponsor][msg.sender] == true, \"Only sponsor\");\r\n        _;\r\n    }\r\n\r\n    modifier onlySponsorListingOwner(bytes32 _filehash, address _sponsor) {\r\n        require(sponsors[_sponsor][msg.sender] == true, \"Only sponsor\");\r\n        (,address sponsor,,uint8 status,) = soarStorageContract.getListingDetails(_filehash, msg.sender, emptyUserId);\r\n        require(status == 1 || status == 2, \"Listing must exist and not be deleted\");\r\n        require(sponsor == _sponsor, \"Incorrect sponsor\");\r\n        _;\r\n    }\r\n    \r\n    constructor() public {}\r\n\r\n    /**\r\n        @dev Create listing as sponsor and put it in storage.\r\n    */\r\n    function sponsorCreateListing(\r\n        address _sponsor,\r\n        address _owner,\r\n        bytes32 _filehash,\r\n        string memory _previewUrl, \r\n        string memory _url, \r\n        string memory _pointWKT, \r\n        bytes12 _geohash, \r\n        string memory _metadata) \r\n        public\r\n        whenNotPaused\r\n        listingNotExistOrDeleted(_filehash)\r\n        onlySponsor(_sponsor)\r\n    {\r\n        soarStorageContract.putListing(_filehash, _owner, _sponsor, _previewUrl, _url, _pointWKT, _geohash, _metadata);\r\n    }\r\n\r\n    /**\r\n        @dev Update listing as sponsor in storage.\r\n    */\r\n    function sponsorUpdateListing(\r\n        address _sponsor,\r\n        address _owner,\r\n        bytes32 _filehash,\r\n        string memory _previewUrl, \r\n        string memory _url, \r\n        string memory _pointWKT, \r\n        bytes12 _geohash, \r\n        string memory _metadata) \r\n        public\r\n        whenNotPaused\r\n        onlySponsorListingOwner(_filehash, _sponsor)\r\n    {\r\n        soarStorageContract.updateListing(_filehash, _owner, _sponsor, _previewUrl, _url, _pointWKT, _geohash, _metadata);\r\n    }\r\n\r\n    /**\r\n        @dev Delete listing as sponsor in storage.\r\n    */\r\n    function sponsorDeleteListing(\r\n        address _sponsor,\r\n        bytes32 _filehash) \r\n        public\r\n        whenNotPaused\r\n        onlySponsorListingOwner(_filehash, _sponsor)\r\n    {\r\n        soarStorageContract.deleteListing(_filehash);\r\n    }\r\n\r\n    function listingExist(bytes32 _filehash) \r\n        public view\r\n        whenNotPaused  \r\n        returns (bool exists_) \r\n    {\r\n        (,,,uint8 status,) = soarStorageContract.getListingDetails(_filehash, msg.sender, emptyUserId);\r\n        exists_ = (status == 1 || status == 2);\r\n    }\r\n\r\n    /**\r\n    ADMIN FUNCTIONS\r\n     */\r\n\r\n    function addSponsorAdmin(address _sponsor, address _admin) \r\n        public \r\n        whenNotPaused\r\n        onlyAdmin \r\n    {\r\n        sponsors[_sponsor][_admin] = true;\r\n        emit SponsorAdminAdded(_sponsor, _admin);\r\n    }\r\n\r\n    function removeSponsorAdmin(address _sponsor, address _admin) \r\n        public\r\n        whenNotPaused\r\n        onlyAdmin \r\n    {\r\n        sponsors[_sponsor][_admin] = false;\r\n        emit SponsorAdminRemoved(_sponsor, _admin);\r\n    }\r\n\r\n    function isSponsorAdmin(address _sponsor) \r\n        public view\r\n        returns (bool isSponsorAdmin_)\r\n    {\r\n        isSponsorAdmin_ = sponsors[_sponsor][msg.sender] == true;\r\n    }\r\n\r\n    function setSoarStorageContract(address _address) \r\n        public\r\n        whenNotPaused \r\n        onlyAdmin \r\n    {\r\n        soarStorageContract = SoarStorage(_address);\r\n        soarStorageAddress = _address;\r\n    }\r\n\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"_sponsor\",\"type\":\"address\"}],\"name\":\"isSponsorAdmin\",\"outputs\":[{\"name\":\"isSponsorAdmin_\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"account\",\"type\":\"address\"}],\"name\":\"isAdmin\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"soarStorageAddress\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_sponsor\",\"type\":\"address\"},{\"name\":\"_admin\",\"type\":\"address\"}],\"name\":\"addSponsorAdmin\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_sponsor\",\"type\":\"address\"},{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"_filehash\",\"type\":\"bytes32\"},{\"name\":\"_previewUrl\",\"type\":\"string\"},{\"name\":\"_url\",\"type\":\"string\"},{\"name\":\"_pointWKT\",\"type\":\"string\"},{\"name\":\"_geohash\",\"type\":\"bytes12\"},{\"name\":\"_metadata\",\"type\":\"string\"}],\"name\":\"sponsorUpdateListing\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"unpause\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"account\",\"type\":\"address\"}],\"name\":\"isPauser\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"paused\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"renouncePauser\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"account\",\"type\":\"address\"}],\"name\":\"addAdmin\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"account\",\"type\":\"address\"}],\"name\":\"addPauser\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_sponsor\",\"type\":\"address\"},{\"name\":\"_admin\",\"type\":\"address\"}],\"name\":\"removeSponsorAdmin\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"pause\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"renounceAdmin\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_sponsor\",\"type\":\"address\"},{\"name\":\"_filehash\",\"type\":\"bytes32\"}],\"name\":\"sponsorDeleteListing\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_filehash\",\"type\":\"bytes32\"}],\"name\":\"listingExist\",\"outputs\":[{\"name\":\"exists_\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_sponsor\",\"type\":\"address\"},{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"_filehash\",\"type\":\"bytes32\"},{\"name\":\"_previewUrl\",\"type\":\"string\"},{\"name\":\"_url\",\"type\":\"string\"},{\"name\":\"_pointWKT\",\"type\":\"string\"},{\"name\":\"_geohash\",\"type\":\"bytes12\"},{\"name\":\"_metadata\",\"type\":\"string\"}],\"name\":\"sponsorCreateListing\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_address\",\"type\":\"address\"}],\"name\":\"setSoarStorageContract\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"sponsor\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"admin\",\"type\":\"address\"}],\"name\":\"SponsorAdminAdded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"sponsor\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"admin\",\"type\":\"address\"}],\"name\":\"SponsorAdminRemoved\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"account\",\"type\":\"address\"}],\"name\":\"AdminAdded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"account\",\"type\":\"address\"}],\"name\":\"AdminRemoved\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"account\",\"type\":\"address\"}],\"name\":\"Paused\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"account\",\"type\":\"address\"}],\"name\":\"Unpaused\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"account\",\"type\":\"address\"}],\"name\":\"PauserAdded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"account\",\"type\":\"address\"}],\"name\":\"PauserRemoved\",\"type\":\"event\"}]","ContractName":"Soar","CompilerVersion":"v0.5.2+commit.1df8f40c","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://61556aff831fe6efc110d0573753e144facb4db33012a3443c88115bf9a1e386"}]}