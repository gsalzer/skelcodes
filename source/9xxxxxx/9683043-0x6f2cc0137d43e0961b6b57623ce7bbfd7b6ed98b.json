{"status":"1","message":"OK","result":[{"SourceCode":"// File: contracts/interfaces/IAaveOracle.sol\r\n\r\npragma solidity ^0.5.0;\r\n\r\ninterface IAaveOracle {\r\n    // TODO rename back to getOracleProphecy\r\n    function getAssetPrice(address _asset) external view returns (uint256);\r\n    function prophecies(address _asset) external view returns (uint64, uint96, uint96);\r\n    function submitProphecy(address _asset, uint96 _sybilProphecy, uint96 _oracleProphecy) external;\r\n    function isSybilWhitelisted(address _sybil) external view returns (bool);\r\n}\r\n\r\n// File: contracts/interfaces/IChainlinkAggregator.sol\r\n\r\npragma solidity ^0.5.0;\r\n\r\ninterface IChainlinkAggregator {\r\n  function latestAnswer() external view returns (int256);\r\n}\r\n\r\n// File: contracts/AaveOracle.sol\r\n\r\npragma solidity ^0.5.0;\r\n\r\n\r\n\r\ncontract AaveOracle is IAaveOracle {\r\n    struct TimestampedProphecy {\r\n        uint64 timestamp;\r\n        uint96 sybilProphecy;\r\n        uint96 oracleProphecy;\r\n    }\r\n\r\n    event ProphecySubmitted(\r\n        address indexed _sybil,\r\n        address indexed _asset,\r\n        uint96 _sybilProphecy,\r\n        uint96 _oracleProphecy\r\n    );\r\n\r\n    event SybilWhitelisted(address sybil);\r\n\r\n    address constant public USD_ETH_CHAINLINK_AGGREGATOR = address(0x59b826c214aBa7125bFA52970d97736c105Cc375);\r\n\r\n    address constant public MOCK_USD = address(0x10F7Fc1F91Ba351f9C629c5947AD69bD03C05b96);\r\n\r\n    // Asset => price prophecy\r\n    mapping(address => TimestampedProphecy) public prophecies;\r\n\r\n    // Whitelisted sybils allowed to submit prices\r\n    mapping(address => bool) private sybils;\r\n\r\n    modifier onlySybil {\r\n        require(isSybilWhitelisted(msg.sender), \"INVALID_SYBIL\");\r\n        _;\r\n    }\r\n\r\n    constructor(address[] memory _sybils) public {\r\n        internalWhitelistSybils(_sybils);\r\n    }\r\n\r\n    /// @notice Internal function to whitelist a list of sybils\r\n    /// @param _sybils The addresses of the sybils\r\n    function internalWhitelistSybils(address[] memory _sybils) internal {\r\n        for (uint256 i = 0; i < _sybils.length; i++) {\r\n            sybils[_sybils[i]] = true;\r\n            emit SybilWhitelisted(_sybils[i]);\r\n        }\r\n    }\r\n\r\n    /// @notice Submits a new prophecy for an asset\r\n    /// - Only callable by whitelisted sybils\r\n    /// @param _asset The asset address\r\n    /// @param _sybilProphecy The new individual prophecy of the sybil\r\n    /// @param _oracleProphecy The offchain calculated prophecy from all the currently valid ones\r\n    function submitProphecy(address _asset, uint96 _sybilProphecy, uint96 _oracleProphecy) external onlySybil {\r\n        prophecies[_asset] = TimestampedProphecy(uint64(block.timestamp), _sybilProphecy, _oracleProphecy);\r\n        emit ProphecySubmitted(msg.sender, _asset, _sybilProphecy, _oracleProphecy);\r\n    }\r\n\r\n    /// @notice Gets the current prophecy for an asset\r\n    /// @param _asset The asset address\r\n    function getAssetPrice(address _asset) external view returns (uint256) {\r\n        if (_asset == address(MOCK_USD)) {\r\n            return getUsdPriceFromChainlink();\r\n        } else {\r\n            return uint256(prophecies[_asset].oracleProphecy);\r\n        }\r\n    }\r\n\r\n    /// @notice Gets the data of the current prophecy for an asset\r\n    /// @param _asset The asset address\r\n    function getProphecy(address _asset) external view returns (uint64, uint96, uint96) {\r\n        // For USD/ETH, use the Chainlink aggregator. The latestAnswer() gives price of ETH in USD,\r\n        // as we need price of USD in ETH, needs to be reversed, using 1e18. The mult by 1e8 is needed because\r\n        // the price of ETH in USD is multiplied by 1e8 on Chainlink side\r\n        if (_asset == address(MOCK_USD)) {\r\n            uint256 _price = getUsdPriceFromChainlink();\r\n            return (uint64(block.timestamp), uint96(_price), uint96(_price));\r\n        } else {\r\n            TimestampedProphecy memory _prophecy = prophecies[_asset];\r\n            return (_prophecy.timestamp, _prophecy.sybilProphecy, _prophecy.oracleProphecy);\r\n        }\r\n    }\r\n\r\n    /// @notice Return a bool with the whitelisting state of a sybil\r\n    /// @param _sybil The address of the sybil\r\n    function isSybilWhitelisted(address _sybil) public view returns (bool) {\r\n        return sybils[_sybil];\r\n    }\r\n\r\n    function getUsdPriceFromChainlink() internal view returns (uint256) {\r\n        return uint256(1e8 * 1e18 / IChainlinkAggregator(USD_ETH_CHAINLINK_AGGREGATOR).latestAnswer());\r\n    }\r\n\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"_sybil\",\"type\":\"address\"}],\"name\":\"isSybilWhitelisted\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"MOCK_USD\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"USD_ETH_CHAINLINK_AGGREGATOR\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"prophecies\",\"outputs\":[{\"name\":\"timestamp\",\"type\":\"uint64\"},{\"name\":\"sybilProphecy\",\"type\":\"uint96\"},{\"name\":\"oracleProphecy\",\"type\":\"uint96\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_asset\",\"type\":\"address\"},{\"name\":\"_sybilProphecy\",\"type\":\"uint96\"},{\"name\":\"_oracleProphecy\",\"type\":\"uint96\"}],\"name\":\"submitProphecy\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_asset\",\"type\":\"address\"}],\"name\":\"getAssetPrice\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_asset\",\"type\":\"address\"}],\"name\":\"getProphecy\",\"outputs\":[{\"name\":\"\",\"type\":\"uint64\"},{\"name\":\"\",\"type\":\"uint96\"},{\"name\":\"\",\"type\":\"uint96\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"_sybils\",\"type\":\"address[]\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_sybil\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_asset\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_sybilProphecy\",\"type\":\"uint96\"},{\"indexed\":false,\"name\":\"_oracleProphecy\",\"type\":\"uint96\"}],\"name\":\"ProphecySubmitted\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"sybil\",\"type\":\"address\"}],\"name\":\"SybilWhitelisted\",\"type\":\"event\"}]","ContractName":"AaveOracle","CompilerVersion":"v0.5.6+commit.b259423e","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000ea7a98133424041461c0784affd708ef7ddc77d90000000000000000000000000f45333725de4059561a2fe7b201ed16f9a7a1da","Library":"","LicenseType":"None","SwarmSource":"bzzr://04d7fc06e207a7308ea60dfc6e20c3ac43ea831dcf72d1ee397f9075e8fd4443"}]}