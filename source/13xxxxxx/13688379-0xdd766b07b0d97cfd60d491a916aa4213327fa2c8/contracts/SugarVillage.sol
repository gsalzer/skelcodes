/**
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNX0Okdolc::;,,'''........''',,;;:clodkO0XNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNKOxoc:;,'..................................'';:loxOKNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNKkdl:,'................................................',:ldkKNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWN0xo:,'..........................................................',cxO0000KXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNKko:,.............................................................',;cclllllloodk0NWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN0xc,'.....................                                .........';cllllllllllllllodOKWMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMWWNXXKKKKKkl;'.................                                             ..;clllllllllllllllllllokKWMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMWNX0Okxdooooooollcc:;,,'.......                                                  .;llllllloodxxxxdollllllldOXWMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMWN0kdollllllllllllllllllllc:,..                     ....................           .:lllllloodkO0000OkxolllllloxKWMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMWKxollloooooooooolllllllllllllc,.            ...',;;::cccclllllllcllccccc:;;,'...  .:llllllooxO0000OOOOOkdolllllldONMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMXxllloodddddddddddooooollllllllll:'.    ..,;:ccclllllllllllcclcccccccllllllccclcc::cllllllodxO00OOOOOOOOOkxdollllloxKNMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMW0olllokOOOOOOOOOOOkkkxxddolllllllllc;,;:cllllllcclcllllllcclllllllllcclllllllcllcllllllllooxO00OOOOOOOOOOOOkxollllllox0NMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMKdllldkOOOOOOOOOO0000000OkkxdollllllloolllclllclllcccccccccllllllllllllclllclllcllllllllooxO00OOOOOOOOOOOOOOkxolllllllco0WMMMMMMMMMMMMMMMM
MMMMMMMMMMMMXxllldkOOOOOOOOOOOOOOOOO0000Okxdolllllllolllccccc:::::::::::::cccccccllclllcllccllllllllodk00OOOOOOOOOOOOOOOOkxdollllll::dXMMMMMMMMMMMMMMM
MMMMMMMMMMMMNkllldkOOOOOOOOOOOOOOOOOOOOO000Okdollllllolc::;;;;;;;;;;;;;;;;;;;;:::cccccclllcllllllllooxO0OOOOOOOOOOOOOOOOOOOkdollllll;,cONMMMMMMMMMMMMM
MMMMMMMMMMMWXxllloxkOOOOOOOOOOOOOOOOOOOOOO000Oxolllllll:;;;;;;;;;;;;;;;;;;;;;;;;;;;:ccllcclllllllllodO00OOOOOOOOOOOOOOOOOOOOkdlllllol;',dXMMMMMMMMMMMM
MMMMMMMMMMW0c;llloxkOOOOOOOOOOOOOOOOOOOOOOOO000kdlllllllcc::;;;;;;;;;;;;;;;;;;;;;;;;;;:cclllllllllooxO0OOOOOOOOOOOOOOOOOOOOOOkdlllllol;''c0WMMMMMMMMMM
MMMMMMMMMWk;.,cllodkOOOOOOOOOOOOOOOOOOOOOOOOO000kdllcc:::;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:cllllllllodk00OOOOOOOOOOOOOOOOOOOOOOOxollllooc,..:kWMMMMMMMMM
MMMMMMMMNx,..':llloxOOOOOOOOOOOOOOOOOOOOOOOOO000ko:;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;::::::::clllllloodO00OOOOOOOOOOOOOOOOOOOOOOOkxolllooo:'..,xNMMMMMMMM
MMMMMMMXd,....,cllodkOOOOOOOOOOOOOOOOOOOOOOOO00kl;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::::::::::cllllllooxO00OOOOOOOOOOOOOOOOOOOOOOOOkdolllool;'..,dNMMMMMMM
MMMMMMNd,.....':lllokOOOOOOOOOOOOOOOOO00000OOOOxl::::::::::::;;;;;;;;;;;;;;;;:::::::::::::clllllloodk000OOOOOOOOOOOOOOOOOOOOOOOOxollloooc,...,dXMMMMMM
MMMMMNd,.......,cllodkOOOOOOOOOOOOOOO00Oxoollllccccccccc:cc:;;;;;;;;;;;;;::cc:::::::::::::cllllloodddk0OkkkkkOOOOOOOOOOOOOOOOOOOkdllllooo:'...,dNMMMMM
MMMMNx,.........;llloxOOOOOOOOOOOOOO00Oxlc:::::::::::::::c:;;;;;;;;;;:::cc:::::::::::::::::cclloooollollcclxkOOOOOOOOOOOOOOOOOOOkdlllloooc,....,xNMMMM
MMMWk;......... .:llldkOOOOOOOOOO00Oxol::::::::::::::::::c::::::::::::::::::::::::::::::::::::ccccc::::::lxkOOOOOOOOOOOOOOOOOOOOkdollloool,.....;kWMMM
MMW0:.........   .coloxkOOOOOOOOO00Odc:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::ccllodxkOOOOOOOOOOOOOOOkdlllloool;......:0WMM
MMXl'........     'loloxOOOOOOOOO0Odl:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::coxOOOOOOOOOOOOOOOkdlllloool;......'oXMM
MWk,.........      ,llldkkOOOOO00koc::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::ldkOOOOkOOOOOOOOOOxolllloool,.......,kWM
MKc.........       .:ooldxkOOO00kl::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::coxkOOOOOOOOOOOkdollllooo:'........cKM
Wx,........        .cloolodkkO0kl:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::clxOOOOOOOOOkdolllllodl,.........,xW
Kc.........       .;lllooolodxOxoc,'''',,,'';::::::::::::::::::::::::::;,'''',;:::::::::::::::::::::::::::::::::::cokOOOOOOOkxdollllloooc. .........cK
k;........        'ccllloooooodkx:.          .':c:::::::::::::::::::;,..      .......',;:::::::::::::::::::::::::::cokOOkkkxdolllllllooo;. .........,k
o'........       .;llllcllooooc:'.             .;c::::::::::::::::;'.                 .,:c:::::::::::::::::::::::::::okkdooolllllllloooc.   ........'o
c.........       .:lcllllcllc'.                 .;cc:::::::::;;;,,.....................''',,;;:::::::::::::::::::::::coollllllllllloooo,    .........c
;........        'clllllllcc;....';;:::;;,'....  .,,,,,'''''''',;:cloodxxxkkkkkkkxxdool:;,.....',,;:::::::::::::::::cllllllllllllllooo:.    .........;
'........        ,lllcllc:;;:ldkO0KKKKKKK0Okxdl:'.........,codkO0KKXXXXXXXXXXXXXXXXXXXXK0Oxdc;'....,;::::::::::::::::lllllllllllloooo:.      ........'
'........       .;lllllc;;clkKXXXXXXXXXXKKKKKKK0c....'....l0k:;dKXXXXXXXXXXXXXXXXXXXXXXKKKKKK0kc...';::::::::::::::::lllllllllllooodl'       ........'
.........       .:lllllc:o:.;OXXXXXXXXXXKKKKKKKO:.',;::;;,c0Oc:xKXXXXXXXXXXXXXXXXXXXXXXKKKKKKKKx'..,:::::::::::::::::cllllllllooooodl.       .........
.........       .:lclllccxkoxKXXXXXXXXXKKKKKKKKx,':llcccc::xKXXXXXXXXXXXXXXXXXXXXXXXXXXKKKKKKKKx,..,::::::::::::::::::loooooooooooooo,       .........
'........       .:lllllcckXXXXXXXXXXXXXKKKKKKK0c';cc::::::;cOXXXXXXXXXXXXXXXXXXXXXXXXXKKKKKKKKKd'.';::::::::::::::::::cloooooodxxddooc.      .........
'........       .;ccccc::xKXXXXXXXXXXXKKKKKKKKd,'::;,,,,,,,,cOXXXXXXXXXXXXXXXXXXXXXXXKKKKKKKKK0l..';c:::::::::::::::::::cloooooxkkkxdo,      ........'
,........        ,::::::;o0XXXXXXXXXXKKKKKKKKx;''..         .cOXXXXXXXXXXXXXXXXXXXXXKKKKKKKKKKk;.',:c:::::::::::::::::::::cccllldkOOOkl.    .........,
:........        '::::::;:kXXXXXXXXXKKKKKK000xoolc::;,,'.... .:kKXXXXXXXXXXXXXXXXXXKKKKKKKKKK0l..';c:::::::::::::::::::::::::::::ldkOOx;    .........:
l'........       .:cc::::;ckKKKXXKKKKKKKK000000000OOOkkkOOOkd:.,d0XXXXXXXXXXXXXXKKKKKKKKKKKK0l'.'....';::::::::::::::::::::::::::::ldkkc.   ........'l
x,........       .;cccc::;,:x0KKKKKKKKKKK0000000000OOOOO00KXX0; .:x0KKKKKKKKKKKKKKKKKKKKKKKk:..'..     .',:::::::::::::::::::::::::::lxo.   ........,x
0:.........      .,:::::::,.'cdO0KKKKK0kolx000000000000000KXX0:  ..:dO0KKKKKKKKKKKKKKKKK0xc'.....        .,::::::::::::::::::::::::clxOx,  .........:0
No'........       .;:::::;.  ..,:cllll:,''ck0000000000000KXXKo.    ..,:oxkO00000000Okxoc,...''..         .';::::::::::::::::::::cloxkOOx;  ........'oN
WO;.........       .;::::'    ...';;;,.....:k0000000000KKXXOc.        ...',,;;:;;;,,'....',:c;.            .';:::::::::::::::cldxkOOOOOx;..........;OW
MNo'........        .::::'      .,cc:..     ,x0KKKKKKKXXKkl.             ......',,,,;;::cclcc:.              .;::::::::::::::coxxxxkkkkx:.........'oNM
MM0:.........        ':::,.      '::'        .:x0KXKKOxl,.                     .;ccccccccc::::'               .;::::::::::::::::cccdkkkxc'........:0MM
MMWx,.........        ,c:;,''.   ':;.          .,col;'.                         .,::::::::::::,.               .;::::::::::::::::cloxkkxl'.......,xWMM
MMMXo'.........       .,cc::;.   .:;.        ..,:ldl;'..                         .,:::::::::::'                .,:::::::::::ccccccllodxxc'......'oXMMM
MMMMKl'........        .,cccc;.  .;;.        .:xxxkkkxdolc.                       .::::::::::;.                 '::cccccccccllloolllllod:'.....'lKMMMM
MMMMW0c.........         'clcc:'..,:'         .okOOOOOO0Ol.                       .;:::::::::'                 .,::ccccclodddoooooolllll;'....':0WMMMM
MMMMMW0:..........        .:cccc;'':;.         .,:lodol:'                         .,::::::::,.         .'...   ';::cccccllodxxxoollllllc,.....:0WMMMMM
MMMMMMWO:..........        .,ccllc::c;.                                           .;:::::::'.         .,:::;,'':ccccccccclodkOkxoolllll:'....:0WMMMMMM
MMMMMMMW0c'.........         .:cllcllc:'..                                        '::::::;.          .,ccccccccccccccclodxkOOOkkkxollll;'..'c0WMMMMMMM
MMMMMMMMWKl'.........         .':clccclc:;,...                                  .,:ccccc;.         .':ccccccccccccloodxkOOOOOkkkkkxollc,..'lKWMMMMMMMM
MMMMMMMMMMXd,..........         .,:ccllccllcc:,'....                         ..':ccccc;'.     ....,;cccccclllooddxkkOOOOOOOkkkkkkkkxol;'.,dXMMMMMMMMMM
MMMMMMMMMMMNk:'..........         .,:clllcllllllcc:;,..  ...........        .,clllllc:,''''',,;;:clllloddddxxkkOOOOOOOOOOOkkkkkkkkkkdc'':kNMMMMMMMMMMM
MMMMMMMMMMMMW0l'..........          .';clllclllcllclc'    .,;',;;..       .',lddollllclcclllllllllllloodddddddddxxkOOOOOkkkkkkkkkkkko;,lKWMMMMMMMMMMMM
MMMMMMMMMMMMMMNx:'..........           .,:clllclllodo,. ...,'. .'.     .';cccokkkxollcclllllllcclllllllllllllllllllodxkkkkkkkkkkkkkd::kNMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMWKo,...........           ..,:ccldxxoc:,';:,';:,'',:,..,:ccccldkOOOkkdolcllcllcllodxxddoolccccccccccccldxkkkkkkkkkkxldKWMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMW0l,............            'lxkko::::cc:;,,,..,:cccc:::::ccdkOOOOOOkdolccllldxxkkxxkkxxdolcccccccccccoxkkkkkkkkkkKWMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMNOl,............         .lkOko::::::::,,;'.'::::::::::::cokOOOOOOOOkdlldxxkkkkkkkkkkkkxxoccccccccccldkkkkkkO0XWMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMNOl,.............     ,dOOkoc::::;;;;'.,;,;;;;:::::::::clxkOOOOOOOOkddxkkkkkkkkkkkkkkkkxolccccccccloxkkkO0XWMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMN0o;'..............,xOOkdc:::;,,,''';::cc;,,,;::::::::cldkOOOOkOOOkolooddxxkkkkkkkkkkkxocccccclllldkOKNWMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMWKxc'...........,oOOOxl:::;,,,'.  .,;,;;,,,,;::::::::cldkOOOOOOOkdllllllodxkkkkkxkkxxxlccllllllokKNMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMWNOo:'........,oOOko:::;,,,,.   .,;,;;,,,,,;::::::::clxOOOOOOOkdllllcccloxkkkkkkkkkxolllllodOKWMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXOo;'.....'lkkdc::;,,,,,,'.';;;::;,,,,,,;::::::::cdkOOOOOOkdllllccccldkkkkkkkkkxollodkKNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXOd:,'.'ckko::;,,,,,,;..;,. .',,,,,,,,;:::::::clxOOOOOOxololllcllldkkkkkkkkkxdxOKNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWN0xo::dxc::;,,,,,;;,,;'   .,,,,,,,,;::::::::ldkOOOOkdllollllllldkkkkkkO0KKXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNKKOdlc;,,,,'...';;'.';;,,,,,,,;::::::::cokOOOOxolllllllllodkOO0KXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXKkdlc;'.   .;;:c:,,,,,,,,;::::::::clxOOOko;,;;;::cldk0XNWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNK0ko:;cl:;;,,,,,,,,;:::::::::cldkOkd:,;:codkOKNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNNX0Oxdlc::;;;::::::::ccloxO00OkOKXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
**/

// SPDX-License-Identifier: MIT

pragma solidity 0.8.1;

import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/Pausable.sol";
import "@openzeppelin/contracts/utils/Counters.sol";
import "@openzeppelin/contracts/utils/math/Math.sol";
import "./Revealable.sol";


contract SugarVillage is ERC721Enumerable, Ownable, Pausable, Revealable {
    using Counters for Counters.Counter;

    uint256 public constant MAX_ELEMENTS = 9999;

    Counters.Counter private _tokenIdTracker;
    bool private _mintingOrderGenerated;
    uint256[] public _mintingOrder;
    string private _currentSalesRound;
    mapping(string => uint256) private _salesRoundToPriceMap;
    mapping(string => uint256) private _salesRoundToMintLimitMap;
    mapping(string => mapping(address => uint256)) private _salesRoundToUserMintCountMap;

    uint256 private _currentDevReserveSize;
    uint256 private _totalDevReserveSize;
    uint256 private _genesisReserveSize;
    uint256 private _salesRoundGiveAwayReserveSize;
    uint256 private _devReserveSize;
    uint256 private _continuousGiveAwayAndAuctionReserveSize;

    string public baseTokenURI;

    event HelloWorldFromSugarVillage(uint256 indexed id);
    event SugarVillagePreSaleOpen();
    event SugarVillageEarlySaleOpen();
    event SugarVillageMainSaleOpen();
    event SugarShopsRevealed();

    constructor(string memory baseURI) ERC721("SugarVillage", "SHOP"){
        _setBaseURI(baseURI);
        setSalesRoundPreSale();

        // Set Price Table
        _salesRoundToPriceMap["PRESALE"] = 0.1 ether;
        _salesRoundToPriceMap["EARLY"] = 0.2 ether;
        _salesRoundToPriceMap["MAIN"] = 0.2 ether;

        // Set Mint Limit per Sales Round
        _totalDevReserveSize = 300;

        _genesisReserveSize = 1;
        _salesRoundGiveAwayReserveSize = 9 * 3;
        // 9 give away for 3 rounds
        _devReserveSize = 30;
        _continuousGiveAwayAndAuctionReserveSize = _totalDevReserveSize - _genesisReserveSize - _salesRoundGiveAwayReserveSize - _devReserveSize;

        _salesRoundToMintLimitMap["PRESALE"] = earlyReserve() + 1111;
        _salesRoundToMintLimitMap["EARLY"] = earlyReserve() + 1111 + 3333;
        _salesRoundToMintLimitMap["MAIN"] = MAX_ELEMENTS;
    }

    modifier saleIsOpen {
        require(_mintingOrderGenerated, "Minting order is not generated yet!");
        require(totalToken() <= MAX_ELEMENTS, "SugarVillage soldout!");
        require(!paused(), "SugarVillage sale is not open!");
        _;
    }

    function earlyReserve() public view returns (uint256) {
        return _genesisReserveSize + _salesRoundGiveAwayReserveSize + _devReserveSize;
    }

    function mintForDevReserve(uint256 _count) public onlyOwner {
        require(_currentDevReserveSize + _count <= _totalDevReserveSize, "Reached max minting limit for dev reserve!");
        _mintElements(owner(), _count);
        _currentDevReserveSize += _count;
    }

    function generatePreMintingOrder(uint256 _size) public onlyOwner {
        require(!_mintingOrderGenerated, "Minting order is already completely generated!");
        require(_mintingOrder.length < MAX_ELEMENTS, "Pre minting order is already full!");
        uint256 current = _mintingOrder.length + 1;
        uint256 currentMax = Math.min(current + _size, MAX_ELEMENTS);
        for (uint256 i = current; i <= currentMax; i++) {
            _mintingOrder.push(i);
        }
    }

    function shufflePreMintingOrder(uint256 _start, uint256 _end) public onlyOwner {
        require(!_mintingOrderGenerated, "Minting order is already completely generated!");
        require(_mintingOrder.length == MAX_ELEMENTS, "Pre minting order is already full!");
        for (uint256 i = _start; i < _end; i++) {
            uint256 n = _random(i, _mintingOrder.length);
            uint256 temp = _mintingOrder[n];
            _mintingOrder[n] = _mintingOrder[i];
            _mintingOrder[i] = temp;
        }
    }

    function _random(uint256 _start, uint256 _end) private view returns (uint256) {
        return _start + uint256(keccak256(abi.encodePacked(block.timestamp))) % (_end - _start);
    }

    function completeMintingOrderGeneration() public onlyOwner {
        require(!_mintingOrderGenerated, "Minting order is already completely generated!");
        require(_mintingOrder.length == MAX_ELEMENTS, "Minting order size is invalid!");
        _mintingOrderGenerated = true;
    }

    function setSalesRoundPreSale() public onlyOwner {
        _currentSalesRound = "PRESALE";
        emit SugarVillagePreSaleOpen();
    }

    function setSalesRoundEarly() public onlyOwner {
        _currentSalesRound = "EARLY";
        emit SugarVillageEarlySaleOpen();
    }

    function setSalesRoundMain() public onlyOwner {
        _currentSalesRound = "MAIN";
        emit SugarVillageMainSaleOpen();
    }

    function currentSalesRound() public view returns (string memory) {
        return _currentSalesRound;
    }

    function _baseURI() internal view virtual override returns (string memory) {
        return baseTokenURI;
    }

    function _setBaseURI(string memory baseURI) private {
        baseTokenURI = baseURI;
    }

    function reveal(string memory baseURI) external onlyOwner revealer {
        _setBaseURI(baseURI);
        emit SugarShopsRevealed();
    }

    function totalToken() public view returns (uint256) {
        return _tokenIdTracker.current();
    }

    function mint(uint256 _count) public payable saleIsOpen {
        uint256 total = totalToken();
        require(_count <= 2, "Only 2 shops can be minted at once!");
        require(mintingAvailableCurrentSalesRound(_msgSender(), _count), "Only 2 shops can be minted per round!");
        require(total + _count <= _salesRoundToMintLimitMap[currentSalesRound()], "Reached max minting limit for current round!");
        require(total + _count <= MAX_ELEMENTS, "Reached max minting limit!");
        require(msg.value >= price(_count), "Sent value is below the price!");

        _mintElements(_msgSender(), _count);
    }

    function _mintElements(address _to, uint256 _count) private {
        for (uint8 i = 0; i < _count; i++) {
            _mintAnElement(_to, _mintingOrder[totalToken()]);
            _salesRoundToUserMintCountMap[currentSalesRound()][_msgSender()] += 1;
        }
    }

    function _mintAnElement(address _to, uint256 _tokenId) private {
        _tokenIdTracker.increment();
        _safeMint(_to, _tokenId);

        emit HelloWorldFromSugarVillage(_tokenId);
    }

    function price(uint256 _count) public view returns (uint256) {
        return _salesRoundToPriceMap[currentSalesRound()] * _count;
    }

    function mintingAvailableCurrentSalesRound(address _owner, uint256 _count) public view returns (bool) {
        return _salesRoundToUserMintCountMap[currentSalesRound()][_owner] + _count <= 2;
    }

    function walletOfOwner(address _owner) external view returns (uint256[] memory) {
        uint256 tokenCount = balanceOf(_owner);

        uint256[] memory tokensId = new uint256[](tokenCount);
        for (uint256 i = 0; i < tokenCount; i++) {
            tokensId[i] = tokenOfOwnerByIndex(_owner, i);
        }

        return tokensId;
    }

    function pause() public onlyOwner {
        _pause();
    }

    function unpause() public onlyOwner {
        _unpause();
    }

    function withdrawAll() public onlyOwner {
        uint256 balance = address(this).balance;
        require(balance > 0);
        _withdraw(owner(), address(this).balance);
    }

    function _withdraw(address _address, uint256 _amount) private {
        (bool success,) = _address.call{value : _amount}("");
        require(success, "Transfer failed!");
    }

    /**
     * @dev See {ERC721-_beforeTokenTransfer}.
     *
     * Requirements:
     *
     * - the contract must not be paused.
     */
    function _beforeTokenTransfer(
        address from,
        address to,
        uint256 tokenId
    ) internal virtual override {
        super._beforeTokenTransfer(from, to, tokenId);

        require(!paused(), "ERC721Pausable: token transfer while paused!");
    }
}
