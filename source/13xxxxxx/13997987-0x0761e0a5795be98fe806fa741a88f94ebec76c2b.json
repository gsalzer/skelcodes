{"status":"1","message":"OK","result":[{"SourceCode":"// SPDX-License-Identifier: MIT\r\n\r\npragma solidity ^0.8.0;\r\n\r\ncontract Messaging {\r\n    uint256 public threadCount = 0;\r\n    mapping(address => string) private pubEncKeys; // mapping of address to public encryption key https://docs.metamask.io/guide/rpc-api.html#eth-getencryptionpublickey\r\n\r\n    event MessageSent (\r\n        address receiver,\r\n        string uri,\r\n        uint256 timestamp,\r\n        address sender,\r\n        uint256 thread_id\r\n    );\r\n\r\n    event ThreadCreated (\r\n        address receiver,\r\n        address sender,\r\n        uint256 thread_id,\r\n        uint256 timestamp,\r\n        string _sender_key,\r\n        string _receiver_key,\r\n        bool _encrypted\r\n    );\r\n\r\n    function getPubEncKeys(address receiver) public view returns(string memory sender_key, string memory receiver_key) {\r\n\r\n        require(bytes(pubEncKeys[msg.sender]).length != 0, \"Sender isn't registered on Dakiya\");\r\n\r\n        if (bytes(pubEncKeys[msg.sender]).length != 0) {\r\n            sender_key = pubEncKeys[msg.sender];\r\n        }\r\n        if (bytes(pubEncKeys[receiver]).length != 0) {\r\n            receiver_key = pubEncKeys[receiver];\r\n        }\r\n        return (sender_key, receiver_key);\r\n    }\r\n\r\n    function checkUserRegistration() public view returns(bool) {\r\n        return bytes(pubEncKeys[msg.sender]).length != 0;\r\n    }\r\n\r\n    function setPubEncKey(string memory encKey) public {\r\n        pubEncKeys[msg.sender] = encKey;\r\n    }\r\n\r\n    function sendMessage(\r\n        uint256 _thread_id,\r\n        string memory _uri,\r\n        address _receiver,\r\n        string memory _sender_key,\r\n        string memory _receiver_key,\r\n        bool encrypted\r\n    ) public {\r\n        if (_thread_id == 0) {\r\n            emit ThreadCreated(\r\n                _receiver,\r\n                msg.sender,\r\n                threadCount,\r\n                block.timestamp,\r\n                _sender_key,\r\n                _receiver_key,\r\n                encrypted\r\n            );\r\n\r\n            emit MessageSent(_receiver, _uri, block.timestamp, msg.sender, threadCount);\r\n\r\n            threadCount++;\r\n\r\n        } else {\r\n            emit MessageSent(_receiver, _uri, block.timestamp, msg.sender, _thread_id);\r\n        }\r\n    }\r\n}","ABI":"[{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"receiver\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"uri\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"thread_id\",\"type\":\"uint256\"}],\"name\":\"MessageSent\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"receiver\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"thread_id\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"_sender_key\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"_receiver_key\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"bool\",\"name\":\"_encrypted\",\"type\":\"bool\"}],\"name\":\"ThreadCreated\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"checkUserRegistration\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"receiver\",\"type\":\"address\"}],\"name\":\"getPubEncKeys\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"sender_key\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"receiver_key\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_thread_id\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"_uri\",\"type\":\"string\"},{\"internalType\":\"address\",\"name\":\"_receiver\",\"type\":\"address\"},{\"internalType\":\"string\",\"name\":\"_sender_key\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_receiver_key\",\"type\":\"string\"},{\"internalType\":\"bool\",\"name\":\"encrypted\",\"type\":\"bool\"}],\"name\":\"sendMessage\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"encKey\",\"type\":\"string\"}],\"name\":\"setPubEncKey\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"threadCount\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]","ContractName":"Messaging","CompilerVersion":"v0.8.7+commit.e28d00a7","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"MIT","Proxy":"0","Implementation":"","SwarmSource":"ipfs://3f7da763d86b6dd58d61dd7203488e0effd51fbc28a5c5813fccc24a50c3f89b"}]}