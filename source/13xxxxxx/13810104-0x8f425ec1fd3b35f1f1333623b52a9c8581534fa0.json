{"status":"1","message":"OK","result":[{"SourceCode":"{{\r\n  \"language\": \"Solidity\",\r\n  \"sources\": {\r\n    \"src/Castle.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: Unlicense\\npragma solidity 0.8.7;\\n\\nimport \\\"./interfaces/Interfaces.sol\\\";\\n\\n/// @dev A simple contract to orchestrate comings and going from the OrcsPortal\\ncontract Castle {\\n\\n    address implementation_;\\n    address public admin;\\n    \\n    address public portal;\\n    address public allies;\\n    address public orcs;\\n    address public zug;\\n    address public shr;\\n\\n    mapping (address => address) public reflection;\\n    mapping (uint256 => address) public orcOwner;\\n    mapping (uint256 => address) public allyOwner;\\n\\n    function initialize(address portal_, address orc_, address zug_, address shr_) external {\\n        require(msg.sender == admin);\\n        portal = portal_;\\n        orcs   = orc_;\\n        zug = zug_;\\n        shr = shr_;\\n    }\\n\\n    function setAllies(address a_) external {\\n        require(msg.sender == admin);\\n        allies = a_;\\n    }\\n\\n    function setReflection(address key_, address reflection_) external {\\n        require(msg.sender == admin);\\n        reflection[key_] = reflection_;\\n        reflection[reflection_] = key_;\\n    }\\n\\n    /// @dev Send Orcs, allies and tokens to PolyLand\\n    function travel(uint256[] calldata orcIds, uint256[] calldata alliesIds, uint256 zugAmount, uint256 shrAmount) external {\\n        address target = reflection[address(this)];\\n\\n        uint256 orcsLen   = orcIds.length;\\n        uint256 allieslen = alliesIds.length;\\n        uint256 currIndex = 0;\\n\\n        bytes[] memory calls = new bytes[]((orcsLen > 0 ? orcsLen + 1 : 0) + (allieslen > 0 ? allieslen + 1 : 0) + (zugAmount > 0 ? 1 : 0) + (shrAmount > 0 ? 1 : 0));\\n\\n\\n        if (orcsLen > 0) {\\n            _pullIds(orcs, orcIds);\\n\\n            // This will create orcs exactly as they exist in this chain\\n            for (uint256 i = 0; i < orcIds.length; i++) {\\n                calls[i] = _buildData(orcIds[i]);\\n            }\\n\\n            calls[orcsLen] = abi.encodeWithSelector(this.unstakeMany.selector,reflection[orcs], msg.sender,  orcIds);\\n            currIndex += orcsLen + 1;\\n        }\\n\\n        if (allieslen > 0) {\\n            _pullIds(allies, alliesIds);\\n\\n            // This will create orcs exactly as they exist in this chain\\n            for (uint256 i = 0; i < alliesIds.length; i++) {\\n                calls[currIndex + i] = _buildDataAllies(alliesIds[i]);\\n            }\\n\\n            calls[currIndex + allieslen] = abi.encodeWithSelector(this.unstakeMany.selector, reflection[allies], msg.sender,  alliesIds);\\n            currIndex += currIndex + allieslen + 1;\\n        }\\n\\n        if (zugAmount > 0) {\\n            ERC20Like(zug).burn(msg.sender, zugAmount);\\n            calls[currIndex] = abi.encodeWithSelector(this.mintToken.selector, reflection[address(zug)], msg.sender, zugAmount);\\n            currIndex++;\\n        }\\n\\n        if (shrAmount > 0) {\\n            ERC20Like(shr).burn(msg.sender, shrAmount);\\n            calls[currIndex] = abi.encodeWithSelector(this.mintToken.selector, reflection[address(shr)], msg.sender, shrAmount);\\n        }\\n\\n        PortalLike(portal).sendMessage(abi.encode(target, calls));\\n    }\\n\\n    function callOrcs(bytes calldata data) external {\\n        _onlyPortal();\\n\\n        (bool succ, ) = orcs.call(data);\\n        require(succ);\\n    }\\n\\n    event D(uint tt);\\n    event DAD(address al);\\n    function callAllies(bytes calldata data) external {\\n        _onlyPortal();\\n        \\n        (bool succ, ) = allies.call(data);\\n        require(succ);\\n    }\\n\\n    function unstakeMany(address token, address owner, uint256[] calldata ids) external {\\n        _onlyPortal();\\n\\n        emit DAD(token);\\n\\n        for (uint256 i = 0; i < ids.length; i++) {  \\n            emit D(ids[i]);\\n            if (token == orcs)   delete orcOwner[ids[i]];\\n            if (token == allies) delete allyOwner[ids[i]];\\n            ERC721Like(token).transfer(owner, ids[i]);\\n        }\\n    }\\n\\n    function mintToken(address token, address to, uint256 amount) external { \\n        _onlyPortal();\\n\\n        ERC20Like(token).mint(to, amount);\\n    }\\n\\n    function _pullIds(address token, uint256[] calldata ids) internal {\\n        // The ownership will be checked to the token contract\\n        OrcishLike(token).pull(msg.sender, ids);\\n    }\\n\\n    function pullCallback(address owner, uint256[] calldata ids) external {\\n        require(msg.sender == orcs || msg.sender == allies);\\n        for (uint256 i = 0; i < ids.length; i++) {\\n            _stake(msg.sender, ids[i], owner);\\n        }\\n    }\\n\\n    function _buildData(uint256 id) internal view returns (bytes memory data) {\\n        (uint8 b, uint8 h, uint8 m, uint8 o, uint16 l, uint16 zM, uint32 lP) = OrcishLike(orcs).orcs(id);\\n        data = abi.encodeWithSelector(this.callOrcs.selector, abi.encodeWithSelector(OrcishLike.manuallyAdjustOrc.selector,id, b, h, m, o, l, zM, lP));   \\n    }\\n\\n    function _buildDataAllies(uint256 id) internal view returns (bytes memory data) {\\n        (uint8 cl, uint16 l, uint32 lP, uint16 modF, uint8 sc, bytes22 d) = OrcishLike(allies).allies(id);\\n        data = abi.encodeWithSelector(this.callAllies.selector, abi.encodeWithSelector(OrcishLike.adjustAlly.selector,id,cl,l,lP,modF,sc,d));   \\n    }\\n\\n    function _stake(address token, uint256 id, address owner) internal {\\n        require((token == orcs ? orcOwner[id] : allyOwner[id]) == address(0), \\\"already staked\\\");\\n        require(msg.sender == token, \\\"not orcs contract\\\");\\n        require(ERC721Like(token).ownerOf(id) == address(this), \\\"orc not transferred\\\");\\n\\n        if (token == orcs)   orcOwner[id]  = owner;\\n        if (token == allies) allyOwner[id] = owner;\\n    }\\n\\n    function _onlyPortal() view internal {\\n        require(msg.sender == portal, \\\"not portal\\\");\\n    } \\n\\n}\"\r\n    },\r\n    \"src/interfaces/Interfaces.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: Unlicense\\npragma solidity 0.8.7;\\n\\ninterface OrcishLike {\\n    function pull(address owner, uint256[] calldata ids) external;\\n    function manuallyAdjustOrc(uint256 id, uint8 body, uint8 helm, uint8 mainhand, uint8 offhand, uint16 level, uint16 zugModifier, uint32 lvlProgress) external;\\n    function transfer(address to, uint256 tokenId) external;\\n    function orcs(uint256 id) external view returns(uint8 body, uint8 helm, uint8 mainhand, uint8 offhand, uint16 level, uint16 zugModifier, uint32 lvlProgress);\\n    function allies(uint256 id) external view returns (uint8 class, uint16 level, uint32 lvlProgress, uint16 modF, uint8 skillCredits, bytes22 details);\\n    function adjustAlly(uint256 id, uint8 class_, uint16 level_, uint32 lvlProgress_, uint16 modF_, uint8 skillCredits_, bytes22 details_) external;\\n}\\n\\ninterface PortalLike {\\n    function sendMessage(bytes calldata message_) external;\\n}\\n\\ninterface OracleLike {\\n    function request() external returns (uint64 key);\\n    function getRandom(uint64 id) external view returns(uint256 rand);\\n}\\n\\ninterface MetadataHandlerLike {\\n    function getTokenURI(uint16 id, uint8 body, uint8 helm, uint8 mainhand, uint8 offhand, uint16 level, uint16 zugModifier) external view returns (string memory);\\n}\\n\\ninterface MetadataHandlerAllies {\\n    function getTokenURI(uint256 id_, uint256 class_, uint256 level_, uint256 modF_, uint256 skillCredits_, bytes22 details_) external view returns (string memory);\\n}\\n\\ninterface RaidsLike {\\n    function stakeManyAndStartCampaign(uint256[] calldata ids_, address owner_, uint256 location_, bool double_) external;\\n    function startCampaignWithMany(uint256[] calldata ids, uint256 location_, bool double_) external;\\n    function commanders(uint256 id) external returns(address);\\n    function unstake(uint256 id) external;\\n}\\n\\ninterface RaidsLikePoly {\\n    function stakeManyAndStartCampaign(uint256[] calldata ids_, address owner_, uint256 location_, bool double_, uint256[] calldata potions_) external;\\n    function startCampaignWithMany(uint256[] calldata ids, uint256 location_, bool double_,  uint256[] calldata potions_) external;\\n    function commanders(uint256 id) external returns(address);\\n    function unstake(uint256 id) external;\\n}\\n\\ninterface CastleLike {\\n    function pullCallback(address owner, uint256[] calldata ids) external;\\n}\\n\\ninterface EtherOrcsLike {\\n    function ownerOf(uint256 id) external view returns (address owner_);\\n    function activities(uint256 id) external view returns (address owner, uint88 timestamp, uint8 action);\\n    function orcs(uint256 orcId) external view returns (uint8 body, uint8 helm, uint8 mainhand, uint8 offhand, uint16 level, uint16 zugModifier, uint32 lvlProgress);\\n}\\n\\ninterface ERC20Like {\\n    function balanceOf(address from) external view returns(uint256 balance);\\n    function burn(address from, uint256 amount) external;\\n    function mint(address from, uint256 amount) external;\\n    function transfer(address to, uint256 amount) external;\\n}\\n\\ninterface ERC1155Like {\\n    function mint(address to, uint256 id, uint256 amount) external;\\n    function burn(address from, uint256 id, uint256 amount) external;\\n}\\n\\ninterface ERC721Like {\\n    function transferFrom(address from, address to, uint256 id) external;   \\n    function transfer(address to, uint256 id) external;\\n    function ownerOf(uint256 id) external returns (address owner);\\n    function mint(address to, uint256 tokenid) external;\\n}\\n\\ninterface HallOfChampionsLike {\\n    function joined(uint256 orcId) external view returns (uint256 joinDate);\\n} \\n\\ninterface AlliesLike {\\n    function allies(uint256 id) external view returns (uint8 class, uint16 level, uint32 lvlProgress, uint16 modF, uint8 skillCredits, bytes22 details);\\n}\\n\"\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"optimizer\": {\r\n      \"enabled\": true,\r\n      \"runs\": 200\r\n    },\r\n    \"outputSelection\": {\r\n      \"*\": {\r\n        \"*\": [\r\n          \"evm.bytecode\",\r\n          \"evm.deployedBytecode\",\r\n          \"devdoc\",\r\n          \"userdoc\",\r\n          \"metadata\",\r\n          \"abi\"\r\n        ]\r\n      }\r\n    },\r\n    \"libraries\": {}\r\n  }\r\n}}","ABI":"[{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"tt\",\"type\":\"uint256\"}],\"name\":\"D\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"al\",\"type\":\"address\"}],\"name\":\"DAD\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"admin\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"allies\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"allyOwner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"data\",\"type\":\"bytes\"}],\"name\":\"callAllies\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"data\",\"type\":\"bytes\"}],\"name\":\"callOrcs\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"portal_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"orc_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"zug_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"shr_\",\"type\":\"address\"}],\"name\":\"initialize\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"mintToken\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"orcOwner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"orcs\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"portal\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"uint256[]\",\"name\":\"ids\",\"type\":\"uint256[]\"}],\"name\":\"pullCallback\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"reflection\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"a_\",\"type\":\"address\"}],\"name\":\"setAllies\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"key_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"reflection_\",\"type\":\"address\"}],\"name\":\"setReflection\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"shr\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256[]\",\"name\":\"orcIds\",\"type\":\"uint256[]\"},{\"internalType\":\"uint256[]\",\"name\":\"alliesIds\",\"type\":\"uint256[]\"},{\"internalType\":\"uint256\",\"name\":\"zugAmount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"shrAmount\",\"type\":\"uint256\"}],\"name\":\"travel\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"uint256[]\",\"name\":\"ids\",\"type\":\"uint256[]\"}],\"name\":\"unstakeMany\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"zug\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]","ContractName":"Castle","CompilerVersion":"v0.8.7+commit.e28d00a7","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"","Proxy":"0","Implementation":"","SwarmSource":""}]}