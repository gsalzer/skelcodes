{"status":"1","message":"OK","result":[{"SourceCode":"# @version 0.3.1\r\n\"\"\"\r\n@title Curve Factory\r\n@license MIT\r\n@author Curve.Fi\r\n@notice Permissionless pool deployer and registry\r\n\"\"\"\r\n\r\nstruct PoolArray:\r\n    token: address\r\n    liquidity_gauge: address\r\n    coins: address[2]\r\n    decimals: uint256[2]\r\n\r\ninterface ERC20:\r\n    def balanceOf(_addr: address) -> uint256: view\r\n    def decimals() -> uint256: view\r\n    def totalSupply() -> uint256: view\r\n    def approve(_spender: address, _amount: uint256): nonpayable\r\n    def initialize(_name: String[64], _symbol: String[32], _pool: address): nonpayable\r\n\r\ninterface CryptoPool:\r\n    def A() -> uint256: view\r\n    def gamma() -> uint256: view\r\n    def mid_fee() -> uint256: view\r\n    def out_fee() -> uint256: view\r\n    def fee() -> uint256: view\r\n    def allowed_extra_profit() -> uint256: view\r\n    def fee_gamma() -> uint256: view\r\n    def adjustment_step() -> uint256: view\r\n    def admin_fee() -> uint256: view\r\n    def ma_half_time() -> uint256: view\r\n    def price_scale() -> uint256: view\r\n    def price_oracle() -> uint256: view\r\n    def last_prices() -> uint256: view\r\n    def token() -> address: view\r\n    def coins(i: uint256) -> address: view\r\n    def get_virtual_price() -> uint256: view\r\n    def balances(i: uint256) -> uint256: view\r\n    def initialize(\r\n        A: uint256,\r\n        gamma: uint256,\r\n        mid_fee: uint256,\r\n        out_fee: uint256,\r\n        allowed_extra_profit: uint256,\r\n        fee_gamma: uint256,\r\n        adjustment_step: uint256,\r\n        admin_fee: uint256,\r\n        ma_half_time: uint256,\r\n        initial_price: uint256,\r\n        _token: address,\r\n        _coins: address[2]\r\n    ): nonpayable\r\n    def exchange(\r\n        i: uint256, j: uint256, dx: uint256, min_dy: uint256,\r\n        use_eth: bool, receiver: address, cb: Bytes[4]\r\n    ) -> uint256: payable\r\n\r\ninterface LiquidityGauge:\r\n    def initialize(_lp_token: address): nonpayable\r\n\r\nevent CryptoPoolDeployed:\r\n    token: address\r\n    coins: address[2]\r\n    A: uint256\r\n    gamma: uint256\r\n    mid_fee: uint256\r\n    out_fee: uint256\r\n    allowed_extra_profit: uint256\r\n    fee_gamma: uint256\r\n    adjustment_step: uint256\r\n    admin_fee: uint256\r\n    ma_half_time: uint256\r\n    initial_price: uint256\r\n    deployer: address\r\n\r\nevent LiquidityGaugeDeployed:\r\n    pool: address\r\n    token: address\r\n    gauge: address\r\n\r\n\r\nadmin: public(address)\r\nfuture_admin: public(address)\r\n\r\npool_list: public(address[4294967296])   # master list of pools\r\npool_count: public(uint256)              # actual length of pool_list\r\npool_data: HashMap[address, PoolArray]\r\n\r\n# fee receiver for plain pools\r\nfee_receiver: public(address)\r\n\r\npool_implementation: public(address)\r\ntoken_implementation: public(address)\r\ngauge_implementation: public(address)\r\n\r\n# mapping of coins -> pools for trading\r\n# a mapping key is generated for each pair of addresses via\r\n# `bitwise_xor(convert(a, uint256), convert(b, uint256))`\r\nmarkets: HashMap[uint256, address[4294967296]]\r\nmarket_counts: HashMap[uint256, uint256]\r\n\r\nWETH: immutable(address)\r\n\r\nN_COINS: constant(int128) = 2\r\nA_MULTIPLIER: constant(uint256) = 10000\r\n\r\n# Limits\r\nMAX_ADMIN_FEE: constant(uint256) = 10 * 10 ** 9\r\nMIN_FEE: constant(uint256) = 5 * 10 ** 5  # 0.5 bps\r\nMAX_FEE: constant(uint256) = 10 * 10 ** 9\r\n\r\nMIN_GAMMA: constant(uint256) = 10**10\r\nMAX_GAMMA: constant(uint256) = 2 * 10**16\r\n\r\nMIN_A: constant(uint256) = N_COINS**N_COINS * A_MULTIPLIER / 10\r\nMAX_A: constant(uint256) = N_COINS**N_COINS * A_MULTIPLIER * 100000\r\n\r\n\r\n@external\r\ndef __init__(_fee_receiver: address,\r\n             _pool_implementation: address,\r\n             _token_implementation: address,\r\n             _gauge_implementation: address,\r\n             _weth: address):\r\n    self.admin = msg.sender\r\n    self.fee_receiver = _fee_receiver\r\n    self.pool_implementation = _pool_implementation\r\n    self.token_implementation = _token_implementation\r\n    self.gauge_implementation = _gauge_implementation\r\n    WETH = _weth\r\n\r\n\r\n# <--- Factory Getters --->\r\n\r\n@view\r\n@external\r\ndef find_pool_for_coins(_from: address, _to: address, i: uint256 = 0) -> address:\r\n    \"\"\"\r\n    @notice Find an available pool for exchanging two coins\r\n    @param _from Address of coin to be sent\r\n    @param _to Address of coin to be received\r\n    @param i Index value. When multiple pools are available\r\n            this value is used to return the n'th address.\r\n    @return Pool address\r\n    \"\"\"\r\n    key: uint256 = bitwise_xor(convert(_from, uint256), convert(_to, uint256))\r\n    return self.markets[key][i]\r\n\r\n\r\n# <--- Pool Getters --->\r\n\r\n@view\r\n@external\r\ndef get_coins(_pool: address) -> address[2]:\r\n    \"\"\"\r\n    @notice Get the coins within a pool\r\n    @param _pool Pool address\r\n    @return List of coin addresses\r\n    \"\"\"\r\n    return self.pool_data[_pool].coins\r\n\r\n\r\n@view\r\n@external\r\ndef get_decimals(_pool: address) -> uint256[2]:\r\n    \"\"\"\r\n    @notice Get decimal places for each coin within a pool\r\n    @param _pool Pool address\r\n    @return uint256 list of decimals\r\n    \"\"\"\r\n    return self.pool_data[_pool].decimals\r\n\r\n\r\n@view\r\n@external\r\ndef get_balances(_pool: address) -> uint256[2]:\r\n    \"\"\"\r\n    @notice Get balances for each coin within a pool\r\n    @dev For pools using lending, these are the wrapped coin balances\r\n    @param _pool Pool address\r\n    @return uint256 list of balances\r\n    \"\"\"\r\n    return [CryptoPool(_pool).balances(0), CryptoPool(_pool).balances(1)]\r\n\r\n\r\n@view\r\n@external\r\ndef get_coin_indices(\r\n    _pool: address,\r\n    _from: address,\r\n    _to: address\r\n) -> (uint256, uint256):\r\n    \"\"\"\r\n    @notice Convert coin addresses to indices for use with pool methods\r\n    @param _pool Pool address\r\n    @param _from Coin address to be used as `i` within a pool\r\n    @param _to Coin address to be used as `j` within a pool\r\n    @return uint256 `i`, uint256 `j`\r\n    \"\"\"\r\n    coins: address[2] = self.pool_data[_pool].coins\r\n\r\n    if _from == coins[0] and _to == coins[1]:\r\n        return 0, 1\r\n    elif _from == coins[1] and _to == coins[0]:\r\n        return 1, 0\r\n    else:\r\n        raise \"Coins not found\"\r\n\r\n\r\n@view\r\n@external\r\ndef get_gauge(_pool: address) -> address:\r\n    \"\"\"\r\n    @notice Get the address of the liquidity gauge contract for a factory pool\r\n    @dev Returns `ZERO_ADDRESS` if a gauge has not been deployed\r\n    @param _pool Pool address\r\n    @return Implementation contract address\r\n    \"\"\"\r\n    return self.pool_data[_pool].liquidity_gauge\r\n\r\n\r\n@view\r\n@external\r\ndef get_eth_index(_pool: address) -> uint256:\r\n    for i in range(2):\r\n        if self.pool_data[_pool].coins[i] == WETH:\r\n            return i\r\n    return MAX_UINT256\r\n\r\n\r\n@view\r\n@external\r\ndef get_token(_pool: address) -> address:\r\n    return self.pool_data[_pool].token\r\n\r\n\r\n# <--- Pool Deployers --->\r\n\r\n@external\r\ndef deploy_pool(\r\n    _name: String[32],\r\n    _symbol: String[10],\r\n    _coins: address[2],\r\n    A: uint256,\r\n    gamma: uint256,\r\n    mid_fee: uint256,\r\n    out_fee: uint256,\r\n    allowed_extra_profit: uint256,\r\n    fee_gamma: uint256,\r\n    adjustment_step: uint256,\r\n    admin_fee: uint256,\r\n    ma_half_time: uint256,\r\n    initial_price: uint256\r\n) -> address:\r\n    \"\"\"\r\n    @notice Deploy a new pool\r\n    @param _name Name of the new plain pool\r\n    @param _symbol Symbol for the new plain pool - will be\r\n                   concatenated with factory symbol\r\n    Other parameters need some description\r\n    @return Address of the deployed pool\r\n    \"\"\"\r\n    # Validate parameters\r\n    assert A > MIN_A-1\r\n    assert A < MAX_A+1\r\n    assert gamma > MIN_GAMMA-1\r\n    assert gamma < MAX_GAMMA+1\r\n    assert mid_fee > MIN_FEE-1\r\n    assert mid_fee < MAX_FEE-1\r\n    assert out_fee >= mid_fee\r\n    assert out_fee < MAX_FEE-1\r\n    assert admin_fee < 10**18+1\r\n    assert allowed_extra_profit < 10**16+1\r\n    assert fee_gamma < 10**18+1\r\n    assert fee_gamma > 0\r\n    assert adjustment_step < 10**18+1\r\n    assert adjustment_step > 0\r\n    assert ma_half_time < 7 * 86400\r\n    assert ma_half_time > 0\r\n    assert initial_price > 10**6\r\n    assert initial_price < 10**30\r\n\r\n    decimals: uint256[2] = empty(uint256[2])\r\n    for i in range(2):\r\n        d: uint256 = ERC20(_coins[i]).decimals()\r\n        assert d < 19, \"Max 18 decimals for coins\"\r\n        decimals[i] = d\r\n    assert _coins[0] != _coins[1], \"Duplicate coins\"\r\n\r\n    name: String[64] = concat(\"Curve.fi Factory Crypto Pool: \", _name)\r\n    symbol: String[32] = concat(_symbol, \"-f\")\r\n\r\n    token: address = create_forwarder_to(self.token_implementation)\r\n    pool: address = create_forwarder_to(self.pool_implementation)\r\n\r\n    ERC20(token).initialize(name, symbol, pool)\r\n    CryptoPool(pool).initialize(\r\n        A, gamma, mid_fee, out_fee, allowed_extra_profit, fee_gamma,\r\n        adjustment_step, admin_fee, ma_half_time, initial_price,\r\n        token, _coins)\r\n\r\n    length: uint256 = self.pool_count\r\n    self.pool_list[length] = pool\r\n    self.pool_count = length + 1\r\n    self.pool_data[pool].token = token\r\n    self.pool_data[pool].decimals = decimals\r\n    self.pool_data[pool].coins = _coins\r\n\r\n    for i in range(2):\r\n        coin: address = _coins[i]\r\n        raw_call(\r\n            coin,\r\n            concat(\r\n                method_id(\"approve(address,uint256)\"),\r\n                convert(pool, bytes32),\r\n                convert(MAX_UINT256, bytes32)\r\n            )\r\n        )\r\n\r\n    key: uint256 = bitwise_xor(convert(_coins[0], uint256), convert(_coins[1], uint256))\r\n    length = self.market_counts[key]\r\n    self.markets[key][length] = pool\r\n    self.market_counts[key] = length + 1\r\n\r\n    log CryptoPoolDeployed(\r\n        token, _coins,\r\n        A, gamma, mid_fee, out_fee, allowed_extra_profit, fee_gamma,\r\n        adjustment_step, admin_fee, ma_half_time, initial_price,\r\n        msg.sender)\r\n    return pool\r\n\r\n\r\n@external\r\ndef deploy_gauge(_pool: address) -> address:\r\n    \"\"\"\r\n    @notice Deploy a liquidity gauge for a factory pool\r\n    @param _pool Factory pool address to deploy a gauge for\r\n    @return Address of the deployed gauge\r\n    \"\"\"\r\n    assert self.pool_data[_pool].coins[0] != ZERO_ADDRESS, \"Unknown pool\"\r\n    assert self.pool_data[_pool].liquidity_gauge == ZERO_ADDRESS, \"Gauge already deployed\"\r\n\r\n    gauge: address = create_forwarder_to(self.gauge_implementation)\r\n    token: address = self.pool_data[_pool].token\r\n    LiquidityGauge(gauge).initialize(token)\r\n    self.pool_data[_pool].liquidity_gauge = gauge\r\n\r\n    log LiquidityGaugeDeployed(_pool, token, gauge)\r\n    return gauge\r\n\r\n\r\n# <--- Admin / Guarded Functionality --->\r\n\r\n\r\n@external\r\ndef set_gauge_implementation(_gauge_implementation: address):\r\n    assert msg.sender == self.admin  # dev: admin-only function\r\n\r\n    self.gauge_implementation = _gauge_implementation\r\n\r\n\r\n@external\r\ndef commit_transfer_ownership(_addr: address):\r\n    \"\"\"\r\n    @notice Transfer ownership of this contract to `addr`\r\n    @param _addr Address of the new owner\r\n    \"\"\"\r\n    assert msg.sender == self.admin  # dev: admin only\r\n\r\n    self.future_admin = _addr\r\n\r\n\r\n@external\r\ndef accept_transfer_ownership():\r\n    \"\"\"\r\n    @notice Accept a pending ownership transfer\r\n    @dev Only callable by the new owner\r\n    \"\"\"\r\n    _admin: address = self.future_admin\r\n    assert msg.sender == _admin  # dev: future admin only\r\n\r\n    self.admin = _admin\r\n    self.future_admin = ZERO_ADDRESS\r\n\r\n\r\n@external\r\ndef set_fee_receiver(_fee_receiver: address):\r\n    \"\"\"\r\n    @notice Set fee receiver for base and plain pools\r\n    @param _fee_receiver Address that fees are sent to\r\n    \"\"\"\r\n    assert msg.sender == self.admin  # dev: admin only\r\n    self.fee_receiver = _fee_receiver","ABI":"[{\"name\":\"CryptoPoolDeployed\",\"inputs\":[{\"name\":\"token\",\"type\":\"address\",\"indexed\":false},{\"name\":\"coins\",\"type\":\"address[2]\",\"indexed\":false},{\"name\":\"A\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"gamma\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"mid_fee\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"out_fee\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"allowed_extra_profit\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"fee_gamma\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"adjustment_step\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"admin_fee\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"ma_half_time\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"initial_price\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"deployer\",\"type\":\"address\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"LiquidityGaugeDeployed\",\"inputs\":[{\"name\":\"pool\",\"type\":\"address\",\"indexed\":false},{\"name\":\"token\",\"type\":\"address\",\"indexed\":false},{\"name\":\"gauge\",\"type\":\"address\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"stateMutability\":\"nonpayable\",\"type\":\"constructor\",\"inputs\":[{\"name\":\"_fee_receiver\",\"type\":\"address\"},{\"name\":\"_pool_implementation\",\"type\":\"address\"},{\"name\":\"_token_implementation\",\"type\":\"address\"},{\"name\":\"_gauge_implementation\",\"type\":\"address\"},{\"name\":\"_weth\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"find_pool_for_coins\",\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"find_pool_for_coins\",\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"i\",\"type\":\"uint256\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"get_coins\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address[2]\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"get_decimals\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"uint256[2]\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"get_balances\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"uint256[2]\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"get_coin_indices\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"},{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"get_gauge\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"get_eth_index\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"get_token\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"deploy_pool\",\"inputs\":[{\"name\":\"_name\",\"type\":\"string\"},{\"name\":\"_symbol\",\"type\":\"string\"},{\"name\":\"_coins\",\"type\":\"address[2]\"},{\"name\":\"A\",\"type\":\"uint256\"},{\"name\":\"gamma\",\"type\":\"uint256\"},{\"name\":\"mid_fee\",\"type\":\"uint256\"},{\"name\":\"out_fee\",\"type\":\"uint256\"},{\"name\":\"allowed_extra_profit\",\"type\":\"uint256\"},{\"name\":\"fee_gamma\",\"type\":\"uint256\"},{\"name\":\"adjustment_step\",\"type\":\"uint256\"},{\"name\":\"admin_fee\",\"type\":\"uint256\"},{\"name\":\"ma_half_time\",\"type\":\"uint256\"},{\"name\":\"initial_price\",\"type\":\"uint256\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"deploy_gauge\",\"inputs\":[{\"name\":\"_pool\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"set_gauge_implementation\",\"inputs\":[{\"name\":\"_gauge_implementation\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"commit_transfer_ownership\",\"inputs\":[{\"name\":\"_addr\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"accept_transfer_ownership\",\"inputs\":[],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"set_fee_receiver\",\"inputs\":[{\"name\":\"_fee_receiver\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"admin\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"future_admin\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"pool_list\",\"inputs\":[{\"name\":\"arg0\",\"type\":\"uint256\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"pool_count\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"fee_receiver\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"pool_implementation\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"token_implementation\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"gauge_implementation\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]}]","ContractName":"Vyper_contract","CompilerVersion":"vyper:0.3.1","OptimizationUsed":"0","Runs":"0","ConstructorArguments":"000000000000000000000000ecb456ea5365865ebab8a2661b0c503410e9b34700000000000000000000000002152d5edcdba56a55efee36ceb9d9f7e47aeb5f00000000000000000000000029ec0d55b8f26298a5350c64f56281eb070bf47e0000000000000000000000005ac53910dea4779e5ac3a7e997df8e9d5f6a7c9d000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2","EVMVersion":"Default","Library":"","LicenseType":"None","Proxy":"0","Implementation":"","SwarmSource":""}]}