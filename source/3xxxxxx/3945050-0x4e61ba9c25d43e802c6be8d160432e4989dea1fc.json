{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.11;\r\n\r\n/*\r\n  Allows buyers to securely/confidently buy recent ICO tokens that are\r\n  still non-transferrable, on an IOU basis. Like HitBTC, but with protection,\r\n  control, and guarantee of either the purchased tokens or ETH refunded.\r\n\r\n  The Buyer's ETH will be locked into the contract until the purchased\r\n  IOU/tokens arrive here and are ready for the buyer to invoke withdraw(),\r\n  OR until cut-off time defined below is exceeded and as a result ETH\r\n  refunds/withdrawals become enabled.\r\n\r\n  The buyer's ETH will ONLY be released to the seller AFTER the buyer\r\n  manually withdraws their tokens by sending this contract a transaction\r\n  with 0 ETH.\r\n\r\n  In other words, the seller must fulfill the IOU token purchases any time\r\n  before the cut-off time defined below, otherwise the buyer gains the\r\n  ability to withdraw their ETH.\r\n\r\n  Estimated Time of Distribution: 3-5 weeks from ICO according to TenX\r\n  Cut-off Time: ~ August 9, 2017\r\n\r\n  Greetz: blast, cintix\r\n  Bounty: foobarbizarre@gmail.com (Please report any findings or suggestions!)\r\n\r\n  Thank you\r\n*/\r\n\r\ncontract ERC20 {\r\n  function transfer(address _to, uint _value);\r\n  function balanceOf(address _owner) constant returns (uint balance);\r\n}\r\n\r\ncontract IOU {\r\n  // Store the amount of IOUs purchased by a buyer\r\n  mapping (address => uint256) public iou_purchased;\r\n\r\n  // Store the amount of ETH sent in by a buyer\r\n  mapping (address => uint256) public eth_sent;\r\n\r\n  // Total IOUs available to sell\r\n  uint256 public total_iou_available = 52500000000000000000000;\r\n\r\n  // Total IOUs purchased by all buyers\r\n  uint256 public total_iou_purchased;\r\n\r\n  //  PAY token contract address (IOU offering)\r\n  ERC20 public token = ERC20(0xB97048628DB6B661D4C2aA833e95Dbe1A905B280);\r\n\r\n  // The seller's address (to receive ETH upon distribution, and for authing safeties)\r\n  address seller = 0xB00Ae1e677B27Eee9955d632FF07a8590210B366;\r\n\r\n  // Halt further purchase ability just in case\r\n  bool public halt_purchases;\r\n\r\n  /*\r\n    Safety to withdraw all tokens back to seller in the event any get stranded.\r\n    Does not leave buyers susceptible. If anything, not enough tokens in the contract\r\n    will enable them to withdraw their ETH so long as the specified block.number has been mined\r\n  */\r\n  function withdrawTokens() {\r\n    if(msg.sender != seller) throw;\r\n    token.transfer(seller, token.balanceOf(address(this)));\r\n  }\r\n\r\n  /*\r\n    Safety to prevent anymore purchases/sales from occurring in the event of\r\n    unforeseen issue, or if seller wishes to limit this particular sale price\r\n    and start a new contract with a new price. The contract will of course\r\n    allow withdrawals to occur still.\r\n  */\r\n  function haltPurchases() {\r\n    if(msg.sender != seller) throw;\r\n    halt_purchases = true;\r\n  }\r\n\r\n  function resumePurchases() {\r\n    if(msg.sender != seller) throw;\r\n    halt_purchases = false;\r\n  }\r\n\r\n  function withdraw() payable {\r\n    /*\r\n      Main mechanism to ensure a buyer's purchase/ETH/IOU is safe.\r\n\r\n      Refund the buyer's ETH if we're beyond the cut-off date of our distribution\r\n      promise AND if the contract doesn't have an adequate amount of tokens\r\n      to distribute to the buyer. Time-sensitive buyer/ETH protection is only\r\n      applicable if the contract doesn't have adequate tokens for the buyer.\r\n\r\n      The \"adequacy\" check prevents the seller and/or third party attacker\r\n      from locking down buyers' ETH by sending in an arbitrary amount of tokens.\r\n\r\n      If for whatever reason the tokens remain locked for an unexpected period\r\n      beyond the time defined by block.number, patient buyers may still wait until\r\n      the contract is filled with their purchased IOUs/tokens. Once the tokens\r\n      are here, they can initiate a withdraw() to retrieve their tokens. Attempting\r\n      to withdraw any sooner (after the block has been mined, but tokens not arrived)\r\n      will result in a refund of buyer's ETH.\r\n    */\r\n    if(block.number > 4199999 && iou_purchased[msg.sender] > token.balanceOf(address(this))) {\r\n      // We didn't fulfill our promise to have adequate tokens withdrawable at xx time\r\n      // Refund the buyer's ETH automatically instead\r\n      uint256 eth_to_refund = eth_sent[msg.sender];\r\n\r\n      // If the user doesn't have any ETH or tokens to withdraw, get out ASAP\r\n      if(eth_to_refund == 0 || iou_purchased[msg.sender] == 0) throw;\r\n\r\n      // Adjust total purchased so others can buy\r\n      total_iou_purchased -= iou_purchased[msg.sender];\r\n\r\n      // Clear record of buyer's ETH and IOU balance before refunding\r\n      eth_sent[msg.sender] = 0;\r\n      iou_purchased[msg.sender] = 0;\r\n\r\n      msg.sender.transfer(eth_to_refund);\r\n      return;\r\n    }\r\n\r\n    /*\r\n      Check if there is an adequate amount of tokens in the contract yet\r\n      and allow the buyer to withdraw tokens and release ETH to the seller if so\r\n    */\r\n    if(token.balanceOf(address(this)) == 0 || iou_purchased[msg.sender] > token.balanceOf(address(this))) throw;\r\n\r\n    uint256 iou_to_withdraw = iou_purchased[msg.sender];\r\n    uint256 eth_to_release = eth_sent[msg.sender];\r\n\r\n    // If the user doesn't have any IOUs or ETH to withdraw/release, get out ASAP\r\n    if(iou_to_withdraw == 0 || eth_to_release == 0) throw;\r\n\r\n    // Clear record of buyer's IOU and ETH balance before transferring out\r\n    iou_purchased[msg.sender] = 0;\r\n    eth_sent[msg.sender] = 0;\r\n\r\n    // Distribute tokens to the buyer\r\n    token.transfer(msg.sender, iou_to_withdraw);\r\n\r\n    // Release buyer's ETH to the seller\r\n    seller.transfer(eth_to_release);\r\n  }\r\n\r\n  function purchase() payable {\r\n    if(halt_purchases) throw;\r\n\r\n    // Determine amount of tokens user wants to/can buy\r\n    uint256 iou_to_purchase = 160 * msg.value; // price is 160 per ETH\r\n\r\n    // Check if we have enough IOUs left to sell\r\n    if((total_iou_purchased + iou_to_purchase) > total_iou_available) throw;\r\n\r\n    // Update the amount of IOUs purchased by user. Also keep track of the total ETH they sent in\r\n    iou_purchased[msg.sender] += iou_to_purchase;\r\n    eth_sent[msg.sender] += msg.value;\r\n\r\n    // Update the total amount of IOUs purchased by all buyers\r\n    total_iou_purchased += iou_to_purchase;\r\n  }\r\n\r\n  // Fallback function/entry point\r\n  function () payable {\r\n    if(msg.value == 0) {\r\n      withdraw();\r\n    }\r\n    else {\r\n      purchase();\r\n    }\r\n  }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"eth_sent\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"haltPurchases\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"withdraw\",\"outputs\":[],\"payable\":true,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"resumePurchases\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"purchase\",\"outputs\":[],\"payable\":true,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"iou_purchased\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"total_iou_available\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"withdrawTokens\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"total_iou_purchased\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"halt_purchases\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"token\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"payable\":true,\"type\":\"fallback\"}]","ContractName":"IOU","CompilerVersion":"v0.4.11+commit.68ef5810","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://62a79e693073e0b112df095c8732648db2fb08cc0aab60ec2d494e3940e6f907"}]}