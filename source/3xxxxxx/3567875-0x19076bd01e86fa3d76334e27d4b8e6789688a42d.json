{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.4;\r\n\r\ncontract DutchAuctionInterface {\r\n    function bid(address receiver) payable returns (uint);\r\n    function claimTokens(address receiver);\r\n    function stage() returns (uint);\r\n    TokenInterface public gnosisToken;\r\n}\r\n\r\n\r\ncontract TokenInterface {\r\n    function transfer(address to, uint256 value) returns (bool success);\r\n    function balanceOf(address owner) constant returns (uint256 balance);\r\n}\r\n\r\n\r\ncontract ProxySender {\r\n\r\n    event BidSubmission(address indexed sender, uint256 amount);\r\n    event RefundSubmission(address indexed sender, uint256 amount);\r\n    event RefundReceived(uint256 amount);\r\n\r\n    uint public constant AUCTION_STARTED = 2;\r\n    uint public constant TRADING_STARTED = 4;\r\n\r\n    DutchAuctionInterface public dutchAuction;\r\n    TokenInterface public gnosisToken;\r\n    uint public totalContributions;\r\n    uint public totalTokens;\r\n    uint public totalBalance;\r\n    mapping (address => uint) public contributions;\r\n    Stages public stage;\r\n\r\n    enum Stages {\r\n        ContributionsCollection,\r\n        ContributionsSent,\r\n        TokensClaimed\r\n    }\r\n\r\n    modifier atStage(Stages _stage) {\r\n        if (stage != _stage)\r\n            throw;\r\n        _;\r\n    }\r\n\r\n    function ProxySender(address _dutchAuction)\r\n        public\r\n    {\r\n        if (_dutchAuction == 0) throw;\r\n        dutchAuction = DutchAuctionInterface(_dutchAuction);\r\n        gnosisToken = dutchAuction.gnosisToken();\r\n        if (address(gnosisToken) == 0) throw;\r\n        stage = Stages.ContributionsCollection;\r\n    }\r\n\r\n    function()\r\n        public\r\n        payable\r\n    {\r\n        if (msg.sender == address(dutchAuction))\r\n            RefundReceived(msg.value);\r\n        else if (stage == Stages.ContributionsCollection)\r\n            contribute();\r\n        else if(stage == Stages.TokensClaimed)\r\n            transfer();\r\n        else\r\n            throw;\r\n    }\r\n\r\n    function contribute()\r\n        public\r\n        payable\r\n        atStage(Stages.ContributionsCollection)\r\n    {\r\n        contributions[msg.sender] += msg.value;\r\n        totalContributions += msg.value;\r\n        BidSubmission(msg.sender, msg.value);\r\n    }\r\n\r\n    function refund()\r\n        public\r\n        atStage(Stages.ContributionsCollection)\r\n    {\r\n        uint contribution = contributions[msg.sender];\r\n        contributions[msg.sender] = 0;\r\n        totalContributions -= contribution;\r\n        RefundSubmission(msg.sender, contribution);\r\n        if (!msg.sender.send(contribution)) throw;\r\n    }\r\n\r\n    function bidProxy()\r\n        public\r\n        atStage(Stages.ContributionsCollection)\r\n        returns(bool)\r\n    {\r\n        // Check auction has started\r\n        if (dutchAuction.stage() != AUCTION_STARTED)\r\n            throw;\r\n        // Send all money to auction contract\r\n        stage = Stages.ContributionsSent;\r\n        dutchAuction.bid.value(this.balance)(0);\r\n        return true;\r\n    }\r\n\r\n    function claimProxy()\r\n        public\r\n        atStage(Stages.ContributionsSent)\r\n    {\r\n        // Auction is over\r\n        if (dutchAuction.stage() != TRADING_STARTED)\r\n            throw;\r\n        dutchAuction.claimTokens(0);\r\n        totalTokens = gnosisToken.balanceOf(this);\r\n        totalBalance = this.balance;\r\n        stage = Stages.TokensClaimed;\r\n    }\r\n\r\n    function transfer()\r\n        public\r\n        atStage(Stages.TokensClaimed)\r\n        returns (uint amount)\r\n    {\r\n        uint contribution = contributions[msg.sender];\r\n        contributions[msg.sender] = 0;\r\n        // Calc. percentage of tokens for sender\r\n        amount = totalTokens * contribution / totalContributions;\r\n        gnosisToken.transfer(msg.sender, amount);\r\n        // Send possible refund share\r\n        uint refund = totalBalance * contribution / totalContributions;\r\n        if (refund > 0)\r\n            if (!msg.sender.send(refund)) throw;\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"AUCTION_STARTED\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"claimProxy\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalContributions\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"contributions\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"gnosisToken\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalTokens\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"transfer\",\"outputs\":[{\"name\":\"amount\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"TRADING_STARTED\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"dutchAuction\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalBalance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"stage\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"contribute\",\"outputs\":[],\"payable\":true,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"bidProxy\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"inputs\":[{\"name\":\"_dutchAuction\",\"type\":\"address\"}],\"payable\":false,\"type\":\"constructor\"},{\"payable\":true,\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"BidSubmission\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"RefundSubmission\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"RefundReceived\",\"type\":\"event\"}]","ContractName":"ProxySender","CompilerVersion":"v0.4.10+commit.f0d539ae","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"0000000000000000000000001d0dcc8d8bcafa8e8502beaeef6cbd49d3affcdc","Library":"","SwarmSource":"bzzr://2be3def76b7005b2e32b815d130ea67c05389224026cb11168bf952e437b7aa8"}]}