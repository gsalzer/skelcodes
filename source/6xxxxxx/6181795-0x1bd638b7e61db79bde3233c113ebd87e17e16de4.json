{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.19;\r\n\r\ncontract AppCoins {\r\n    mapping (address => mapping (address => uint256)) public allowance;\r\n    function balanceOf (address _owner) public view returns (uint256);\r\n    function transferFrom(address _from, address _to, uint256 _value) public returns (uint);\r\n}\r\n\r\ncontract AppCoinsIABInterface {\r\n    function division(uint numerator, uint denominator) public view returns (uint);\r\n    function buy(string _packageName, string _sku, uint256 _amount, address _addr_appc, address _dev, address _appstore, address _oem, bytes2 _countryCode) public view returns (bool);\r\n}\r\n\r\ncontract AppCoinsIAB is AppCoinsIABInterface {\r\n\r\n    uint public dev_share = 85;\r\n    uint public appstore_share = 10;\r\n    uint public oem_share = 5;\r\n\r\n    mapping (address => bool) allowedAddresses;\r\n    address owner;\r\n\r\n    modifier onlyAllowedAddress(string _funcName) {\r\n        if(!allowedAddresses[msg.sender]){\r\n            emit Error(_funcName, \"Operation can only be performed by allowed Addresses\");\r\n            return;\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier onlyOwner(string _funcName) {\r\n        if(owner != msg.sender){\r\n            emit Error(_funcName, \"Operation can only be performed by contract owner\");\r\n            return;\r\n        }\r\n        _;\r\n    }\r\n\r\n\r\n    event Buy(string packageName, string _sku, uint _amount, address _from, address _dev, address _appstore, address _oem, bytes2 countryCode);\r\n    event Error(string func, string message);\r\n    event OffChainBuy(address _wallet, bytes32 _rootHash);\r\n\r\n    function AppCoinsIAB() public {\r\n        owner = msg.sender;\r\n    }\r\n\r\n    function addAllowedAddress(address _account) public onlyOwner(\"addAllowedAddress\"){\r\n        allowedAddresses[_account] = true;\r\n    }\r\n\r\n    function removeAllowedAddress(address _account) public onlyOwner(\"removeAllowedAddress\") {\r\n        allowedAddresses[_account] = false;\r\n    }\r\n\r\n    function informOffChainBuy(address[] _walletList, bytes32[] _rootHashList) public onlyAllowedAddress(\"informOffChainTransaction\") {\r\n        if(_walletList.length != _rootHashList.length){\r\n            emit Error(\"informOffChainTransaction\", \"Wallet list and Roothash list must have the same lengths\");\r\n            return;\r\n        }\r\n        for(uint i = 0; i < _walletList.length; i++){\r\n            emit OffChainBuy(_walletList[i],_rootHashList[i]);\r\n        }\r\n    }\r\n\r\n    function division(uint _numerator, uint _denominator) public view returns (uint) {\r\n        uint quotient = _numerator / _denominator;\r\n        return quotient;\r\n    }\r\n\r\n\r\n    function buy(string _packageName, string _sku, uint256 _amount, address _addr_appc, address _dev, address _appstore, address _oem, bytes2 _countryCode) public view returns (bool) {\r\n        require(_addr_appc != 0x0);\r\n        require(_dev != 0x0);\r\n        require(_appstore != 0x0);\r\n        require(_oem != 0x0);\r\n\r\n        AppCoins appc = AppCoins(_addr_appc);\r\n        uint256 aux = appc.allowance(msg.sender, address(this));\r\n        if(aux < _amount){\r\n            emit Error(\"buy\",\"Not enough allowance\");\r\n            return false;\r\n        }\r\n\r\n        uint[] memory amounts = new uint[](3);\r\n        amounts[0] = division(_amount * dev_share, 100);\r\n        amounts[1] = division(_amount * appstore_share, 100);\r\n        amounts[2] = division(_amount * oem_share, 100);\r\n\r\n        appc.transferFrom(msg.sender, _dev, amounts[0]);\r\n        appc.transferFrom(msg.sender, _appstore, amounts[1]);\r\n        appc.transferFrom(msg.sender, _oem, amounts[2]);\r\n\r\n        emit Buy(_packageName, _sku, _amount, msg.sender, _dev, _appstore, _oem, _countryCode);\r\n\r\n        return true;\r\n    }\r\n}","ABI":"[{\"constant\":false,\"inputs\":[{\"name\":\"_account\",\"type\":\"address\"}],\"name\":\"removeAllowedAddress\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"dev_share\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_account\",\"type\":\"address\"}],\"name\":\"addAllowedAddress\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_walletList\",\"type\":\"address[]\"},{\"name\":\"_rootHashList\",\"type\":\"bytes32[]\"}],\"name\":\"informOffChainBuy\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_packageName\",\"type\":\"string\"},{\"name\":\"_sku\",\"type\":\"string\"},{\"name\":\"_amount\",\"type\":\"uint256\"},{\"name\":\"_addr_appc\",\"type\":\"address\"},{\"name\":\"_dev\",\"type\":\"address\"},{\"name\":\"_appstore\",\"type\":\"address\"},{\"name\":\"_oem\",\"type\":\"address\"},{\"name\":\"_countryCode\",\"type\":\"bytes2\"}],\"name\":\"buy\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_numerator\",\"type\":\"uint256\"},{\"name\":\"_denominator\",\"type\":\"uint256\"}],\"name\":\"division\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"oem_share\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"appstore_share\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"packageName\",\"type\":\"string\"},{\"indexed\":false,\"name\":\"_sku\",\"type\":\"string\"},{\"indexed\":false,\"name\":\"_amount\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"_from\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_dev\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_appstore\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_oem\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"countryCode\",\"type\":\"bytes2\"}],\"name\":\"Buy\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"func\",\"type\":\"string\"},{\"indexed\":false,\"name\":\"message\",\"type\":\"string\"}],\"name\":\"Error\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"_wallet\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_rootHash\",\"type\":\"bytes32\"}],\"name\":\"OffChainBuy\",\"type\":\"event\"}]","ContractName":"AppCoinsIAB","CompilerVersion":"v0.4.21+commit.dfe3193c","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://550a09443d80be989d11d72a6927eceb1b91fab0ed3b0b58c98222c3c94102d9"}]}