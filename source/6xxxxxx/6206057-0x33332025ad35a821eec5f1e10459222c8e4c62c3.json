{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.19;\r\n\r\ncontract Ownable {\r\n    address public owner;\r\n\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n\r\n    function Ownable() public {\r\n        owner = msg.sender; \r\n    }\r\n\r\n    /**\r\n        @dev Transfers the ownership of the contract.\r\n\r\n        @param _to Address of the new owner\r\n    */\r\n    function setOwner(address _to) public onlyOwner returns (bool) {\r\n        require(_to != address(0));\r\n        owner = _to;\r\n        return true;\r\n    } \r\n}\r\n\r\n\r\ncontract Delegable is Ownable {\r\n    event AddDelegate(address delegate);\r\n    event RemoveDelegate(address delegate);\r\n\r\n    mapping(address => DelegateLog) public delegates;\r\n\r\n    struct DelegateLog {\r\n        uint256 started;\r\n        uint256 ended;\r\n    }\r\n\r\n    /**\r\n        @dev Only allows current delegates.\r\n    */\r\n    modifier onlyDelegate() {\r\n        DelegateLog memory delegateLog = delegates[msg.sender];\r\n        require(delegateLog.started != 0 && delegateLog.ended == 0);\r\n        _;\r\n    }\r\n    \r\n    /**\r\n        @dev Checks if a delegate existed at the timestamp.\r\n\r\n        @param _address Address of the delegate\r\n        @param timestamp Moment to check\r\n\r\n        @return true if at the timestamp the delegate existed\r\n    */\r\n    function wasDelegate(address _address, uint256 timestamp) public view returns (bool) {\r\n        DelegateLog memory delegateLog = delegates[_address];\r\n        return timestamp >= delegateLog.started && delegateLog.started != 0 && (delegateLog.ended == 0 || timestamp < delegateLog.ended);\r\n    }\r\n\r\n    /**\r\n        @dev Checks if a delegate is active\r\n\r\n        @param _address Address of the delegate\r\n        \r\n        @return true if the delegate is active\r\n    */\r\n    function isDelegate(address _address) public view returns (bool) {\r\n        DelegateLog memory delegateLog = delegates[_address];\r\n        return delegateLog.started != 0 && delegateLog.ended == 0;\r\n    }\r\n\r\n    /**\r\n        @dev Adds a new worker.\r\n\r\n        @param _address Address of the worker\r\n    */\r\n    function addDelegate(address _address) public onlyOwner returns (bool) {\r\n        DelegateLog storage delegateLog = delegates[_address];\r\n        require(delegateLog.started == 0);\r\n        delegateLog.started = block.timestamp;\r\n        emit AddDelegate(_address);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n        @dev Removes an existing worker, removed workers can't be added back.\r\n\r\n        @param _address Address of the worker to remove\r\n    */\r\n    function removeDelegate(address _address) public onlyOwner returns (bool) {\r\n        DelegateLog storage delegateLog = delegates[_address];\r\n        require(delegateLog.started != 0 && delegateLog.ended == 0);\r\n        delegateLog.ended = block.timestamp;\r\n        emit RemoveDelegate(_address);\r\n        return true;\r\n    }\r\n}\r\n\r\ncontract BytesUtils {\r\n    function readBytes32(bytes data, uint256 index) internal pure returns (bytes32 o) {\r\n        require(data.length / 32 > index);\r\n        assembly {\r\n            o := mload(add(data, add(32, mul(32, index))))\r\n        }\r\n    }\r\n}\r\n\r\ncontract Token {\r\n    function transfer(address _to, uint _value) public returns (bool success);\r\n    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success);\r\n    function allowance(address _owner, address _spender) public view returns (uint256 remaining);\r\n    function approve(address _spender, uint256 _value) public returns (bool success);\r\n    function increaseApproval (address _spender, uint _addedValue) public returns (bool success);\r\n    function balanceOf(address _owner) public view returns (uint256 balance);\r\n}\r\n\r\n\r\n/**\r\n    @dev Defines the interface of a standard RCN oracle.\r\n\r\n    The oracle is an agent in the RCN network that supplies a convertion rate between RCN and any other currency,\r\n    it's primarily used by the exchange but could be used by any other agent.\r\n*/\r\ncontract Oracle is Ownable {\r\n    uint256 public constant VERSION = 4;\r\n\r\n    event NewSymbol(bytes32 _currency);\r\n\r\n    mapping(bytes32 => bool) public supported;\r\n    bytes32[] public currencies;\r\n\r\n    /**\r\n        @dev Returns the url where the oracle exposes a valid \"oracleData\" if needed\r\n    */\r\n    function url() public view returns (string);\r\n\r\n    /**\r\n        @dev Returns a valid convertion rate from the currency given to RCN\r\n\r\n        @param symbol Symbol of the currency\r\n        @param data Generic data field, could be used for off-chain signing\r\n    */\r\n    function getRate(bytes32 symbol, bytes data) public returns (uint256 rate, uint256 decimals);\r\n\r\n    /**\r\n        @dev Adds a currency to the oracle, once added it cannot be removed\r\n\r\n        @param ticker Symbol of the currency\r\n\r\n        @return if the creation was done successfully\r\n    */\r\n    function addCurrency(string ticker) public onlyOwner returns (bool) {\r\n        bytes32 currency = encodeCurrency(ticker);\r\n        NewSymbol(currency);\r\n        supported[currency] = true;\r\n        currencies.push(currency);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n        @return the currency encoded as a bytes32\r\n    */\r\n    function encodeCurrency(string currency) public pure returns (bytes32 o) {\r\n        require(bytes(currency).length <= 32);\r\n        assembly {\r\n            o := mload(add(currency, 32))\r\n        }\r\n    }\r\n    \r\n    /**\r\n        @return the currency string from a encoded bytes32\r\n    */\r\n    function decodeCurrency(bytes32 b) public pure returns (string o) {\r\n        uint256 ns = 256;\r\n        while (true) { if (ns == 0 || (b<<ns-8) != 0) break; ns -= 8; }\r\n        assembly {\r\n            ns := div(ns, 8)\r\n            o := mload(0x40)\r\n            mstore(0x40, add(o, and(add(add(ns, 0x20), 0x1f), not(0x1f))))\r\n            mstore(o, ns)\r\n            mstore(add(o, 32), b)\r\n        }\r\n    }\r\n}\r\n\r\n\r\ncontract RipioOracle is Oracle, Delegable, BytesUtils {\r\n    event DelegatedCall(address requester, address to);\r\n    event CacheHit(address requester, bytes32 currency, uint256 requestTimestamp, uint256 deliverTimestamp, uint256 rate, uint256 decimals);\r\n    event DeliveredRate(address requester, bytes32 currency, address signer, uint256 requestTimestamp, uint256 rate, uint256 decimals);\r\n\r\n    uint256 public expiration = 6 hours;\r\n\r\n    uint constant private INDEX_TIMESTAMP = 0;\r\n    uint constant private INDEX_RATE = 1;\r\n    uint constant private INDEX_DECIMALS = 2;\r\n    uint constant private INDEX_V = 3;\r\n    uint constant private INDEX_R = 4;\r\n    uint constant private INDEX_S = 5;\r\n\r\n    string private infoUrl;\r\n    \r\n    address public prevOracle;\r\n    Oracle public fallback;\r\n    mapping(bytes32 => RateCache) public cache;\r\n\r\n    struct RateCache {\r\n        uint256 timestamp;\r\n        uint256 rate;\r\n        uint256 decimals;\r\n    }\r\n\r\n    function url() public view returns (string) {\r\n        return infoUrl;\r\n    }\r\n\r\n    /**\r\n        @dev Sets the time window of the validity of the rates signed.\r\n\r\n        @param time Duration of the window\r\n\r\n        @return true is the time was set correctly\r\n    */\r\n    function setExpirationTime(uint256 time) public onlyOwner returns (bool) {\r\n        expiration = time;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n        @dev Sets the url to retrieve the data for 'getRate'\r\n\r\n        @param _url New url\r\n    */\r\n    function setUrl(string _url) public onlyOwner returns (bool) {\r\n        infoUrl = _url;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n        @dev Sets another oracle as the replacement to this oracle\r\n        All 'getRate' calls will be forwarded to this new oracle\r\n\r\n        @param _fallback New oracle\r\n    */\r\n    function setFallback(Oracle _fallback) public onlyOwner returns (bool) {\r\n        fallback = _fallback;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n        @dev Invalidates the cache of a given currency\r\n\r\n        @param currency Currency to invalidate the cache\r\n    */\r\n    function invalidateCache(bytes32 currency) public onlyOwner returns (bool) {\r\n        delete cache[currency].timestamp;\r\n        return true;\r\n    }\r\n    \r\n    function setPrevOracle(address oracle) public onlyOwner returns (bool) {\r\n        prevOracle = oracle;\r\n        return true;\r\n    }\r\n\r\n    function isExpired(uint256 timestamp) internal view returns (bool) {\r\n        return timestamp <= now - expiration;\r\n    }\r\n\r\n    /**\r\n        @dev Retrieves the convertion rate of a given currency, the information of the rate is carried over the \r\n        data field. If there is a newer rate on the cache, that rate is delivered and the data field is ignored.\r\n\r\n        If the data contains a more recent rate than the cache, the cache is updated.\r\n\r\n        @param currency Hash of the currency\r\n        @param data Data with the rate signed by a delegate\r\n\r\n        @return the rate and decimals of the currency convertion\r\n    */\r\n    function getRate(bytes32 currency, bytes data) public returns (uint256, uint256) {\r\n        if (fallback != address(0)) {\r\n            emit DelegatedCall(msg.sender, fallback);\r\n            return fallback.getRate(currency, data);\r\n        }\r\n\r\n        uint256 timestamp = uint256(readBytes32(data, INDEX_TIMESTAMP));\r\n        RateCache memory rateCache = cache[currency];\r\n        if (rateCache.timestamp >= timestamp && !isExpired(rateCache.timestamp)) {\r\n            emit CacheHit(msg.sender, currency, timestamp, rateCache.timestamp, rateCache.rate, rateCache.decimals);\r\n            return (rateCache.rate, rateCache.decimals);\r\n        } else {\r\n            require(!isExpired(timestamp), \"The rate provided is expired\");\r\n            uint256 rate = uint256(readBytes32(data, INDEX_RATE));\r\n            uint256 decimals = uint256(readBytes32(data, INDEX_DECIMALS));\r\n            uint8 v = uint8(readBytes32(data, INDEX_V));\r\n            bytes32 r = readBytes32(data, INDEX_R);\r\n            bytes32 s = readBytes32(data, INDEX_S);\r\n            \r\n            bytes32 _hash = keccak256(abi.encodePacked(this, currency, rate, decimals, timestamp));\r\n            address signer = ecrecover(keccak256(abi.encodePacked(\"\\x19Ethereum Signed Message:\\n32\", _hash)),v,r,s);\r\n\r\n            if(!isDelegate(signer)) {\r\n                _hash = keccak256(abi.encodePacked(prevOracle, currency, rate, decimals, timestamp));\r\n                signer = ecrecover(keccak256(abi.encodePacked(\"\\x19Ethereum Signed Message:\\n32\", _hash)),v,r,s);\r\n                if(!isDelegate(signer)) {\r\n                    revert('Signature not valid');\r\n                }\r\n            }\r\n\r\n            cache[currency] = RateCache(timestamp, rate, decimals);\r\n\r\n            emit DeliveredRate(msg.sender, currency, signer, timestamp, rate, decimals);\r\n            return (rate, decimals);\r\n        }\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"_address\",\"type\":\"address\"}],\"name\":\"isDelegate\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"}],\"name\":\"setOwner\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"b\",\"type\":\"bytes32\"}],\"name\":\"decodeCurrency\",\"outputs\":[{\"name\":\"o\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_url\",\"type\":\"string\"}],\"name\":\"setUrl\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_fallback\",\"type\":\"address\"}],\"name\":\"setFallback\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_address\",\"type\":\"address\"},{\"name\":\"timestamp\",\"type\":\"uint256\"}],\"name\":\"wasDelegate\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"currency\",\"type\":\"bytes32\"},{\"name\":\"data\",\"type\":\"bytes\"}],\"name\":\"getRate\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"expiration\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"fallback\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"url\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"delegates\",\"outputs\":[{\"name\":\"started\",\"type\":\"uint256\"},{\"name\":\"ended\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"currency\",\"type\":\"string\"}],\"name\":\"encodeCurrency\",\"outputs\":[{\"name\":\"o\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_address\",\"type\":\"address\"}],\"name\":\"removeDelegate\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"name\":\"supported\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"currency\",\"type\":\"bytes32\"}],\"name\":\"invalidateCache\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"name\":\"cache\",\"outputs\":[{\"name\":\"timestamp\",\"type\":\"uint256\"},{\"name\":\"rate\",\"type\":\"uint256\"},{\"name\":\"decimals\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"ticker\",\"type\":\"string\"}],\"name\":\"addCurrency\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"oracle\",\"type\":\"address\"}],\"name\":\"setPrevOracle\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"time\",\"type\":\"uint256\"}],\"name\":\"setExpirationTime\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"prevOracle\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_address\",\"type\":\"address\"}],\"name\":\"addDelegate\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"currencies\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"VERSION\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"requester\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"to\",\"type\":\"address\"}],\"name\":\"DelegatedCall\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"requester\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"currency\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"requestTimestamp\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"deliverTimestamp\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"rate\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"decimals\",\"type\":\"uint256\"}],\"name\":\"CacheHit\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"requester\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"currency\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"signer\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"requestTimestamp\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"rate\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"decimals\",\"type\":\"uint256\"}],\"name\":\"DeliveredRate\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"delegate\",\"type\":\"address\"}],\"name\":\"AddDelegate\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"delegate\",\"type\":\"address\"}],\"name\":\"RemoveDelegate\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"_currency\",\"type\":\"bytes32\"}],\"name\":\"NewSymbol\",\"type\":\"event\"}]","ContractName":"RipioOracle","CompilerVersion":"v0.4.24+commit.e67f0147","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://237f07012f4808309c04053cf48cb09cbb356c9462ec33a7fd3af39e0df86558"}]}