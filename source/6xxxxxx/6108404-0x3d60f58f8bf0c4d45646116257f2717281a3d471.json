{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.24;\r\ncontract BREBuy {\r\n    \r\n\r\n    struct ContractParam {\r\n        uint32  totalSize ; \r\n        uint256 singlePrice;  // 一个eth '\r\n        uint8  pumpRate;\r\n        bool hasChange;\r\n    }\r\n    \r\n    address owner = 0x0;\r\n    uint32  gameIndex = 0;\r\n    uint256 totalPrice= 0;\r\n    ContractParam public setConfig;\r\n    ContractParam public curConfig;\r\n    \r\n    address[] public addressArray = new address[](0);\r\n    \r\n    \r\n   event  addPlayerEvent(uint32,address);\r\n    event GameOverEvent(uint32,uint32,uint256,uint8,address,uint );\r\n    \r\n    /* Initializes contract with initial supply tokens to the creator of the contract */\r\n    constructor ( uint32 _totalSize,\r\n                  uint256 _singlePrice\r\n    )  public payable  {\r\n        owner = msg.sender;\r\n        setConfig = ContractParam(_totalSize,_singlePrice * 1 finney ,5,false);\r\n        curConfig = ContractParam(_totalSize,_singlePrice * 1 finney ,5,false);\r\n        startNewGame();\r\n    }\r\n\r\n    modifier onlyOwner {\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n\r\n    function transferOwnership(address newOwner) onlyOwner public {\r\n        if (newOwner != address(0)) {\r\n            owner = newOwner;\r\n        }\r\n    }\r\n    \r\n    function changeConfig( uint32 _totalSize,uint256 _singlePrice,uint8 _pumpRate) onlyOwner public payable {\r\n    \r\n        curConfig.hasChange = true;\r\n        if(setConfig.totalSize != _totalSize) {\r\n            setConfig.totalSize = _totalSize;\r\n        }\r\n        if(setConfig.pumpRate  != _pumpRate){\r\n            setConfig.pumpRate  = _pumpRate;\r\n        }\r\n        if(setConfig.singlePrice != _singlePrice * 1 finney){\r\n            setConfig.singlePrice = _singlePrice * 1 finney;\r\n        }\r\n    }\r\n    \r\n    function startNewGame() private {\r\n        \r\n        gameIndex++;\r\n        if(curConfig.hasChange) {\r\n            if(curConfig.totalSize   != setConfig.totalSize) {\r\n                curConfig.totalSize   = setConfig.totalSize;\r\n            }\r\n            if(curConfig.singlePrice != setConfig.singlePrice){\r\n               curConfig.singlePrice = setConfig.singlePrice; \r\n            }\r\n            if( curConfig.pumpRate    != setConfig.pumpRate) {\r\n                curConfig.pumpRate    = setConfig.pumpRate;\r\n            }\r\n            curConfig.hasChange = false;\r\n        }\r\n        addressArray.length=0;\r\n    }\r\n    \r\n    \r\n    function addPlayer() public payable {\r\n      \r\n        require(msg.value == curConfig.singlePrice);\r\n        totalPrice = totalPrice + msg.value;\r\n        addressArray.push(msg.sender);\r\n       \r\n        emit addPlayerEvent(gameIndex,msg.sender);\r\n        if(addressArray.length >= curConfig.totalSize) {\r\n            gameResult();\r\n            startNewGame();\r\n        }\r\n    }\r\n    \r\n    function getGameInfo() public view returns  (uint256,uint32,uint256,uint8,address[],uint256)  {\r\n        return (gameIndex,\r\n                curConfig.totalSize,\r\n                curConfig.singlePrice,\r\n                curConfig.pumpRate,\r\n                addressArray,\r\n                totalPrice);\r\n    }\r\n    \r\n    function getSelfCount() private view returns (uint32) {\r\n        uint32 count = 0;\r\n        for(uint i = 0; i < addressArray.length; i++) {\r\n            if(msg.sender == addressArray[i]) {\r\n                count++;\r\n            }\r\n        }\r\n        return count;\r\n    }\r\n    \r\n    function gameResult() private {\r\n            \r\n      uint index  = getRamdon();\r\n      address lastAddress = addressArray[index];\r\n      uint totalBalace = address(this).balance;\r\n      uint giveToOwn   = totalBalace * curConfig.pumpRate / 100;\r\n      uint giveToActor = totalBalace - giveToOwn;\r\n      owner.transfer(giveToOwn);\r\n      lastAddress.transfer(giveToActor);\r\n      emit GameOverEvent(\r\n                    gameIndex,\r\n                    curConfig.totalSize,\r\n                    curConfig.singlePrice,\r\n                    curConfig.pumpRate,\r\n                    lastAddress,\r\n                    now);\r\n    }\r\n    \r\n    function getRamdon() private view returns (uint) {\r\n      bytes32 ramdon = keccak256(abi.encodePacked(ramdon,now,blockhash(block.number-1)));\r\n      for(uint i = 0; i < addressArray.length; i++) {\r\n            ramdon = keccak256(abi.encodePacked(ramdon,now, addressArray[i]));\r\n      }\r\n      uint index  = uint(ramdon) % addressArray.length;\r\n      return index;\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"curConfig\",\"outputs\":[{\"name\":\"totalSize\",\"type\":\"uint32\"},{\"name\":\"singlePrice\",\"type\":\"uint256\"},{\"name\":\"pumpRate\",\"type\":\"uint8\"},{\"name\":\"hasChange\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"addressArray\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getGameInfo\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint32\"},{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint8\"},{\"name\":\"\",\"type\":\"address[]\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"addPlayer\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_totalSize\",\"type\":\"uint32\"},{\"name\":\"_singlePrice\",\"type\":\"uint256\"},{\"name\":\"_pumpRate\",\"type\":\"uint8\"}],\"name\":\"changeConfig\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"setConfig\",\"outputs\":[{\"name\":\"totalSize\",\"type\":\"uint32\"},{\"name\":\"singlePrice\",\"type\":\"uint256\"},{\"name\":\"pumpRate\",\"type\":\"uint8\"},{\"name\":\"hasChange\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"_totalSize\",\"type\":\"uint32\"},{\"name\":\"_singlePrice\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"\",\"type\":\"uint32\"},{\"indexed\":false,\"name\":\"\",\"type\":\"address\"}],\"name\":\"addPlayerEvent\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"\",\"type\":\"uint32\"},{\"indexed\":false,\"name\":\"\",\"type\":\"uint32\"},{\"indexed\":false,\"name\":\"\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"\",\"type\":\"uint8\"},{\"indexed\":false,\"name\":\"\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"GameOverEvent\",\"type\":\"event\"}]","ContractName":"BREBuy","CompilerVersion":"v0.4.24+commit.e67f0147","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a","Library":"","SwarmSource":"bzzr://0c61e2fa0caf05f4a371c990f363fdbbe9c90a547b42e387403f77ba2aebc873"}]}