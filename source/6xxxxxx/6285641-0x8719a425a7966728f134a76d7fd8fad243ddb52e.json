{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity 0.4.24;\r\n\r\n\r\n/**\r\n * @title SafeMath\r\n * @dev Math operations with safety checks that throw on error\r\n */\r\nlibrary SafeMath {\r\n\r\n  /**\r\n  * @dev Multiplies two numbers, throws on overflow.\r\n  */\r\n  function mul(uint256 a, uint256 b) internal pure returns (uint256 c) {\r\n    // Gas optimization: this is cheaper than asserting 'a' not being zero, but the\r\n    // benefit is lost if 'b' is also tested.\r\n    // See: https://github.com/OpenZeppelin/openzeppelin-solidity/pull/522\r\n    if (a == 0) {\r\n      return 0;\r\n    }\r\n\r\n    c = a * b;\r\n    assert(c / a == b);\r\n    return c;\r\n  }\r\n\r\n  /**\r\n  * @dev Integer division of two numbers, truncating the quotient.\r\n  */\r\n  function div(uint256 a, uint256 b) internal pure returns (uint256) {\r\n    // assert(b > 0); // Solidity automatically throws when dividing by 0\r\n    // uint256 c = a / b;\r\n    // assert(a == b * c + a % b); // There is no case in which this doesn't hold\r\n    return a / b;\r\n  }\r\n\r\n  /**\r\n  * @dev Subtracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).\r\n  */\r\n  function sub(uint256 a, uint256 b) internal pure returns (uint256) {\r\n    assert(b <= a);\r\n    return a - b;\r\n  }\r\n\r\n  /**\r\n  * @dev Adds two numbers, throws on overflow.\r\n  */\r\n  function add(uint256 a, uint256 b) internal pure returns (uint256 c) {\r\n    c = a + b;\r\n    assert(c >= a);\r\n    return c;\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @title Ownable\r\n * @dev The Ownable contract has an owner address, and provides basic authorization control\r\n * functions, this simplifies the implementation of \"user permissions\".\r\n */\r\ncontract Ownable {\r\n  address public owner;\r\n\r\n\r\n  event OwnershipRenounced(address indexed previousOwner);\r\n  event OwnershipTransferred(\r\n    address indexed previousOwner,\r\n    address indexed newOwner\r\n  );\r\n\r\n\r\n  /**\r\n   * @dev The Ownable constructor sets the original `owner` of the contract to the sender\r\n   * account.\r\n   */\r\n  constructor() public {\r\n    owner = msg.sender;\r\n  }\r\n\r\n  /**\r\n   * @dev Throws if called by any account other than the owner.\r\n   */\r\n  modifier onlyOwner() {\r\n    require(msg.sender == owner);\r\n    _;\r\n  }\r\n\r\n  /**\r\n   * @dev Allows the current owner to relinquish control of the contract.\r\n   */\r\n  function renounceOwnership() public onlyOwner {\r\n    emit OwnershipRenounced(owner);\r\n    owner = address(0);\r\n  }\r\n\r\n  /**\r\n   * @dev Allows the current owner to transfer control of the contract to a newOwner.\r\n   * @param _newOwner The address to transfer ownership to.\r\n   */\r\n  function transferOwnership(address _newOwner) public onlyOwner {\r\n    _transferOwnership(_newOwner);\r\n  }\r\n\r\n  /**\r\n   * @dev Transfers control of the contract to a newOwner.\r\n   * @param _newOwner The address to transfer ownership to.\r\n   */\r\n  function _transferOwnership(address _newOwner) internal {\r\n    require(_newOwner != address(0));\r\n    emit OwnershipTransferred(owner, _newOwner);\r\n    owner = _newOwner;\r\n  }\r\n}\r\n\r\n\r\n/// @title Interface for token controllers. The controller specifies whether a transfer can be done.\r\ncontract TokenControllerI {\r\n\r\n    /// @dev Specifies whether a transfer is allowed or not.\r\n    /// @return True if the transfer is allowed\r\n    function transferAllowed(address _from, address _to)\r\n        external\r\n        view \r\n        returns (bool);\r\n}\r\n\r\ninterface SaleInterface {\r\n    function saleTokensPerUnit() external view returns(uint256);\r\n    function extraTokensPerUnit() external view returns(uint256);\r\n    function unitContributions(address) external view returns(uint256);\r\n    function disbursementHandler() external view returns(address);\r\n\r\n}\r\n\r\n\r\ninterface RegistryInterface {\r\n\r\n    function totalStaked(address) external view returns(uint256);\r\n    function numApplications(address) external view returns(uint256);\r\n\r\n}\r\n\r\n\r\ncontract FoamTokenController is TokenControllerI, Ownable {\r\n    using SafeMath for uint256;\r\n\r\n    RegistryInterface public registry;\r\n    SaleInterface public sale;\r\n\r\n    uint256 public platformLaunchDate;\r\n\r\n    uint256 public saleTokensPerUnit;\r\n    uint256 public extraTokensPerUnit;\r\n\r\n    mapping (address => bool) public isProtocolContract;\r\n\r\n    mapping(address => address) public proposedPair;\r\n    mapping(address => address) public pair;\r\n\r\n    mapping(address => bool) public isBlacklisted;\r\n\r\n    event ProposeWhitelisted(address _whitelistor, address _whitelistee);\r\n    event ConfirmWhitelisted(address _whitelistor, address _whitelistee);\r\n\r\n    // this is one of the TF multisigs.\r\n    // We can then send the tokens onwards to wherever FOAM request for the tokens to be.\r\n    address acceptedAddress = 0x36A9b165ef64767230A7Aded71B04F0911bB1283;\r\n\r\n    constructor(RegistryInterface _registry, SaleInterface _sale, uint256 _launchDate) public {\r\n        require(_registry != address(0));\r\n        require(_sale != address(0));\r\n        require(_launchDate != 0 && _launchDate <= now);\r\n\r\n        registry = _registry;\r\n        sale = _sale;\r\n        platformLaunchDate = _launchDate;\r\n\r\n        isProtocolContract[address(registry)] = true;\r\n\r\n        saleTokensPerUnit = sale.saleTokensPerUnit();\r\n        extraTokensPerUnit = sale.extraTokensPerUnit();\r\n    }\r\n\r\n    function setWhitelisted(address _whitelisted) public {\r\n        require(_whitelisted != 0);\r\n\r\n        require(pair[msg.sender] == 0);\r\n        require(pair[_whitelisted] == 0);\r\n\r\n        require(sale.unitContributions(msg.sender) != 0);\r\n        require(sale.unitContributions(_whitelisted) == 0);\r\n\r\n        proposedPair[msg.sender] = _whitelisted;\r\n        emit ProposeWhitelisted(msg.sender, _whitelisted);\r\n    }\r\n\r\n    function confirmWhitelisted(address _whitelistor) public {\r\n        require(pair[msg.sender] == 0);\r\n        require(pair[_whitelistor] == 0);\r\n\r\n        require(proposedPair[_whitelistor] == msg.sender);\r\n\r\n        pair[msg.sender] = _whitelistor;\r\n        pair[_whitelistor] = msg.sender;\r\n\r\n        emit ConfirmWhitelisted(_whitelistor, msg.sender);\r\n    }\r\n\r\n    function blacklistAddresses(address[] _addresses, bool _isBlacklisted) public onlyOwner {\r\n        for (uint256 i = 0; i < _addresses.length; i++) {\r\n            isBlacklisted[_addresses[i]] = _isBlacklisted;\r\n        }\r\n    }\r\n\r\n    function changeRegistry(RegistryInterface _newRegistry) public onlyOwner {\r\n        require(_newRegistry != address(0));\r\n        isProtocolContract[address(registry)] = false;\r\n        isProtocolContract[address(_newRegistry)] = true;\r\n        registry = _newRegistry;\r\n    }\r\n\r\n    function setPlatformLaunchDate(uint256 _launchDate) public onlyOwner {\r\n        require(_launchDate != 0 && _launchDate <= now);\r\n        platformLaunchDate = _launchDate;\r\n    }\r\n\r\n    function setProtocolContract(address _contract, bool _isProtocolContract) public onlyOwner {\r\n        isProtocolContract[_contract] = _isProtocolContract;\r\n    }\r\n\r\n    function transferAllowed(address _from, address _to)\r\n        external\r\n        view\r\n        returns (bool)\r\n    {\r\n        if(isBlacklisted[_from]) {\r\n            if (_to == acceptedAddress) {\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        bool protocolTransfer = isProtocolContract[_from] || isProtocolContract[_to];\r\n        bool whitelistedTransfer = pair[_from] == _to && pair[_to] == _from;\r\n\r\n        if (protocolTransfer || whitelistedTransfer || platformLaunchDate + 1 years <= now) {\r\n            return true;\r\n        } else if (platformLaunchDate + 45 days > now) {\r\n            return false;\r\n        }\r\n        return purchaseCheck(_from);\r\n    }\r\n\r\n    function purchaseCheck(address _contributor) internal view returns(bool) {\r\n        address secondAddress = pair[_contributor];\r\n\r\n        uint256 contributed = sale.unitContributions(_contributor);\r\n\r\n        if (contributed == 0) {\r\n            if (secondAddress == 0) {\r\n                return true;\r\n            } else {\r\n                contributed = sale.unitContributions(secondAddress);\r\n            }\r\n        }\r\n\r\n        uint256 tokensStaked = registry.totalStaked(_contributor);\r\n        uint256 PoICreated = registry.numApplications(_contributor);\r\n\r\n        if (secondAddress != 0) {\r\n            tokensStaked = tokensStaked.add(registry.totalStaked(secondAddress));\r\n            PoICreated = PoICreated.add(registry.numApplications(secondAddress));\r\n        }\r\n\r\n        uint256 tokensBought = contributed.mul(saleTokensPerUnit.add(extraTokensPerUnit));\r\n\r\n        bool enoughStaked;\r\n        if (contributed <= 10000) {\r\n            enoughStaked = tokensStaked >= tokensBought.mul(25).div(100);\r\n        } else {\r\n            enoughStaked = tokensStaked >= tokensBought.mul(50).div(100);\r\n        }\r\n\r\n        return enoughStaked && PoICreated >= 10;\r\n    }\r\n}","ABI":"[{\"constant\":false,\"inputs\":[{\"name\":\"_newRegistry\",\"type\":\"address\"}],\"name\":\"changeRegistry\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"}],\"name\":\"transferAllowed\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_contract\",\"type\":\"address\"},{\"name\":\"_isProtocolContract\",\"type\":\"bool\"}],\"name\":\"setProtocolContract\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_whitelisted\",\"type\":\"address\"}],\"name\":\"setWhitelisted\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_launchDate\",\"type\":\"uint256\"}],\"name\":\"setPlatformLaunchDate\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"platformLaunchDate\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"sale\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"renounceOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"registry\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"pair\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_addresses\",\"type\":\"address[]\"},{\"name\":\"_isBlacklisted\",\"type\":\"bool\"}],\"name\":\"blacklistAddresses\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_whitelistor\",\"type\":\"address\"}],\"name\":\"confirmWhitelisted\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"isProtocolContract\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"proposedPair\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"saleTokensPerUnit\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"extraTokensPerUnit\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"isBlacklisted\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"_registry\",\"type\":\"address\"},{\"name\":\"_sale\",\"type\":\"address\"},{\"name\":\"_launchDate\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"_whitelistor\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_whitelistee\",\"type\":\"address\"}],\"name\":\"ProposeWhitelisted\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"_whitelistor\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_whitelistee\",\"type\":\"address\"}],\"name\":\"ConfirmWhitelisted\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"previousOwner\",\"type\":\"address\"}],\"name\":\"OwnershipRenounced\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"previousOwner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"}]","ContractName":"FoamTokenController","CompilerVersion":"v0.4.24+commit.e67f0147","OptimizationUsed":"1","Runs":"300","ConstructorArguments":"0000000000000000000000002832373dddad96bbfb44f1b7da11b6541026bf400000000000000000000000003ce3b6d9372a4d761172a89cf0139129309fa0ae000000000000000000000000000000000000000000000000000000005b5eb186","Library":"","SwarmSource":"bzzr://5484d6124f51c0ac2d28634906fd269f5de8f78a290954272b254804848321d7"}]}