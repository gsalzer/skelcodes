{"status":"1","message":"OK","result":[{"SourceCode":"pragma solidity ^0.4.24;\r\n\r\n/*\r\n _    _      _                              _        \r\n| |  | |    | |                            | |       \r\n| |  | | ___| | ___ ___  _ __ ___   ___    | |_ ___  \r\n| |/\\| |/ _ | |/ __/ _ \\| '_ ` _ \\ / _ \\   | __/ _ \\ \r\n\\  /\\  |  __| | (_| (_) | | | | | |  __/   | || (_) |\r\n \\/  \\/ \\___|_|\\___\\___/|_| |_| |_|\\___|    \\__\\___/            \r\n\r\n\r\n$$\\    $$\\ $$\\   $$\\               $$\\                     $$\\       \r\n$$ |   $$ |\\__|  $$ |              $$ |                    $$ |      \r\n$$ |   $$ |$$\\ $$$$$$\\    $$$$$$\\  $$ |$$\\   $$\\  $$$$$$$\\ $$ |  $$\\ \r\n\\$$\\  $$  |$$ |\\_$$  _|   \\____$$\\ $$ |$$ |  $$ |$$  _____|$$ | $$  |\r\n \\$$\\$$  / $$ |  $$ |     $$$$$$$ |$$ |$$ |  $$ |$$ /      $$$$$$  / \r\n  \\$$$  /  $$ |  $$ |$$\\ $$  __$$ |$$ |$$ |  $$ |$$ |      $$  _$$<  \r\n   \\$  /   $$ |  \\$$$$  |\\$$$$$$$ |$$ |\\$$$$$$  |\\$$$$$$$\\ $$ | \\$$\\ \r\n    \\_/    \\__|   \\____/  \\_______|\\__| \\______/  \\_______|\\__|  \\__|\r\n\r\n\r\nThis is the main contract for the Vitaluck button game. \r\nYou can access it here: https://vitaluck.com\r\n*/\r\n\r\ncontract Vitaluck {\r\n    \r\n    //\r\n    // Admin\r\n    //\r\n\r\n    address ownerAddress = 0x3dcd6f0d7860f93b8bb7d6dcb85346c814243d63;\r\n    address cfoAddress = 0x5b665218efCE2a15BD64Bd1dE50a27286f456863;\r\n    \r\n    modifier onlyCeo() {\r\n        require (msg.sender == ownerAddress);\r\n        _;\r\n    }\r\n    \r\n    //\r\n    // Events\r\n    //\r\n    \r\n    event NewPress(address player, uint countPress, uint256 pricePaid, uint32 _timerEnd);\r\n\r\n    //\r\n    // Game\r\n    //\r\n\r\n    uint countPresses;\r\n    uint256 countInvestorDividends;\r\n\r\n    uint amountPlayed;\r\n\r\n    uint32 timerEnd;                                        // The timestamp for the end after this time stamp, the winner can withdraw its reward\r\n    uint32 timerInterval = 21600;                           // We set the interval of 3h\r\n\r\n    address winningAddress;\r\n    uint256 buttonBasePrice = 20000000000000000;              // This is the current price for a button press (this is updated every 100 presses)\r\n    uint256 buttonPriceStep = 2000000000000000;\r\n    //\r\n    // Mapping for the players\r\n    //\r\n    struct Player {\r\n        address playerAddress;                              // We save the address of the player\r\n        uint countVTL;                                      // The count of VTL Tokens (should be the same as the count of presses)\r\n    }\r\n    Player[] players;\r\n    mapping (address => uint) public playersToId;      // We map the player address to its id to make it easier to retrieve\r\n\r\n    //\r\n    // Core\r\n    //\r\n\r\n    // This function is called when a player sends ETH directly to the contract\r\n    function() public payable {\r\n        // We calculate the correct amount of presses\r\n        uint _countPress = msg.value / getButtonPrice();\r\n        \r\n        // We call the function\r\n        Press(_countPress, 0);\r\n    }\r\n        \r\n    // We use this function to initially fund the contract\r\n    function FundContract() public payable {\r\n        \r\n    }\r\n    \r\n    // This function is being called when a user presses the button on the website (or call it directly from the contract)\r\n    function Press(uint _countPresses, uint _affId) public payable {\r\n        // We verify that the _countPress value is not < 1\r\n        require(_countPresses >= 1);\r\n        \r\n        // We double check that the players aren't trying to send small amount of ETH to press the button\r\n        require(msg.value >= buttonBasePrice);\r\n        \r\n        // We verify that the game is not finished.\r\n        require(timerEnd > now);\r\n\r\n        // We verify that the value paid is correct.\r\n        uint256 _buttonPrice = getButtonPrice();\r\n        require(msg.value >= safeMultiply(_buttonPrice, _countPresses));\r\n\r\n        // Process the button press\r\n        timerEnd = uint32(now + timerInterval);\r\n        winningAddress = msg.sender;\r\n\r\n        // Transfer the commissions to affiliate, investor, pot and dev\r\n        uint256 TwoPercentCom = (msg.value / 100) * 2;\r\n        uint256 TenPercentCom = msg.value / 10;\r\n        uint256 FifteenPercentCom = (msg.value / 100) * 15;\r\n        \r\n\r\n        // Commission #1. Affiliate\r\n        if(_affId > 0 && _affId < players.length) {\r\n            // If there is an affiliate we transfer his commission otherwise we keep the commission in the pot\r\n            players[_affId].playerAddress.transfer(TenPercentCom);\r\n        }\r\n        // Commission #2. Main investor\r\n        uint[] memory mainInvestors = GetMainInvestor();\r\n        uint mainInvestor = mainInvestors[0];\r\n        players[mainInvestor].playerAddress.transfer(FifteenPercentCom);\r\n        countInvestorDividends = countInvestorDividends + FifteenPercentCom;\r\n        \r\n        // Commission #3. 2 to 10 main investors\r\n        // We loop through all of the top 10 investors and send them their commission\r\n        for(uint i = 1; i < mainInvestors.length; i++) {\r\n            if(mainInvestors[i] != 0) {\r\n                uint _investorId = mainInvestors[i];\r\n                players[_investorId].playerAddress.transfer(TwoPercentCom);\r\n                countInvestorDividends = countInvestorDividends + TwoPercentCom;\r\n            }\r\n        }\r\n\r\n        // Commission #4. Dev\r\n        cfoAddress.transfer(FifteenPercentCom);\r\n\r\n        // Update or create the player and issue the VTL Tokens\r\n        if(playersToId[msg.sender] > 0) {\r\n            // Player exists, update data\r\n            players[playersToId[msg.sender]].countVTL = players[playersToId[msg.sender]].countVTL + _countPresses;\r\n        } else {\r\n            // Player doesn't exist create it\r\n            uint playerId = players.push(Player(msg.sender, _countPresses)) - 1;\r\n            playersToId[msg.sender] = playerId;\r\n        }\r\n\r\n        // Send event\r\n        emit NewPress(msg.sender, _countPresses, msg.value, timerEnd);\r\n        \r\n        // Increment the total count of presses\r\n        countPresses = countPresses + _countPresses;\r\n        amountPlayed = amountPlayed + msg.value;\r\n    }\r\n\r\n    // This function can be called only by the winner once the timer has ended\r\n    function withdrawReward() public {\r\n        // We verify that the game has ended and that the address asking for the withdraw is the winning address\r\n        require(timerEnd < now);\r\n        require(winningAddress == msg.sender);\r\n        \r\n        // Send the balance to the winning player\r\n        winningAddress.transfer(address(this).balance);\r\n    }\r\n    \r\n    // This function returns the details for the players by id (instead of by address)\r\n    function GetPlayer(uint _id) public view returns(address, uint) {\r\n        return(players[_id].playerAddress, players[_id].countVTL);\r\n    }\r\n    \r\n    // Return the player id and the count of VTL for the connected player\r\n    function GetPlayerDetails(address _address) public view returns(uint, uint) {\r\n        uint _playerId = playersToId[_address];\r\n        uint _countVTL = 0;\r\n        if(_playerId > 0) {\r\n            _countVTL = players[_playerId].countVTL;\r\n        }\r\n        return(_playerId, _countVTL);\r\n    }\r\n\r\n    // We loop through all of the players to get the main investor (the one with the largest amount of VTL Token)\r\n    function GetMainInvestor() public view returns(uint[]) {\r\n        uint depth = 10;\r\n        bool[] memory _checkPlayerInRanking = new bool[] (players.length);\r\n        \r\n        uint[] memory curWinningVTLAmount = new uint[] (depth);\r\n        uint[] memory curWinningPlayers = new uint[] (depth);\r\n        \r\n        // Loop through the depth to find the player for each rank\r\n        for(uint j = 0; j < depth; j++) {\r\n            // We reset some value\r\n            curWinningVTLAmount[j] = 0;\r\n            \r\n            // We loop through all of the players\r\n            for (uint8 i = 0; i < players.length; i++) {\r\n                // Iterate through players and insert the current best at the correct position\r\n                if(players[i].countVTL > curWinningVTLAmount[j] && _checkPlayerInRanking[i] != true) {\r\n                    curWinningPlayers[j] = i;\r\n                    curWinningVTLAmount[j] = players[i].countVTL;\r\n                }\r\n            }\r\n            // We record that this player is in the ranking to make sure we don't integrate it multiple times in the ranking\r\n            _checkPlayerInRanking[curWinningPlayers[j]] = true;\r\n        }\r\n\r\n        // We return the winning player\r\n        return(curWinningPlayers);\r\n    }\r\n    \r\n    // This function returns the current important stats of the game such as the timer, current balance and current winner, the current press prices...\r\n    function GetCurrentNumbers() public view returns(uint, uint256, address, uint, uint256, uint256, uint256) {\r\n        return(timerEnd, address(this).balance, winningAddress, countPresses, amountPlayed, getButtonPrice(), countInvestorDividends);\r\n    }\r\n    \r\n    // This is the initial function called when we create the contract \r\n    constructor() public onlyCeo {\r\n        timerEnd = uint32(now + timerInterval);\r\n        winningAddress = ownerAddress;\r\n        \r\n        // We create the initial player to avoid any bugs\r\n        uint playerId = players.push(Player(0x0, 0)) - 1;\r\n        playersToId[msg.sender] = playerId;\r\n    }\r\n    \r\n    // This function returns the current price of the button according to the amount pressed.\r\n    function getButtonPrice() public view returns(uint256) {\r\n        // Get price multiplier according to the amount of presses\r\n        uint _multiplier = 0;\r\n        if(countPresses > 100) {\r\n            _multiplier = buttonPriceStep * (countPresses / 100);\r\n        }\r\n        \r\n        // Calculate final button price\r\n        uint256 _buttonPrice = buttonBasePrice + _multiplier;\r\n        return(_buttonPrice);\r\n        \r\n    }\r\n    \r\n    //\r\n    // Safe Math\r\n    //\r\n\r\n     // Guards against integer overflows.\r\n    function safeMultiply(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        if (a == 0) {\r\n            return 0;\r\n        } else {\r\n            uint256 c = a * b;\r\n            assert(c / a == b);\r\n            return c;\r\n        }\r\n    }\r\n    \r\n}","ABI":"[{\"constant\":false,\"inputs\":[{\"name\":\"_countPresses\",\"type\":\"uint256\"},{\"name\":\"_affId\",\"type\":\"uint256\"}],\"name\":\"Press\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_id\",\"type\":\"uint256\"}],\"name\":\"GetPlayer\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"GetMainInvestor\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256[]\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getButtonPrice\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"FundContract\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_address\",\"type\":\"address\"}],\"name\":\"GetPlayerDetails\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"playersToId\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"withdrawReward\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"GetCurrentNumbers\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"},{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"player\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"countPress\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"pricePaid\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"_timerEnd\",\"type\":\"uint32\"}],\"name\":\"NewPress\",\"type\":\"event\"}]","ContractName":"Vitaluck","CompilerVersion":"v0.4.24+commit.e67f0147","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://9b4fc33a387ae594937f30e07e17a7f90401b215803dc10c69e353e112dc7a3c"}]}